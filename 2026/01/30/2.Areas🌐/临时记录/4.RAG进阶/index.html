<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>4.RAGè¿›é˜¶ | yuezi</title><meta name="author" content="yuezi"><meta name="copyright" content="yuezi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æˆ‘ä»¬å…ˆå‰å·²ç»äº†è§£RAGçš„æ•´ä½“å·¥ä½œæµç¨‹ï¼Œä¸ºäº†ç”Ÿæˆæ›´åŠ å®šåˆ¶åŒ–çš„å†…å®¹ï¼Œç°åœ¨è¦è¿›è¡Œä¸€äº›ç»†èŠ‚çš„RAGå­¦ä¹  	  RAGè¿›é˜¶å­¦ä¹ æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²ï¼ˆETLï¼‰ETLSpringAI-ETL ETLä¸­çš„æ–‡æ¡£å®é™…ä¸Šä¸å±€é™äºæ–‡æœ¬ï¼Œè¿˜æœ‰ä¸€ç³»åˆ—çš„å…ƒä¿¡æ¯MetaDataã€å¤šåª’ä½“é™„ä»¶MediaContent 		  è€Œé’ˆå¯¹äºETLï¼Œéµå¾ªä¸€å®šçš„æµç¨‹ï¼Œå¯¹åº”ç€ä¸‰å¤§ç»„ä»¶ï¼š  è¯»å–æ–‡æ¡£ï¼šDocumentReaderè´Ÿè´£ä»æ•°æ®æºåŠ è½½æ–‡æ¡£ è½¬">
<meta property="og:type" content="article">
<meta property="og:title" content="4.RAGè¿›é˜¶">
<meta property="og:url" content="https://yuezi2048.github.io/2026/01/30/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/4.RAG%E8%BF%9B%E9%98%B6/index.html">
<meta property="og:site_name" content="yuezi">
<meta property="og:description" content="æˆ‘ä»¬å…ˆå‰å·²ç»äº†è§£RAGçš„æ•´ä½“å·¥ä½œæµç¨‹ï¼Œä¸ºäº†ç”Ÿæˆæ›´åŠ å®šåˆ¶åŒ–çš„å†…å®¹ï¼Œç°åœ¨è¦è¿›è¡Œä¸€äº›ç»†èŠ‚çš„RAGå­¦ä¹  	  RAGè¿›é˜¶å­¦ä¹ æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²ï¼ˆETLï¼‰ETLSpringAI-ETL ETLä¸­çš„æ–‡æ¡£å®é™…ä¸Šä¸å±€é™äºæ–‡æœ¬ï¼Œè¿˜æœ‰ä¸€ç³»åˆ—çš„å…ƒä¿¡æ¯MetaDataã€å¤šåª’ä½“é™„ä»¶MediaContent 		  è€Œé’ˆå¯¹äºETLï¼Œéµå¾ªä¸€å®šçš„æµç¨‹ï¼Œå¯¹åº”ç€ä¸‰å¤§ç»„ä»¶ï¼š  è¯»å–æ–‡æ¡£ï¼šDocumentReaderè´Ÿè´£ä»æ•°æ®æºåŠ è½½æ–‡æ¡£ è½¬">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yuezi2048.github.io/img/touxiang.jpg">
<meta property="article:published_time" content="2026-01-30T13:23:42.000Z">
<meta property="article:modified_time" content="2026-01-30T13:23:42.000Z">
<meta property="article:author" content="yuezi">
<meta property="article:tag" content="ä¸´æ—¶è®°å½•">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yuezi2048.github.io/img/touxiang.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "4.RAGè¿›é˜¶",
  "url": "https://yuezi2048.github.io/2026/01/30/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/4.RAG%E8%BF%9B%E9%98%B6/",
  "image": "https://yuezi2048.github.io/img/touxiang.jpg",
  "datePublished": "2026-01-30T13:23:42.000Z",
  "dateModified": "2026-01-30T13:23:42.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "yuezi",
      "url": "https://yuezi2048.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://yuezi2048.github.io/2026/01/30/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/4.RAG%E8%BF%9B%E9%98%B6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?bfb48b678d82bea9f9cc9d59227767e4";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"FPH6F2TOJL","apiKey":"06d9ea26c803ba912b4d8e13404ed34d","indexName":"blog","hitsPerPage":6,"languages":{"input_placeholder":"æœç´¢","hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œè€—æ—¶ ${time} æ¯«ç§’"}},
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":350,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '4.RAGè¿›é˜¶',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/backgound.css"><meta name="generator" content="Hexo 8.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-original="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">785</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">66</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">91</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> åšæ–‡</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> å½’æ¡£</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äºç¬”è€…</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/default.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">yuezi</span></a><a class="nav-page-title" href="/"><span class="site-name">4.RAGè¿›é˜¶</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> åšæ–‡</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> å½’æ¡£</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äºç¬”è€…</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">4.RAGè¿›é˜¶</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2026-01-30T13:23:42.000Z" title="å‘è¡¨äº 2026-01-30 21:23:42">2026-01-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2026-01-30T13:23:42.000Z" title="æ›´æ–°äº 2026-01-30 21:23:42">2026-01-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/2-Areas%F0%9F%8C%90/">2.AreasğŸŒ</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/2-Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/">ä¸´æ—¶è®°å½•</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">10.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>37åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>æˆ‘ä»¬å…ˆå‰å·²ç»äº†è§£RAGçš„æ•´ä½“å·¥ä½œæµç¨‹ï¼Œä¸ºäº†ç”Ÿæˆæ›´åŠ å®šåˆ¶åŒ–çš„å†…å®¹ï¼Œç°åœ¨è¦è¿›è¡Œä¸€äº›ç»†èŠ‚çš„RAGå­¦ä¹ </p>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260127162924763.png" alt="image-20260127162924763" style="zoom:50%;" />	

<h2 id="RAGè¿›é˜¶å­¦ä¹ "><a href="#RAGè¿›é˜¶å­¦ä¹ " class="headerlink" title="RAGè¿›é˜¶å­¦ä¹ "></a>RAGè¿›é˜¶å­¦ä¹ </h2><h3 id="æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²ï¼ˆETLï¼‰"><a href="#æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²ï¼ˆETLï¼‰" class="headerlink" title="æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²ï¼ˆETLï¼‰"></a>æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²ï¼ˆETLï¼‰</h3><h4 id="ETL"><a href="#ETL" class="headerlink" title="ETL"></a>ETL</h4><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html">SpringAI-ETL</a></p>
<p>ETLä¸­çš„æ–‡æ¡£å®é™…ä¸Šä¸å±€é™äºæ–‡æœ¬ï¼Œè¿˜æœ‰ä¸€ç³»åˆ—çš„å…ƒä¿¡æ¯MetaDataã€å¤šåª’ä½“é™„ä»¶MediaContent</p>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/spring-ai-document1-api.jpg" alt="Spring AI Message API" style="zoom: 15%;" />		

<p>è€Œé’ˆå¯¹äºETLï¼Œéµå¾ªä¸€å®šçš„æµç¨‹ï¼Œå¯¹åº”ç€ä¸‰å¤§ç»„ä»¶ï¼š</p>
<ul>
<li>è¯»å–æ–‡æ¡£ï¼š<code>DocumentReader</code>è´Ÿè´£ä»æ•°æ®æºåŠ è½½æ–‡æ¡£</li>
<li>è½¬æ¢æ–‡æ¡£ï¼šæ ¹æ®éœ€æ±‚å°†æ–‡æ¡£å¤„ç†ä¸ºæŒ‡å®šçš„æ ¼å¼ï¼ˆå¦‚å»é™¤å†—ä½™ä¿¡æ¯ã€åˆ†è¯ã€è¯æ€§æ ‡æ³¨ç­‰ï¼‰ï¼Œå¯é€šè¿‡<code>DocumentTransformer</code>å®ç°</li>
<li>å†™å…¥æ–‡æ¡£ï¼š<code>DocumentWriter</code>å°†æ–‡æ¡£ä»¥ç‰¹å®šæ ¼å¼ä¿å­˜åˆ°å­˜å‚¨ä¸­ï¼Œå¦‚ä»¥åµŒå…¥å‘é‡çš„å½¢å¼å†™å…¥å‘é‡æ•°æ®åº“ï¼Œæˆ–è€…é€šè¿‡k-vé”®å€¼å¯¹ä¿å­˜åˆ°Redisç­‰æ•°æ®åº“ä¸­</li>
</ul>
<p><img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260127164336907.png" alt="image-20260127164336907"></p>
<blockquote>
<p><img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/etl-class-diagram.jpg" alt="etl class diagram"></p>
</blockquote>
<h4 id="Extract-DocumentReader"><a href="#Extract-DocumentReader" class="headerlink" title="Extract_DocumentReader"></a>Extract_DocumentReader</h4><p>å®ç°äº†Supplierå‡½æ•°å¼æ¥å£ï¼Œä»æ•°æ®æºä¸­å¾—åˆ°Documenté›†åˆ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DocumentReader</span> <span class="keyword">extends</span> <span class="title class_">Supplier</span>&lt;List&lt;Document&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">default</span> List&lt;Document&gt; <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html#_documentreaders">å†…ç½®å®ç°ç±»</a>ï¼š</p>
<ol>
<li>JsonReader: è¯»å– JSON æ–‡æ¡£</li>
<li>TextReader: è¯»å–çº¯æ–‡æœ¬æ–‡ä»¶</li>
<li>MarkdownReader: è¯»å– Markdown æ–‡ä»¶</li>
<li>PDFReader: è¯»å– PDF æ–‡æ¡£, åŸºäº Apache PdfBox åº“å®ç°<ul>
<li>PagePdfDocumentReader: æŒ‰ç…§åˆ†é¡µè¯»å– PDF</li>
<li>ParagraphPdfDocumentReader: æŒ‰ç…§æ®µè½è¯»å– PDF</li>
</ul>
</li>
<li>HtmlReader: è¯»å– HTML æ–‡æ¡£, åŸºäº jsoup åº“å®ç°</li>
<li>TikaDocumentReader: åŸºäº <a target="_blank" rel="noopener" href="https://tika.apache.org/3.1.0/formats.html">Apache Tika</a> åº“å¤„ç†å¤šç§æ ¼å¼çš„æ–‡æ¡£, æ›´çµæ´»</li>
</ol>
<p>é˜¿é‡Œå…³äºRAGçš„è¯´æ˜ï¼š<a target="_blank" rel="noopener" href="https://java2ai.com/docs/frameworks/agent-framework/advanced/rag">RAG</a></p>
<p>å…³äºETLçš„æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://java2ai.com/integration/rag/etl-pipeline">ETL</a></p>
<p>å¦‚æœæƒ³è¦è‡ªå®šä¹‰æ–‡æ¡£è¯»å–å™¨å¹¶ä¸éš¾ï¼Œæ ¸å¿ƒå°±æ˜¯è§£ææ–‡æ¡£ï¼Œè½¬æ¢æˆdocumentåˆ—è¡¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MsgEmailParser</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">MsgEmailParser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Private constructor to prevent instantiation</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Convert MsgEmailElement to Document</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element MSG email element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Document object</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Document <span class="title function_">convertToDocument</span><span class="params">(MsgEmailElement element)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (element == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;MsgEmailElement cannot be null&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Build metadata</span></span><br><span class="line">        Map&lt;String, Object&gt; metadata = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add metadata with null check</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(element.getSubject())) &#123;</span><br><span class="line">            metadata.put(<span class="string">&quot;subject&quot;</span>, element.getSubject());</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... çœç•¥æ›´å¤šå…ƒä¿¡æ¯çš„è®¾ç½®</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create Document object with content null check</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> StringUtils.hasText(element.getText()) ? element.getText() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Document</span>(content, metadata);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="Transform-DocumentTransformer"><a href="#Transform-DocumentTransformer" class="headerlink" title="Transform_DocumentTransformer"></a>Transform_DocumentTransformer</h4><p>æºç ä¸­ï¼Œå®ç°äº† <code>Function&lt;List&lt;Document&gt;, List&lt;Document&gt;&gt;</code>æ¥å£ï¼Œå°†ä¸€ç»„æ–‡æ¡£è½¬æ¢æˆå¦ä¸€ç»„æ–‡æ¡£ï¼Œè¿™æ˜¯ä¿è¯ETLæ•ˆæœçš„æ ¸å¿ƒæ­¥éª¤ï¼Œå¦‚ä½•å°†å¤§æ–‡æ¡£åˆç†æ‹†åˆ†ä¸ºä¾¿äºæ£€ç´¢çš„çŸ¥è¯†ç¢ç‰‡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DocumentTransformer</span> <span class="keyword">extends</span> <span class="title class_">Function</span>&lt;List&lt;Document&gt;, List&lt;Document&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">default</span> List&lt;Document&gt; <span class="title function_">transform</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> apply(documents);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpringAIå®˜æ–¹æä¾›äº†ä¸‰ç±»ï¼š</p>
<ul>
<li><p>TextSplitteræ–‡æœ¬åˆ†å‰²å™¨</p>
</li>
<li><p>MetaDataEnricherå…ƒæ•°æ®å¢å¼ºå™¨</p>
</li>
<li><p>ContentFormatterå†…å®¹æ ¼å¼åŒ–å·¥å…·</p>
</li>
</ul>
<blockquote>
<p>TextSplitter</p>
</blockquote>
<p>å…¶å®ç°ç±»æœ‰<code>TokenTextSplitter</code>ï¼ŒåŸºäºtokenåˆ’åˆ†è¾¹ç•Œï¼ˆè€ƒè™‘å¥å­æœ«å°¾ç­‰æ¥åˆ›å»ºæœ‰æ„ä¹‰çš„æ–‡æœ¬æ®µè½ï¼‰</p>
<p>æ„é€ å‡½æ•°ï¼š</p>
<ol>
<li>TokenTextSplitter(): ä½¿ç”¨é»˜è®¤è®¾ç½®åˆ›å»ºåˆ†å‰²å™¨ã€‚</li>
<li>TokenTextSplitter(int defaultChunkSize, int minChunkSizeChars, int minChunkLengthToEmbed, int maxNumChunks, boolean keepSeparator) : ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°åˆ›å»ºåˆ†å‰²å™¨, é€šè¿‡è°ƒæ•´å‚æ•°, å¯ä»¥æ§åˆ¶åˆ†å‰²çš„ç²’åº¦å’Œæ–¹å¼, é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚</li>
</ol>
<p>å‚æ•°è¯´æ˜ (æ— éœ€è®°å¿†):</p>
<ul>
<li>defaultChunkSize: æ¯ä¸ªæ–‡æœ¬å—çš„ç›®æ ‡å¤§å° (ä»¥ token ä¸ºå•ä½, é»˜è®¤å€¼: 800)ã€‚</li>
<li>minChunkSizeChars: æ¯ä¸ªæ–‡æœ¬å—çš„æœ€å°å¤§å° (ä»¥å­—ç¬¦ä¸ºå•ä½, é»˜è®¤å€¼: 350)ã€‚</li>
<li>minChunkLengthToEmbed: è¦è¢«åŒ…å«çš„å—çš„æœ€å°é•¿åº¦ (é»˜è®¤å€¼: 5)ã€‚</li>
<li>maxNumChunks: ä»æ–‡æœ¬ä¸­ç”Ÿæˆçš„æœ€å¤§å—æ•° (é»˜è®¤å€¼: 10000)ã€‚</li>
<li>keepSeparator: æ˜¯å¦åœ¨å—ä¸­ä¿ç•™åˆ†éš”ç¬¦ (å¦‚æ¢è¡Œç¬¦) (é»˜è®¤å€¼: true)ã€‚</li>
</ul>
<p>å®˜æ–¹æ–‡æ¡£æœ‰å¯¹ Token åˆ†è¯å™¨å·¥ä½œåŸç†çš„è¯¦ç»†è§£é‡Šï¼Œç®€å•äº†è§£ä¸‹:</p>
<ol>
<li>ä½¿ç”¨ CL100K_BASE ç¼–ç å°†è¾“å…¥æ–‡æœ¬ç¼–ç ä¸º tokenã€‚</li>
<li>æ ¹æ® defaultChunkSize å°†ç¼–ç åçš„æ–‡æœ¬åˆ†å‰²æˆå—ã€‚</li>
<li>å¯¹äºæ¯ä¸ªå—:<ul>
<li>å°†å—è§£ç å›æ–‡æœ¬ã€‚</li>
<li>å°è¯•åœ¨ minChunkSizeChars ä¹‹åæ‰¾åˆ°åˆé€‚çš„æ–­ç‚¹ (å¥å·ã€é—®å·ã€æ„Ÿå¹å·æˆ–æ¢è¡Œç¬¦)ã€‚</li>
<li>å¦‚æœæ‰¾åˆ°æ–­ç‚¹, åˆ™åœ¨è¯¥ç‚¹æˆªæ–­å—ã€‚</li>
<li>ä¿®å‰ªå—å¹¶æ ¹æ® keepSeparator è®¾ç½®é€‰æ‹©æ€§åœ°åˆ é™¤æ¢è¡Œç¬¦ã€‚</li>
<li>å¦‚æœç”Ÿæˆçš„å—é•¿åº¦å¤§äº minChunkLengthToEmbed, åˆ™å°†å…¶æ·»åŠ åˆ°è¾“å‡ºä¸­ã€‚</li>
</ul>
</li>
<li>è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´æŒç»­åˆ°æ‰€æœ‰ token éƒ½è¢«å¤„ç†å®Œæˆ–è¾¾åˆ° maxNumChunks ä¸ºæ­¢ã€‚</li>
<li>å¦‚æœå‰©ä½™æ–‡æœ¬é•¿åº¦å¤§äº minChunkLengthToEmbed, åˆ™ä¼šä½œä¸ºæœ€åä¸€ä¸ªå—æ·»åŠ ã€‚</li>
</ol>
<blockquote>
<p>MetaDataEnricher</p>
</blockquote>
<p>æ ¸å¿ƒå°±æ˜¯ç»™æ–‡æ¡£è¡¥å……å…ƒä¿¡æ¯ï¼Œä¾¿äºåç»­æ£€ç´¢ï¼Œä¸å½±å“æ–‡æ¡£æœ¬èº«çš„åˆ‡åˆ†è§„åˆ™ï¼Œæœ‰ä¸¤ç§å®ç°ç±»ï¼š</p>
<ul>
<li><code>KeywordMetadataEnricher</code>ï¼šä½¿ç”¨AIæå–å…³é”®è¯æ·»åŠ å…ƒæ•°æ®</li>
<li><code>SummaryMetadataEnricher</code>ï¼šAIç”Ÿæˆæ–‡æ¡£æ‘˜è¦æ·»åŠ åˆ°å…ƒæ•°æ®ï¼Œä¸ä»…å¯ä»¥å¯¹å½“å‰æ–‡æ¡£ç”Ÿæˆï¼Œè¿˜å¯ä»¥å…³è”å‰ä¸€ä¸ªå’Œåä¸€ä¸ªæ–‡æ¡£ï¼Œè®©æ‘˜è¦æ›´å®Œæ•´</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDocumentEnricher</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatModel chatModel;</span><br><span class="line"></span><br><span class="line">    MyDocumentEnricher(ChatModel chatModel) &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatModel = chatModel;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// å…³é”®è¯å…ƒä¿¡æ¯å¢å¼ºå™¨</span></span><br><span class="line">    List&lt;Document&gt; <span class="title function_">enrichDocumentsByKeyword</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="type">KeywordMetadataEnricher</span> <span class="variable">enricher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KeywordMetadataEnricher</span>(<span class="built_in">this</span>.chatModel, <span class="number">5</span>);</span><br><span class="line">        <span class="keyword">return</span> enricher.apply(documents);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æ‘˜è¦å…ƒä¿¡æ¯å¢å¼ºå™¨</span></span><br><span class="line">    List&lt;Document&gt; <span class="title function_">enrichDocumentsBySummary</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="type">SummaryMetadataEnricher</span> <span class="variable">enricher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SummaryMetadataEnricher</span>(chatModel, </span><br><span class="line">            List.of(SummaryType.PREVIOUS, SummaryType.CURRENT, SummaryType.NEXT));</span><br><span class="line">        <span class="keyword">return</span> enricher.apply(documents);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ContentFormatter</p>
</blockquote>
<p>ä¸€èˆ¬æ˜¯ç”¨äºç»Ÿä¸€æ–‡æ¡£æ ¼å¼ï¼Œå…·ä½“åŠŸèƒ½ï¼š</p>
<ul>
<li>æ–‡æ¡£æ ¼å¼åŒ–ï¼šæ”¯æŒå°†æ–‡æ¡£å†…å®¹å’Œå…ƒæ•°æ®åˆå¹¶ä¸ºç‰¹å®šæ ¼å¼å­—ç¬¦ä¸²</li>
<li>å…ƒæ•°æ®è¿‡æ»¤ï¼šæ ¹æ®ä¸åŒçš„å…ƒæ•°æ®æ¨¡å¼ï¼ˆMetadataModeï¼‰ç­›é€‰éœ€è¦ä¿ç•™çš„å…ƒæ•°æ®é¡¹<ul>
<li>ALLï¼šä¿ç•™æ‰€æœ‰ã€NONEï¼šç§»é™¤æ‰€æœ‰</li>
<li>INFERENCEï¼šæ¨ç†åœºæ™¯ï¼Œæ’é™¤æŒ‡å®šçš„æ¨ç†å…ƒæ•°æ®</li>
<li>EMBEDï¼šåµŒå…¥åœºæ™¯ï¼Œæ’é™¤æŒ‡å®šçš„åµŒå…¥å…ƒæ•°æ®</li>
</ul>
</li>
<li>è‡ªå®šä¹‰æ¨¡æ¿<ul>
<li>å…ƒæ•°æ®æ¨¡æ¿ï¼šæ§åˆ¶å…ƒæ•°æ®é¡¹å±•ç¤ºæ–¹å¼</li>
<li>å…ƒæ•°æ®åˆ†éš”ç¬¦ï¼šæ§åˆ¶å¤šä¸ªå…ƒæ•°æ®çš„åˆ†éš”æ–¹å¼</li>
<li>æ–‡æœ¬æ¨¡æ¿ï¼šæ§åˆ¶å…ƒæ•°æ®ä¸å†…å®¹å¦‚ä½•ç»“åˆ</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DefaultContentFormatter</span> <span class="variable">formatter</span> <span class="operator">=</span> DefaultContentFormatter.builder()</span><br><span class="line">    .withMetadataTemplate(<span class="string">&quot;&#123;key&#125;: &#123;value&#125;&quot;</span>)</span><br><span class="line">    .withMetadataSeparator(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    .withTextTemplate(<span class="string">&quot;&#123;metadata_string&#125;\n\n&#123;content&#125;&quot;</span>)</span><br><span class="line">    .withExcludedInferenceMetadataKeys(<span class="string">&quot;embedding&quot;</span>, <span class="string">&quot;vector_id&quot;</span>)</span><br><span class="line">    .withExcludedEmbedMetadataKeys(<span class="string">&quot;source_url&quot;</span>, <span class="string">&quot;timestamp&quot;</span>)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ ¼å¼åŒ–å™¨å¤„ç†æ–‡æ¡£</span></span><br><span class="line"><span class="type">String</span> <span class="variable">formattedText</span> <span class="operator">=</span> formatter.format(document, MetadataMode.INFERENCE);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Load-DocmentWriter"><a href="#Load-DocmentWriter" class="headerlink" title="Load_DocmentWriter"></a>Load_DocmentWriter</h4><p>å®ç°äº†<code>Consumer&lt;List&lt;Document&gt;&gt;</code>æ¥å£ï¼Œè´Ÿè´£å°†è½¬æ¢åçš„æ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å­˜å‚¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DocumentWriter</span> <span class="keyword">extends</span> <span class="title class_">Consumer</span>&lt;List&lt;Document&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        accept(documents);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸¤ç§å†…ç½®çš„DocumentWriterå®ç°ï¼š</p>
<ul>
<li>FileDocumentWriterï¼šå†™å…¥æ–‡ä»¶</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDocumentWriter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeDocuments</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="type">FileDocumentWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileDocumentWriter</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="literal">true</span>, MetadataMode.ALL, <span class="literal">false</span>);</span><br><span class="line">        writer.accept(documents);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>VectorStoreWriterï¼šå†™å…¥å‘é‡æ•°æ®åº“</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDocumentWriter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeDocuments</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="type">FileDocumentWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileDocumentWriter</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="literal">true</span>, MetadataMode.ALL, <span class="literal">false</span>);</span><br><span class="line">        writer.accept(documents);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿæ”¯æŒå†™å…¥å¤šä¸ªå­˜å‚¨ç³»ç»Ÿï¼Œå®šä¹‰å¤šä¸ªWriterå³å¯ã€‚</p>
<h4 id="æµç¨‹è¯´æ˜"><a href="#æµç¨‹è¯´æ˜" class="headerlink" title="æµç¨‹è¯´æ˜"></a>æµç¨‹è¯´æ˜</h4><p>ä»¥ä¸Šæµç¨‹ä¸²èµ·æ¥å°±æ˜¯å¦‚ä¸‹ï¼Œä»æœ€åŸå§‹çš„æ–‡æ¡£åˆ°å‘é‡æ•°æ®åº“ï¼Œä¸ºåç»­çš„æ£€ç´¢å¢å¼ºç”Ÿæˆæä¾›åŸºç¡€</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŠ½å–ï¼šä» PDF æ–‡ä»¶è¯»å–æ–‡æ¡£</span></span><br><span class="line"><span class="type">PDFReader</span> <span class="variable">pdfReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PagePdfDocumentReader</span>(<span class="string">&quot;knowledge_base.pdf&quot;</span>);</span><br><span class="line">List&lt;Document&gt; documents = pdfReader.read();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬æ¢ï¼šåˆ†å‰²æ–‡æœ¬å¹¶æ·»åŠ æ‘˜è¦</span></span><br><span class="line"><span class="type">TokenTextSplitter</span> <span class="variable">splitter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TokenTextSplitter</span>(<span class="number">500</span>, <span class="number">50</span>);</span><br><span class="line">List&lt;Document&gt; splitDocuments = splitter.apply(documents);</span><br><span class="line"></span><br><span class="line"><span class="type">SummaryMetadataEnricher</span> <span class="variable">enricher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SummaryMetadataEnricher</span>(chatModel, </span><br><span class="line">    List.of(SummaryType.CURRENT));</span><br><span class="line">List&lt;Document&gt; enrichedDocuments = enricher.apply(splitDocuments);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ è½½ï¼šå†™å…¥å‘é‡æ•°æ®åº“</span></span><br><span class="line">vectorStore.write(enrichedDocuments);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…ä½¿ç”¨é“¾å¼è°ƒç”¨</span></span><br><span class="line">vectorStore.write(enricher.apply(splitter.apply(pdfReader.read())));</span><br></pre></td></tr></table></figure>



<h3 id="å‘é‡è½¬æ¢ä¸å­˜å‚¨"><a href="#å‘é‡è½¬æ¢ä¸å­˜å‚¨" class="headerlink" title="å‘é‡è½¬æ¢ä¸å­˜å‚¨"></a>å‘é‡è½¬æ¢ä¸å­˜å‚¨</h3><h4 id="VectorStoreæ¥å£"><a href="#VectorStoreæ¥å£" class="headerlink" title="VectorStoreæ¥å£"></a>VectorStoreæ¥å£</h4><p>å®˜æ–¹æä¾›å‘é‡æ•°æ®åº“æ¥å£<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs.html">VectorStore</a>æ–¹ä¾¿æ¥å…¥ç¬¬ä¸‰æ–¹å‘é‡å­˜å‚¨ï¼ŒMilvusã€Redisã€PGVectorã€Elasticsearchç­‰ï¼Œæä¾›åŸºæœ¬çš„crudä»¥åŠè®¡ç®—ç›¸ä¼¼åº¦ è·å–åŸç”Ÿå®¢æˆ·ç«¯çš„æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VectorStore</span> <span class="keyword">extends</span> <span class="title class_">DocumentWriter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(List&lt;Document&gt; documents)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(List&lt;String&gt; idList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Filter.Expression filterExpression)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(String filterExpression)</span> &#123; ... &#125;;</span><br><span class="line"></span><br><span class="line">    List&lt;Document&gt; <span class="title function_">similaritySearch</span><span class="params">(String query)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;Document&gt; <span class="title function_">similaritySearch</span><span class="params">(SearchRequest request)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> &lt;T&gt; Optional&lt;T&gt; <span class="title function_">getNativeClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpringAIæä¾›äº†SearchRequestç±»ï¼Œæ„å»ºç›¸ä¼¼åº¦æœç´¢è¯·æ±‚</p>
<ul>
<li>queryï¼šæœç´¢æŸ¥è¯¢æ–‡æœ¬</li>
<li>topKï¼šæœ€å¤§ç»“æœæ•°ï¼Œé»˜è®¤4</li>
<li>similarityThresholdï¼šè¿‡æ»¤æ‰ä½äºé˜ˆå€¼çš„ç›¸ä¼¼åº¦</li>
<li>filterExpressionï¼šåŸºäºæ–‡æ¡£å…ƒæ•°æ®çš„è¿‡æ»¤ï¼Œè¯­æ³•ç±»ä¼¼SQLï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ä¸­<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs.html#metadata-filters">æŸ¥é˜…è¯­æ³•</a>å³å¯</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> SearchRequest.builder()</span><br><span class="line">    .query(<span class="string">&quot;æé—®å†…å®¹ï¼Ÿ&quot;</span>)</span><br><span class="line">    .topK(<span class="number">5</span>)                  <span class="comment">// è¿”å›æœ€ç›¸ä¼¼çš„5ä¸ªç»“æœ</span></span><br><span class="line">    .similarityThreshold(<span class="number">0.7</span>) <span class="comment">// ç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œ0.0-1.0ä¹‹é—´</span></span><br><span class="line">    .filterExpression(<span class="string">&quot;category == &#x27;web&#x27; AND date &gt; &#x27;2025-05-03&#x27;&quot;</span>)  <span class="comment">// è¿‡æ»¤è¡¨è¾¾å¼</span></span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">List&lt;Document&gt; results = vectorStore.similaritySearch(request);</span><br></pre></td></tr></table></figure>

<h4 id="å‘é‡å­˜å‚¨å·¥ä½œæœºåˆ¶"><a href="#å‘é‡å­˜å‚¨å·¥ä½œæœºåˆ¶" class="headerlink" title="å‘é‡å­˜å‚¨å·¥ä½œæœºåˆ¶"></a>å‘é‡å­˜å‚¨å·¥ä½œæœºåˆ¶</h4><ul>
<li>åµŒå…¥è½¬æ¢ï¼šé€šè¿‡åµŒå…¥æ¨¡å‹å°†æ–‡æœ¬è½¬æ¢ä¸ºåµŒå…¥å‘é‡</li>
<li>ç›¸ä¼¼åº¦è®¡ç®—ï¼šæŸ¥è¯¢æ–‡æœ¬è½¬åŒ–ä¸ºå‘é‡ï¼Œè®¡ç®—è¯¥å‘é‡å’Œå‘é‡æ•°æ®åº“ä¸­çš„ç›¸ä¼¼åº¦</li>
<li>ç›¸ä¼¼åº¦åº¦é‡ï¼šä½™å¼¦ç›¸ä¼¼åº¦ã€æ¬§å¼è·ç¦»ã€ç‚¹ç§¯ç­‰</li>
<li>è¿‡æ»¤å’Œæ’åºï¼šé€šè¿‡ç›¸ä¼¼åº¦è¿‡æ»¤ç»“æœï¼Œè¿”å›topKæœ€ç›¸å…³çš„æ–‡æ¡£</li>
</ul>
<h4 id="å‘é‡æ•°æ®åº“å­˜å‚¨æ•°æ®åº“å®æˆ˜"><a href="#å‘é‡æ•°æ®åº“å­˜å‚¨æ•°æ®åº“å®æˆ˜" class="headerlink" title="å‘é‡æ•°æ®åº“å­˜å‚¨æ•°æ®åº“å®æˆ˜"></a>å‘é‡æ•°æ®åº“å­˜å‚¨æ•°æ®åº“å®æˆ˜</h4><p>å¼€å‘æ€è·¯ï¼šå‡†å¤‡æ•°æ®æºâ€”&gt;å¼•å…¥æ•´åˆåŒ…â€“&gt;ç¼–å†™é…ç½®â€”&gt; ä½¿ç”¨è‡ªåŠ¨æ³¨å…¥çš„VectorStore</p>
<p>è¿™é‡Œä½¿ç”¨é˜¿é‡ŒDashScopeé›†æˆçš„VectorStore APIæ¥è¿œç¨‹è®¿é—®é˜¿é‡Œäº‘çš„è¿œç¨‹å‘é‡å­˜å‚¨ã€‚</p>
<p>åŸºäºPGVectoræ¥å®ç°å‘é‡å­˜å‚¨ï¼Œæ˜¯PostgreSQLçš„æ‹“å±•</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cloud.baidu.com/article/3229759">LinuxæœåŠ¡å™¨å¿«é€Ÿå®‰è£…PostgreSQL 15ä¸pgvectorå‘é‡æ’ä»¶</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29213799/article/details/146277755">å®å¡” PostgreSQL å®‰è£… pgvector æ’ä»¶å®ç°å‘é‡å­˜å‚¨</a></li>
<li>æˆ–è€…ä½¿ç”¨é˜¿é‡Œäº‘çš„<a target="_blank" rel="noopener" href="https://rdsnext.console.aliyun.com/rdsList/cn-hangzhou">serverlessæœåŠ¡</a>ï¼Œéšç”¨éšåœ</li>
</ul>
<p>å‚è€ƒ<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/pgvector.html">å®˜æ–¹æ–‡æ¡£</a>å¼•å…¥ä¾èµ–ï¼Œ<a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.springframework.ai/spring-ai-starter-vector-store-pgvector">ä»“åº“åœ°å€</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-starter-vector-store-pgvector<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-M7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨ï¼šç»´åº¦å°½é‡ä¸è¦éšæ„ä¿®æ”¹ï¼Œå¦åˆ™è¦é‡æ–°å»ºè¡¨</p>
<p>æŒ‰ç…§å®˜æ–¹çš„è¯´æ³•ï¼Œä½¿ç”¨è‡ªåŠ¨æ³¨å…¥çš„VectorStoreï¼Œç³»ç»Ÿå³å¯è‡ªåŠ¨åˆ›å»ºåº“è¡¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">VectorStore vectorStore;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">List&lt;Document&gt; documents = List.of(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Document</span>(<span class="string">&quot;Spring AI rocks!! Spring AI rocks!! Spring AI rocks!! Spring AI rocks!! Spring AI rocks!!&quot;</span>, Map.of(<span class="string">&quot;meta1&quot;</span>, <span class="string">&quot;meta1&quot;</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Document</span>(<span class="string">&quot;The World is Big and Salvation Lurks Around the Corner&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Document</span>(<span class="string">&quot;You walk forward facing the past and you turn back toward the future.&quot;</span>, Map.of(<span class="string">&quot;meta2&quot;</span>, <span class="string">&quot;meta2&quot;</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the documents to PGVector</span></span><br><span class="line">vectorStore.add(documents);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Retrieve documents similar to a query</span></span><br><span class="line">List&lt;Document&gt; results = <span class="built_in">this</span>.vectorStore.similaritySearch(SearchRequest.builder().query(<span class="string">&quot;Spring&quot;</span>).topK(<span class="number">5</span>).build());</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æˆ‘ä»¬ä¹‹å‰åŒæ—¶å¼•å…¥äº†Ollamaå’ŒDashScopeçš„ä¾èµ–ï¼Œå¯¼è‡´æœ‰ä¸¤ä¸ªEmbeddingModelçš„Beanï¼Œå¯¼è‡´è‡ªåŠ¨æ³¨å…¥æŠ¥é”™ï¼Œæ‰€ä»¥ä¸é‡‡ç”¨åŸå…ˆçš„è‡ªåŠ¨æ³¨å…¥çš„æ–¹å¼ï¼Œä½¿ç”¨æ‰‹åŠ¨æ³¨å…¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication(exclude = PgVectorStoreAutoConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">YuAiAgentApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(YuAiAgentApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¼å…¥éœ€è¦çš„ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.postgresql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>postgresql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-pgvector-store<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-M6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ„é€ PgVectorStore</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PgVectorVectorStoreConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> VectorStore <span class="title function_">pgVectorVectorStore</span><span class="params">(JdbcTemplate jdbcTemplate, EmbeddingModel dashscopeEmbeddingModel)</span> &#123;</span><br><span class="line">        <span class="type">VectorStore</span> <span class="variable">vectorStore</span> <span class="operator">=</span> PgVectorStore.builder(jdbcTemplate, dashscopeEmbeddingModel)</span><br><span class="line">                .dimensions(<span class="number">1536</span>)                    <span class="comment">// Optional: defaults to model dimensions or 1536</span></span><br><span class="line">                .distanceType(COSINE_DISTANCE)       <span class="comment">// Optional: defaults to COSINE_DISTANCE</span></span><br><span class="line">                .indexType(HNSW)                     <span class="comment">// Optional: defaults to HNSW</span></span><br><span class="line">                .initializeSchema(<span class="literal">true</span>)              <span class="comment">// Optional: defaults to false</span></span><br><span class="line">                .schemaName(<span class="string">&quot;public&quot;</span>)                <span class="comment">// Optional: defaults to &quot;public&quot;</span></span><br><span class="line">                .vectorTableName(<span class="string">&quot;vector_store&quot;</span>)     <span class="comment">// Optional: defaults to &quot;vector_store&quot;</span></span><br><span class="line">                .maxDocumentBatchSize(<span class="number">10000</span>)         <span class="comment">// Optional: defaults to 10000</span></span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> vectorStore;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å•å…ƒæµ‹è¯•æ•ˆæœ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PgVectorStoreTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    VectorStore pgVectorVectorStore;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    LoveAppDocumentLoader loveAppDocumentLoader;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Document&gt; documents = loveAppDocumentLoader.loadMarkdowns();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add the documents to PGVector</span></span><br><span class="line">        <span class="comment">// åˆ†æ‰¹å¤„ç†æ–‡æ¡£ï¼Œæ¯æ‰¹ä¸è¶…è¿‡10ä¸ª</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; documents.size(); i += batchSize) &#123;</span><br><span class="line">            List&lt;Document&gt; batch = documents.subList(i, Math.min(i + batchSize, documents.size()));</span><br><span class="line">            pgVectorVectorStore.add(batch);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Retrieve documents similar to a query</span></span><br><span class="line">        List&lt;Document&gt; results = <span class="built_in">this</span>.pgVectorVectorStore.similaritySearch(SearchRequest.builder().query(<span class="string">&quot;Spring&quot;</span>).topK(<span class="number">5</span>).build());</span><br><span class="line"></span><br><span class="line">        Assertions.assertNotNull(results);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130172137211.png" alt="image-20260130172137211"></p>
<p>æ•°æ®åº“æµ‹è¯•</p>
<p><img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130172228869.png" alt="image-20260130172228869"></p>
<p>ç”Ÿæˆçš„è¡¨ç»“æ„ï¼Œembedingæ˜¯vectorç±»å‹ï¼Œç¡®å®å­˜å‚¨çš„æ˜¯å‘é‡</p>
<figure class="highlight postgresql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> vector_store</span><br><span class="line">(</span><br><span class="line">    id        <span class="type">uuid</span> <span class="keyword">default</span> uuid_generate_v4() <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    content   <span class="type">text</span>,</span><br><span class="line">    metadata  <span class="type">json</span>,</span><br><span class="line">    embedding vector(<span class="number">1024</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> vector_store</span><br><span class="line">    <span class="keyword">owner</span> <span class="keyword">to</span> ai;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> spring_ai_vector_index</span><br><span class="line">    <span class="keyword">on</span> vector_store <span class="keyword">using</span> hnsw (embedding vector_cosine_ops);</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">PgVectorStore pgVectorVectorStore;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> QueryRewriter queryRewriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">doChatWithRag</span><span class="params">(String message, String chatId)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">reWrittenMessage</span> <span class="operator">=</span> queryRewriter.doQueryRewrite(message);</span><br><span class="line">    <span class="type">ChatResponse</span> <span class="variable">chatResponse</span> <span class="operator">=</span> chatClient</span><br><span class="line">            .prompt()</span><br><span class="line">            .user(reWrittenMessage)</span><br><span class="line">            .advisors(spec -&gt; spec.param(ChatMemory.CONVERSATION_ID, chatId))</span><br><span class="line">            <span class="comment">// å¼€å¯æ—¥å¿—ï¼Œä¾¿äºè§‚å¯Ÿæ•ˆæœ</span></span><br><span class="line">            .advisors(<span class="keyword">new</span> <span class="title class_">LogAdvisor</span>())</span><br><span class="line">            <span class="comment">// åº”ç”¨æœ¬åœ°çŸ¥è¯†åº“é—®ç­”</span></span><br><span class="line">            <span class="comment">// .advisors(QuestionAnswerAdvisor.builder(loveAppVectorStore).build())</span></span><br><span class="line">            <span class="comment">// åº”ç”¨å¢å¼ºæ£€ç´¢æœåŠ¡ï¼ˆäº‘çŸ¥è¯†åº“æœåŠ¡ï¼‰</span></span><br><span class="line">            <span class="comment">// .advisors(loveAppRagCloudAdvisor)</span></span><br><span class="line">            <span class="comment">// åº”ç”¨åŸºäºpgStoreå‘é‡å­˜å‚¨</span></span><br><span class="line">            .advisors(<span class="keyword">new</span> <span class="title class_">QuestionAnswerAdvisor</span>(pgVectorVectorStore))</span><br><span class="line">            .call()</span><br><span class="line">            .chatResponse();</span><br><span class="line">    <span class="keyword">return</span> chatResponse.getResult().getOutput().getText();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>å‘ç°é€šè¿‡<code>QuestionAnswerAdvisor</code>ç¡®å®åŠ å…¥äº†PGVectorä¸­å­˜å‚¨çš„ä¿¡æ¯</p>
<p><img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130172953421.png" alt="image-20260130172953421"></p>
<h4 id="æ‰¹å¤„ç†ä¼˜åŒ–"><a href="#æ‰¹å¤„ç†ä¼˜åŒ–" class="headerlink" title="æ‰¹å¤„ç†ä¼˜åŒ–"></a>æ‰¹å¤„ç†ä¼˜åŒ–</h4><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šå¤„ç†å¤§é‡æ–‡æ¡£ï¼Œè€Œä¸€èˆ¬åµŒå…¥æ¨¡å‹ä¼šæœ‰ä¸€ä¸ªä¸Šä¸‹æ–‡çš„æœ€å¤§æ ‡è®°é™åˆ¶ï¼Œå³ä¸Šä¸‹æ–‡çª—å£å¤§å°ï¼ˆcontext window sizeï¼‰ï¼Œä»è€Œé™åˆ¶äº†å•ä¸ªåµŒå…¥è¯·æ±‚å¯ä»¥å¤„ç†çš„æ–‡æœ¬é‡ï¼Œå¦‚æœä¸€æ¬¡æ€§è°ƒç”¨å¤ªå¤šå¯èƒ½ä¼šå‡ºç°æŠ¥é”™ï¼Œå¯èƒ½å‡ºç°æ•°æ®ä¸å®Œæ•´çš„é—®é¢˜ã€‚</p>
<p>è§£å†³æ€è·¯æ˜¯ä½¿ç”¨æ‰¹å¤„ç†çš„ç­–ç•¥ï¼Œå°†æ–‡æ¡£åˆ†è§£æˆè‹¥å¹²å°æ‰¹æ¬¡ï¼Œé€‚åˆåµŒå…¥æ¨¡å‹çš„ä¸Šä¸‹æ–‡æœ€å¤§çª—å£å¤§å°ï¼Œå¯ä»¥æé«˜æ€§èƒ½ï¼Œå¹¶ä¸”æ›´æœ‰æ•ˆåˆ©äºAPIé€Ÿç‡é™åˆ¶ã€‚</p>
<p>Spring AIå®šä¹‰äº†<code>BatchingStrategy</code>æ¥å£ æä¾›è¯¥åŠŸèƒ½ï¼Œæ˜¯åŸºäºæ–‡æ¡£çš„æ ‡è®°è®¡æ•°ï¼Œæ¥å®ç°åˆ†æ‰¹å¤„ç†æ–‡æ¡£çš„</p>
<ul>
<li>bastchæ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªæ–‡æ¡£åˆ—è¡¨ï¼Œåˆ†è§£æˆä¸€ä¸ªæ–‡æ¡£åˆ†æ‰¹åçš„åˆ—è¡¨</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BatchingStrategy</span> &#123;</span><br><span class="line">    List&lt;List&lt;Document&gt;&gt; <span class="title function_">batch</span><span class="params">(List&lt;Document&gt; documents)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤å®ç°ï¼š<code>customTokenCountBatchingStrategy</code>æ˜¯é€šè¿‡ä¼°ç®—æ–‡æ¡£çš„tokenæ•°ï¼Œåˆ’åˆ†åˆ°ä¸è¶…è¿‡tokenæ•°çš„æ‰¹æ¬¡ä¸­ï¼Œå¦‚æœè¶…å‡ºé™åˆ¶å°±æŠ›å‡ºå¼‚å¸¸ï¼Œä»è€Œä¿è¯æ¯ä¸ªæ‰¹æ¬¡ä¸è¶…è¿‡æœ€å¤§è¾“å…¥tokenæ•°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmbeddingConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> BatchingStrategy <span class="title function_">customTokenCountBatchingStrategy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TokenCountBatchingStrategy</span>(</span><br><span class="line">            EncodingType.CL100K_BASE,  <span class="comment">// æŒ‡å®šç¼–ç ç±»å‹</span></span><br><span class="line">            <span class="number">8000</span>,                      <span class="comment">// è®¾ç½®æœ€å¤§è¾“å…¥æ ‡è®°è®¡æ•°</span></span><br><span class="line">            <span class="number">0.1</span>                        <span class="comment">// è®¾ç½®ä¿ç•™ç™¾åˆ†æ¯”</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ ¹æ®ä¸šåŠ¡éœ€æ±‚å¯ä»¥è‡ªå®šä¹‰å®ç°ï¼Œå¦‚æ•°æ®åº“æ¯ç§’åªèƒ½æ’å…¥1wæ¡æ•°æ®ï¼Œé€šè¿‡è¿™ä¸ªå¯ä»¥æ§åˆ¶é€Ÿç‡ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œé¢å¤–çš„æ—¥å¿—è®°å½•å’Œå¼‚å¸¸å¤„ç†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmbeddingConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> BatchingStrategy <span class="title function_">customBatchingStrategy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomBatchingStrategy</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="æ–‡æ¡£è¿‡æ»¤ä¸æ£€ç´¢"><a href="#æ–‡æ¡£è¿‡æ»¤ä¸æ£€ç´¢" class="headerlink" title="æ–‡æ¡£è¿‡æ»¤ä¸æ£€ç´¢"></a>æ–‡æ¡£è¿‡æ»¤ä¸æ£€ç´¢</h3><p>æ–‡æ¡£è¿‡æ»¤å¯ä»¥æ‹†åˆ†ä¸ºï¼šæ£€ç´¢å‰ã€æ£€ç´¢æ—¶ã€æ£€ç´¢åï¼Œåˆ†åˆ«é’ˆå¯¹æ¯ä¸ªé˜¶æ®µæä¾›äº†å¯è‡ªå®šä¹‰çš„ç»„ä»¶ã€‚</p>
<ul>
<li>åœ¨é¢„æ£€ç´¢é˜¶æ®µï¼Œç³»ç»Ÿæ¥æ”¶ç”¨æˆ·çš„åŸå§‹æŸ¥è¯¢ï¼Œé€šè¿‡æŸ¥è¯¢è½¬æ¢å’ŒæŸ¥è¯¢æ‰©å±•ç­‰æ–¹æ³•å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œè¾“å‡ºå¢å¼ºçš„ç”¨æˆ·æŸ¥è¯¢ã€‚</li>
<li>åœ¨æ£€ç´¢é˜¶æ®µï¼Œç³»ç»Ÿä½¿ç”¨å¢å¼ºçš„æŸ¥è¯¢ä»çŸ¥è¯†åº“ä¸­æœç´¢ç›¸å…³æ–‡æ¡£ï¼Œå¯èƒ½æ¶‰åŠå¤šä¸ªæ£€ç´¢æºçš„åˆå¹¶ï¼Œæœ€ç»ˆè¾“å‡ºä¸€ç»„ç›¸å…³æ–‡æ¡£ã€‚</li>
<li>åœ¨æ£€ç´¢åé˜¶æ®µï¼Œç³»ç»Ÿå¯¹æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼ŒåŒ…æ‹¬æ’åºã€é€‰æ‹©æœ€ç›¸å…³çš„å­é›†ä»¥åŠå‹ç¼©æ–‡æ¡£å†…å®¹ï¼Œè¾“ å‡ºç»è¿‡ä¼˜åŒ–çš„ç›¸å…³æ–‡æ¡£é›†ã€‚</li>
</ul>
<h4 id="é¢„æ£€ç´¢ï¼šå¢å¼ºç”¨æˆ·è¾“å…¥"><a href="#é¢„æ£€ç´¢ï¼šå¢å¼ºç”¨æˆ·è¾“å…¥" class="headerlink" title="é¢„æ£€ç´¢ï¼šå¢å¼ºç”¨æˆ·è¾“å…¥"></a>é¢„æ£€ç´¢ï¼šå¢å¼ºç”¨æˆ·è¾“å…¥</h4><ul>
<li>æŸ¥è¯¢é‡å†™è½¬æ¢å™¨<code>RewriteQueryTransformer</code>ï¼Œå¯¹ç”¨æˆ·åŸå§‹è¾“å…¥è¿›è¡Œæ”¹å†™ï¼Œä½¿å¾—æ›´åŠ æ¸…æ™°å’Œè¯¦ç»†ï¼Œåœ¨ç”¨æˆ·è¾“å…¥ä¸€äº›å«ç³Šæˆ–è€…æ¨¡ç³Šä¿¡æ¯æ—¶éå¸¸æœ‰ç”¨<ul>
<li>åŸç†å°±æ˜¯å†…éƒ¨æä¾›äº†æ”¹å†™æç¤ºè¯ï¼Œæˆ–è€…é€šè¿‡æ„é€ æ–¹æ³•çš„promptTemplateå‚æ•°è‡ªå®šä¹‰ç»„ä»¶æ¨¡æ¿</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Query</span>(<span class="string">&quot;å•¥æ˜¯bananaå•Šå•Šå•Šå•Šï¼Ÿ!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">QueryTransformer</span> <span class="variable">queryTransformer</span> <span class="operator">=</span> RewriteQueryTransformer.builder()</span><br><span class="line">        .chatClientBuilder(chatClientBuilder)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"><span class="type">Query</span> <span class="variable">transformedQuery</span> <span class="operator">=</span> queryTransformer.transform(query);</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¿»è¯‘è½¬æ¢å™¨<code>TranslationQueryTransformer</code>ï¼Œç¿»è¯‘ä¸ºæ¨¡å‹æ”¯æŒçš„ç›®æ ‡è¯­è¨€ï¼Œé’ˆå¯¹ç‰¹å®šè¯­è¨€è®­ç»ƒçš„æ¨¡å‹è€Œæç¤ºè¯ä¸æ˜¯ç›®æ ‡è¯­è¨€ï¼Œéå¸¸æœ‰ç”¨<ul>
<li>åŸç†ä¹Ÿæ˜¯é€šè¿‡ä¸€æ®µpromptå®ç°ï¼Œä½†å»ºè®®å®é™…ç”¨ç¬¬ä¸‰æ–¹ç¿»è¯‘è„šæœ¬ï¼Œæˆæœ¬ç›¸å¯¹AIè°ƒç”¨ä¼šæ›´ä½ä¸€äº›</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Query</span>(<span class="string">&quot;hi, who is coder aaa? please answer me&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">QueryTransformer</span> <span class="variable">queryTransformer</span> <span class="operator">=</span> TranslationQueryTransformer.builder()</span><br><span class="line">        .chatClientBuilder(chatClientBuilder)</span><br><span class="line">        .targetLanguage(<span class="string">&quot;chinese&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"><span class="type">Query</span> <span class="variable">transformedQuery</span> <span class="operator">=</span> queryTransformer.transform(query);</span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥è¯¢å‹ç¼©å™¨<code>CompressionQueryTransformer</code>ï¼Œå°†å¤§è¯­è¨€æ¨¡å‹çš„å¯¹è¯å†å²å’Œåç»­æŸ¥è¯¢å‹ç¼©ä¸ºä¸€ä¸ªç‹¬ç«‹æŸ¥è¯¢ï¼Œé€‚åˆè¾ƒé•¿å¯¹è¯ï¼Œä¸”åç»­ä¸Šä¸‹æ–‡ç›¸å…³çš„åœºæ™¯ï¼ŒåŸç†åŒä¸Š</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> Query.builder()</span><br><span class="line">        .text(<span class="string">&quot;è¿™ä¸ªç½‘ç«™æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span>)</span><br><span class="line">        .history(<span class="keyword">new</span> <span class="title class_">UserMessage</span>(<span class="string">&quot;è°æ˜¯ç™¾åº¦çš„åˆ›å§‹äººï¼Ÿï¼Ÿ&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AssistantMessage</span>(<span class="string">&quot;ç™¾åº¦çš„åˆ›å§‹äººæ˜¯abc&quot;</span>))</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"><span class="type">QueryTransformer</span> <span class="variable">queryTransformer</span> <span class="operator">=</span> CompressionQueryTransformer.builder()</span><br><span class="line">        .chatClientBuilder(chatClientBuilder)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"><span class="type">Query</span> <span class="variable">transformedQuery</span> <span class="operator">=</span> queryTransformer.transform(query);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>å¤šæŸ¥è¯¢æ‹“å±•ï¼Œå°†å¤§è¯­è¨€æ¨¡å‹æ‰©å±•ä¸ºå¤šä¸ªè¯­ä¹‰çš„ä¸åŒå˜ä½“ï¼Œæœ‰åŠ©äºæ£€ç´¢é¢å¤–ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¹¶æ‰¾åˆ°ç›¸å…³ç»“æœçš„æœºä¼š<ul>
<li>ç†è§£ï¼šæœç´¢å†…å®¹æœä¸åˆ°çš„æ—¶å€™ï¼Œå°è¯•æ¢ä¸€ç§è¡¨è¾¾å°±å¯ä»¥æ‰¾åˆ°æƒ³è¦çš„å†…å®¹</li>
<li>ä¸‹é¢çš„æ¡ˆä¾‹ï¼šå°±ä¼šæ‹“å±•ä¸º ç»™å‡ºç™¾åº¦è¿™å®¶å…¬å¸çš„å…¬å¸ç®€ä»‹ï¼Œä»¥åŠæ ¸å¿ƒä¸šåŠ¡</li>
<li>é»˜è®¤æ˜¯åŒ…å«åŸå§‹æŸ¥è¯¢çš„ï¼Œé€šè¿‡<code>includeOriginal(false)</code>å¯ä»¥ä¸åŒ…å«</li>
<li>æºç ä¸­é€šè¿‡AIè·å¾—æ‹“å±•ï¼Œæ ¹æ®æ¢è¡Œç¬¦åˆ†å‰²</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">MultiQueryExpander</span> <span class="variable">queryExpander</span> <span class="operator">=</span> MultiQueryExpander.builder()</span><br><span class="line">    .chatClientBuilder(chatClientBuilder)</span><br><span class="line">    .numberOfQueries(<span class="number">3</span>)</span><br><span class="line">    .build();</span><br><span class="line">List&lt;Query&gt; queries = queryExpander.expand(<span class="keyword">new</span> <span class="title class_">Query</span>(<span class="string">&quot;å•¥æ˜¯ç™¾åº¦ï¼Ÿç™¾åº¦æ˜¯å¹²å˜›çš„ï¼Ÿ&quot;</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="æ£€ç´¢ï¼šæé«˜æŸ¥è¯¢ç›¸å…³æ€§"><a href="#æ£€ç´¢ï¼šæé«˜æŸ¥è¯¢ç›¸å…³æ€§" class="headerlink" title="æ£€ç´¢ï¼šæé«˜æŸ¥è¯¢ç›¸å…³æ€§"></a>æ£€ç´¢ï¼šæé«˜æŸ¥è¯¢ç›¸å…³æ€§</h4><blockquote>
<p>æ–‡æ¡£æ£€ç´¢å™¨ <code>DocumentRetrever</code></p>
</blockquote>
<p>SpringAIå®˜æ–¹æœ‰ä¸€ä¸ªæ–‡æ¡£æ£€ç´¢å™¨<code>DocumentRetrever</code>ï¼Œä¸åŒçš„å­˜å‚¨æ–¹æ¡ˆä¹Ÿæœ‰è‡ªèº«çš„æ£€ç´¢å™¨å®ç°ç±»ï¼Œå¦‚VectorStoreDocumentRetrieverï¼Œå¯å®ç°åŸºäºå…ƒæ•°æ®çš„è¿‡æ»¤ã€ç›¸ä¼¼åº¦é˜ˆå€¼ã€è¿”å›ç»“æœæ•°çš„æœç´¢å‚æ•°</p>
<ul>
<li><p>é€šè¿‡<code>filterExpression</code>å¯ä»¥çµæ´»æŒ‡å®šè¿‡æ»¤æ¡ä»¶ï¼Œå¦å¤–ä¹Ÿæä¾›äº†Queryå¯¹è±¡çš„<code>FILTER_EXPRESSION</code>è¿‡æ»¤è¡¨è¾¾å¼å‚æ•°</p>
<ul>
<li><pre><code class="language-java">Query query = Query.builder()
    .text(&quot;ç™¾åº¦åˆ›å§‹äººæ˜¯è°ï¼Ÿ&quot;)
    .context(Map.of(VectorStoreDocumentRetriever.FILTER_EXPRESSION, &quot;type == &#39;boy&#39;&quot;))
    .build();
List&lt;Document&gt; retrievedDocuments = documentRetriever.retrieve(query);
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">```java</span><br><span class="line">DocumentRetriever retriever = VectorStoreDocumentRetriever.builder()</span><br><span class="line">    .vectorStore(vectorStore)</span><br><span class="line">    .similarityThreshold(0.7)</span><br><span class="line">    .topK(5)</span><br><span class="line">    .filterExpression(new FilterExpressionBuilder()</span><br><span class="line">        .eq(&quot;type&quot;, &quot;web&quot;)</span><br><span class="line">        .build())</span><br><span class="line">    .build();</span><br><span class="line">List&lt;Document&gt; documents = retriever.retrieve(new Query(&quot;è°æ˜¯ç¨‹åºå‘˜é±¼çš®&quot;));</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>æ–‡æ¡£åˆå¹¶<code> documentJoiner</code></p>
</blockquote>
<p>SpringAIå†…ç½®documentJoineråˆå¹¶å™¨ï¼Œé€šè¿‡è¿æ¥æ“ä½œï¼Œå°†å¤šä¸ªæŸ¥è¯¢å’Œå¤šä¸ªæ•°æ®æºåˆå¹¶ä¸ºå•ä¸ªæ–‡æ¡£é›†åˆï¼ˆé‡å¤æ–‡æ¡£ä¿ç•™é¦–æ¬¡å‡ºç°çš„ï¼‰</p>
<ul>
<li>åœ¨æºç ä¸­ï¼Œè¿æ¥çš„æ€è·¯å°±æ˜¯å°†Mapå±•å¼€æˆäºŒç»´åˆ—è¡¨ï¼Œå†å°†äºŒç»´åˆ—è¡¨å±•å¼€æ–‡æ¡£åˆ—è¡¨ï¼Œæœ€åå»é‡ï¼Œç”¨äº†ä¼˜é›…çš„Streamæµæ–¹æ³•å®ç°</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;Query, List&lt;List&lt;Document&gt;&gt;&gt; documentsForQuery = ...</span><br><span class="line"><span class="type">DocumentJoiner</span> <span class="variable">documentJoiner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcatenationDocumentJoiner</span>();</span><br><span class="line">List&lt;Document&gt; documents = documentJoiner.join(documentsForQuery);</span><br></pre></td></tr></table></figure>



<h4 id="æ£€ç´¢åï¼šä¼˜åŒ–æ–‡æ¡£å¤„ç†"><a href="#æ£€ç´¢åï¼šä¼˜åŒ–æ–‡æ¡£å¤„ç†" class="headerlink" title="æ£€ç´¢åï¼šä¼˜åŒ–æ–‡æ¡£å¤„ç†"></a>æ£€ç´¢åï¼šä¼˜åŒ–æ–‡æ¡£å¤„ç†</h4><p>å¤„ç†æ£€ç´¢çš„æ–‡æ¡£ï¼Œä»è€Œè·å¾—æœ€ä½³çš„ç»“æœï¼Œè§£å†³çš„é—®é¢˜ï¼šâ€œä¸¢å¤±åœ¨ä¸­é—´â€œçš„é—®é¢˜ï¼ˆç”±äºæ¨¡å‹ä¸Šä¸‹æ–‡é™åˆ¶ã€æ£€ç´¢ä¿¡æ¯ä¸­çš„å™ªéŸ³æˆ–å†—ä½™ç­‰ï¼‰</p>
<p>å…·ä½“çš„æ–¹å¼ï¼š</p>
<ul>
<li>æ ¹æ®æŸ¥è¯¢ç›¸å…³æ€§å¯¹æ–‡æ¡£æ’åº</li>
<li>åˆ é™¤ä¸ç›¸å…³&#x2F;å†—ä½™æ–‡æ¡£</li>
<li>å‹ç¼©æ¯ä¸ªæ–‡æ¡£å†…å®¹å‡å°‘å™ªéŸ³&#x2F;å†—ä½™</li>
</ul>
<blockquote>
<p>è¿™ä¸€éƒ¨åˆ†ä¸æ˜¯å®é™…çš„é‡ç‚¹ï¼Œä¸”è¿­ä»£é€Ÿåº¦éå¸¸å¿«ã€‚å¦‚åœ¨M8ç‰ˆæœ¬å¼•å…¥äº†DocumentPostProcessor</p>
</blockquote>
<h3 id="æŸ¥è¯¢å¢å¼ºä¸å…³è”"><a href="#æŸ¥è¯¢å¢å¼ºä¸å…³è”" class="headerlink" title="æŸ¥è¯¢å¢å¼ºä¸å…³è”"></a>æŸ¥è¯¢å¢å¼ºä¸å…³è”</h3><p>è¿™æ˜¯RAGæœ€ç»ˆç¼“è§£ï¼Œå°†æ–‡æ¡£å’Œç”¨æˆ·æŸ¥è¯¢ç»“åˆï¼Œä¸ºAIæä¾›ä¸Šä¸‹æ–‡ï¼Œä»è€Œç”Ÿæˆæœ€å‡†ç¡®çš„å›ç­”ã€‚æˆ‘ä»¬çŸ¥é“SpringAIæä¾›äº†ä¸¤ç§æ‹¦æˆªå™¨å®ç°å¢å¼º</p>
<h4 id="QuestionAnswerAdvisor"><a href="#QuestionAnswerAdvisor" class="headerlink" title="QuestionAnswerAdvisor"></a>QuestionAnswerAdvisor</h4><p>AdvisoræŸ¥è¯¢å‘é‡æ•°æ®æ¥è·å–ä¸ç”¨æˆ·é—®é¢˜ç›¸å…³çš„æ–‡æ¡£ï¼Œå°†è¿™äº›æ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡æ·»åŠ åˆ°ç”¨æˆ·æŸ¥è¯¢ä¸­</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> ChatClient.builder(chatModel)</span><br><span class="line">        .build().prompt()</span><br><span class="line">        .advisors(<span class="keyword">new</span> <span class="title class_">QuestionAnswerAdvisor</span>(vectorStore))</span><br><span class="line">        .user(userText)</span><br><span class="line">        .call()</span><br><span class="line">        .chatResponse();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿›é˜¶ç”¨æ³•ï¼Œå»ºé€ è€…æ¨¡å¼æ¥é…ç½®æ›´ç²¾ç»†çš„å‚æ•°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">qaAdvisor</span> <span class="operator">=</span> QuestionAnswerAdvisor.builder(vectorStore)</span><br><span class="line">              <span class="comment">// ç›¸ä¼¼åº¦é˜ˆå€¼ä¸º 0.8ï¼Œå¹¶è¿”å›æœ€ç›¸å…³çš„å‰ 6 ä¸ªç»“æœ</span></span><br><span class="line">        .searchRequest(SearchRequest.builder().similarityThreshold(<span class="number">0.8d</span>).topK(<span class="number">6</span>).build())</span><br><span class="line">        .build();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿›é˜¶ç”¨æ³•2ï¼ŒåŠ¨æ€è¿‡æ»¤è¡¨è¾¾å¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ChatClient</span> <span class="variable">chatClient</span> <span class="operator">=</span> ChatClient.builder(chatModel)</span><br><span class="line">    .defaultAdvisors(QuestionAnswerAdvisor.builder(vectorStore)</span><br><span class="line">        .searchRequest(SearchRequest.builder().build())</span><br><span class="line">        .build())</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨è¿è¡Œæ—¶æ›´æ–°è¿‡æ»¤è¡¨è¾¾å¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="built_in">this</span>.chatClient.prompt()</span><br><span class="line">    .user(<span class="string">&quot;çœ‹ç€æˆ‘çš„çœ¼ç›ï¼Œå›ç­”æˆ‘ï¼&quot;</span>)</span><br><span class="line">    .advisors(a -&gt; a.param(QuestionAnswerAdvisor.FILTER_EXPRESSION, <span class="string">&quot;type == &#x27;web&#x27;&quot;</span>))</span><br><span class="line">    .call()</span><br><span class="line">    .content();</span><br></pre></td></tr></table></figure>

<p>è¿›é˜¶ç”¨æ³•3ï¼Œè‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿ï¼Œè‡ªä¸»æ§åˆ¶å°†æ£€ç´¢çš„æ–‡æ¡£ä¸ç”¨æˆ·æŸ¥è¯¢ç»“åˆ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">QuestionAnswerAdvisor</span> <span class="variable">qaAdvisor</span> <span class="operator">=</span> QuestionAnswerAdvisor.builder(vectorStore)</span><br><span class="line">    .promptTemplate(customPromptTemplate)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>



<h4 id="RetrievalAugmentationAdvisor"><a href="#RetrievalAugmentationAdvisor" class="headerlink" title="RetrievalAugmentationAdvisor"></a>RetrievalAugmentationAdvisor</h4><p>åœ¨åŸå…ˆåŸºç¡€ä¸Šæä¾›äº†æ›´çµæ´»å’Œå®šåˆ¶é€‰é¡¹ï¼Œåœ¨è¯¥æ¡ˆä¾‹ä¸­ï¼š</p>
<ul>
<li>é€šè¿‡æ„é€ è€…æ¨¡å¼åœ¨æ£€ç´¢å¢å¼ºå™¨ä¸­ï¼ŒæŒ‡å®šæ–‡æ¡£æ£€ç´¢å™¨<code>VectorStoreDocumentRetriever</code>ï¼Œæ¥ä»å‘é‡æ•°æ®åº“æ£€ç´¢æ–‡æ¡£</li>
<li>å°†è¯¥Advvisoræ·»åŠ åˆ°ChatClientè¯·æ±‚ä¸­ï¼Œå³å¯ç”Ÿæ•ˆRAG</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Advisor</span> <span class="variable">retrievalAugmentationAdvisor</span> <span class="operator">=</span> RetrievalAugmentationAdvisor.builder()</span><br><span class="line">        .documentRetriever(VectorStoreDocumentRetriever.builder()</span><br><span class="line">                .similarityThreshold(<span class="number">0.50</span>)</span><br><span class="line">                .vectorStore(vectorStore)</span><br><span class="line">                .build())</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">        .advisors(retrievalAugmentationAdvisor)</span><br><span class="line">        .user(question)</span><br><span class="line">        .call()</span><br><span class="line">        .content();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿›é˜¶ç”¨æ³•ï¼Œå¯ä»¥åœ¨RAGä¸­é…åˆæŸ¥è¯¢è½¬æ¢å™¨</p>
<ul>
<li>æ„é€ è€…æ¨¡å¼çš„å†…éƒ¨é€šè¿‡æ„é€ è€…åˆæ„å»ºäº†ä¸€ä¸ª<code>RewriteQueryTransformer</code>ï¼Œå®ç°åœ¨æ£€ç´¢å‰é‡å†™åŸå§‹æŸ¥è¯¢ï¼Œæé«˜æ£€ç´¢è´¨é‡ï¼ˆè§£å†³ç”¨æˆ·é—®é¢˜å«ç³Šçš„é—®é¢˜ï¼‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Advisor</span> <span class="variable">retrievalAugmentationAdvisor</span> <span class="operator">=</span> RetrievalAugmentationAdvisor.builder()</span><br><span class="line">        .queryTransformers(RewriteQueryTransformer.builder()</span><br><span class="line">                .chatClientBuilder(chatClientBuilder.build().mutate())</span><br><span class="line">                .build())</span><br><span class="line">        .documentRetriever(VectorStoreDocumentRetriever.builder()</span><br><span class="line">                .similarityThreshold(<span class="number">0.50</span>)</span><br><span class="line">                .vectorStore(vectorStore)</span><br><span class="line">                .build())</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>



<h5 id="ç©ºä¸Šä¸‹æ–‡çš„å¤„ç†"><a href="#ç©ºä¸Šä¸‹æ–‡çš„å¤„ç†" class="headerlink" title="ç©ºä¸Šä¸‹æ–‡çš„å¤„ç†"></a>ç©ºä¸Šä¸‹æ–‡çš„å¤„ç†</h5><p>RetrievalAugmentationAdvisoré»˜è®¤ä¸å…è®¸ä¸Šä¸‹æ–‡ä¸ºç©ºï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡æ¡£ï¼Œä¼šé‡‡å–ä¿å®ˆç­–ç•¥ï¼Œ è®©æ¨¡å‹ä¸è¦å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚</p>
<p>ä½†æ˜¯æœ‰äº›åœºæ™¯ä¸‹ï¼Œå¸Œæœ›åŠæ—¶æ²¡æœ‰çŸ¥è¯†åº“æ”¯æŒï¼Œä¹Ÿèƒ½å›ç­”ä¸€äº›é€šç”¨é—®é¢˜ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡åŒæ ·çš„æ„é€ è€…æ–¹å¼é…ç½®<code>ContextualQueryAugmenter</code>ä¸Šä¸‹æ–‡å¢å¼ºå™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Advisor</span> <span class="variable">retrievalAugmentationAdvisor</span> <span class="operator">=</span> RetrievalAugmentationAdvisor.builder()</span><br><span class="line">        .documentRetriever(VectorStoreDocumentRetriever.builder()</span><br><span class="line">                .similarityThreshold(<span class="number">0.50</span>)</span><br><span class="line">                .vectorStore(vectorStore)</span><br><span class="line">                .build())</span><br><span class="line">        .queryAugmenter(ContextualQueryAugmenter.builder()</span><br><span class="line">                .allowEmptyContext(<span class="literal">true</span>)</span><br><span class="line">                .build())</span><br><span class="line">        .build();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ContextualQueryAugmenterå…è®¸é…ç½®è‡ªå®šä¹‰æç¤ºæ¨¡æ¿ï¼Œå¯ä»¥æŒ‡å¯¼æ¨¡å‹åœ¨æ²¡æœ‰æ‰¾åˆ°æ¨¡å‹æ—¶å¦‚ä½•å›åº”ç”¨æˆ·ï¼Œå¦‚è§£é‡Šæ— æ³•å›ç­”çš„åŸå› ï¼Œå¼•å¯¼ç”¨æˆ·æé—®å…¶ä»–é—®é¢˜æˆ–æä¾›æ›´å¤šä¿¡æ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">QueryAugmenter</span> <span class="variable">queryAugmenter</span> <span class="operator">=</span> ContextualQueryAugmenter.builder()</span><br><span class="line">        .promptTemplate(customPromptTemplate)</span><br><span class="line">        .emptyContextPromptTemplate(emptyContextPromptTemplate)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure></blockquote>
<h2 id="RAGè¿›é˜¶å®æˆ˜å’Œæœ€ä½³å®è·µ"><a href="#RAGè¿›é˜¶å®æˆ˜å’Œæœ€ä½³å®è·µ" class="headerlink" title="RAGè¿›é˜¶å®æˆ˜å’Œæœ€ä½³å®è·µ"></a>RAGè¿›é˜¶å®æˆ˜å’Œæœ€ä½³å®è·µ</h2><p>ç†è®ºå®Œæ¯•ï¼ŒæŒ‰ç…§æ­¥éª¤å®è·µã€‚</p>
<h3 id="æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²-ETL"><a href="#æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²-ETL" class="headerlink" title="æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²-ETL"></a>æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²-ETL</h3><p>é¦–å…ˆå®ŒæˆETLå·¥ä½œï¼Œè¿™æ˜¯RAGçš„åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦ç¯èŠ‚ï¼Œæ–‡æ¡£è´¨é‡ç›´æ¥å†³å®šAIèƒ½åŠ›çš„ä¸Šé™ï¼Œå…¶ä»–ç­–ç•¥åªæ˜¯ä¸ºäº†é€¼è¿‘ä¸Šé™ã€‚</p>
<h4 id="åŸå§‹æ–‡æ¡£ä¼˜åŒ–"><a href="#åŸå§‹æ–‡æ¡£ä¼˜åŒ–" class="headerlink" title="åŸå§‹æ–‡æ¡£ä¼˜åŒ–"></a>åŸå§‹æ–‡æ¡£ä¼˜åŒ–</h4><p>æ–‡æ¡£è´¨é‡çš„é¦–è¦æ¡ä»¶æ˜¯ä¿è¯<strong>çŸ¥è¯†å®Œå¤‡æ€§</strong>ï¼Œå¦‚æœç¼ºå¤±å†…å®¹ï¼Œå°±æ— æ³•å›ç­”é—®é¢˜ï¼Œéœ€è¦é€šè¿‡æ”¶é›†ç”¨æˆ·åé¦ˆ&#x2F;ç»Ÿè®¡çŸ¥è¯†åº“æ£€ç´¢å‘½ä¸­ç‡ï¼Œä¸æ–­ä¼˜åŒ–çŸ¥è¯†åº“å†…å®¹ã€‚</p>
<ul>
<li>â€œ<code>AIåŸç”Ÿæ–‡æ¡£</code>â€œï¼šéœ€è¦ä¸“é—¨ä¸ºAIçŸ¥è¯†åº“å»ºç«‹æ–‡æ¡£ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹çš„è§„åˆ™è®©å¤§æ¨¡å‹ä¸ºæˆ‘ä»¬çš„æ–‡æ¡£è¿›è¡Œä¼˜åŒ–ã€‚</li>
</ul>
<blockquote>
<p>åœ¨çŸ¥è¯†å®Œæ•´çš„å‰æä¸‹ï¼Œæˆ‘ä»¬è¦æ³¨æ„ 3 ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li>å†…å®¹ç»“æ„åŒ–:</li>
</ol>
<ul>
<li>åŸå§‹æ–‡æ¡£åº”ä¿æŒ<strong>æ’ç‰ˆæ¸…æ™°</strong>ã€ç»“æ„åˆç†ï¼Œå¦‚æ¡ˆä¾‹ç¼–å·ã€é¡¹ç›®æ¦‚è¿°ã€è®¾è®¡è¦ç‚¹ç­‰</li>
<li>æ–‡æ¡£çš„å„çº§æ ‡é¢˜å±‚æ¬¡åˆ†æ˜ï¼Œå„æ ‡é¢˜ä¸‹çš„å†…å®¹è¡¨è¾¾æ¸…æ™°</li>
<li>åˆ—è¡¨ä¸­é—´çš„æŸä¸€æ¡ä¹‹ä¸‹å°½é‡ä¸è¦å†åˆ†çº§ï¼Œ<strong>å‡å°‘å±‚çº§åµŒå¥—</strong></li>
</ul>
<ol start="2">
<li>å†…å®¹è§„èŒƒåŒ–:</li>
</ol>
<ul>
<li>è¯­è¨€ç»Ÿä¸€ï¼šç¡®ä¿<strong>æ–‡æ¡£è¯­è¨€ä¸ç”¨æˆ·æç¤ºè¯ä¸€è‡´</strong>ï¼ˆæ¯”å¦‚è‹±è¯­åœºæ™¯é‡‡ç”¨è‹±æ–‡æ–‡æ¡£ï¼‰ï¼Œä¸“ä¸šæœ¯è¯­å¯è¿›è¡Œå¤šè¯­è¨€æ ‡æ³¨</li>
<li>è¡¨è¿°ç»Ÿä¸€ï¼šåŒä¸€æ¦‚å¿µåº”ä½¿ç”¨<strong>ç»Ÿä¸€è¡¨è¾¾æ–¹å¼</strong>ï¼ˆæ¯”å¦‚ MLã€Machine Learning è§„èŒƒä¸ºâ€œæœºå™¨å­¦ä¹ â€ï¼‰ï¼Œå¯é€šè¿‡å¤§æ¨¡å‹<br>åˆ†æ®µå¤„ç†é•¿æ–‡æ¡£è¾…åŠ©å®Œæˆ</li>
<li><strong>å‡å°‘å™ªéŸ³</strong>ï¼šå°½é‡é¿å…æ°´å°ã€è¡¨æ ¼å’Œå›¾ç‰‡ç­‰å¯èƒ½å½±å“è§£æçš„å…ƒç´ </li>
</ul>
<ol start="3">
<li>æ ¼å¼æ ‡å‡†åŒ–:</li>
</ol>
<ul>
<li>ä¼˜å…ˆä½¿ç”¨ <strong>Markdownã€DOC&#x2F;DOCX ç­‰æ–‡æœ¬æ ¼å¼</strong>ï¼ˆPDF è§£ææ•ˆæœå¯èƒ½ä¸ä½³ï¼‰ï¼Œå¯ä»¥é€šè¿‡ç™¾ç‚¼ DashScopeParse<br>å·¥å…·å°† PDF è½¬ä¸ºMarkdownï¼Œå†å€ŸåŠ©å¤§æ¨¡å‹æ•´ç†æ ¼å¼</li>
<li>å¦‚æœæ–‡æ¡£åŒ…å«å›¾ç‰‡ï¼Œéœ€é“¾æ¥åŒ–å¤„ç†ï¼Œç¡®ä¿å›ç­”ä¸­èƒ½æ­£å¸¸å±•ç¤ºæ–‡æ¡£ä¸­çš„æ’å›¾ï¼Œå¯ä»¥é€šè¿‡åœ¨æ–‡æ¡£ä¸­æ’å…¥å¯å…¬ç½‘è®¿<br>é—®çš„ <strong>URL é“¾æ¥</strong>å®ç°</li>
</ul>
</blockquote>
<h4 id="æ–‡æ¡£åˆ‡ç‰‡"><a href="#æ–‡æ¡£åˆ‡ç‰‡" class="headerlink" title="æ–‡æ¡£åˆ‡ç‰‡"></a>æ–‡æ¡£åˆ‡ç‰‡</h4><p>åˆ‡ç‰‡çš„å°ºå¯¸æ ¹æ®å®é™…è¦è°ƒæ•´ï¼ŒåŸåˆ™ï¼šé¿å…è¿‡çŸ­å¯¼è‡´è¯­ä¹‰ä¸¢å¤±ï¼Œé¿å…è¿‡é•¿å¯¼è‡´å¼•å…¥æ— å…³ä¿¡æ¯ï¼Œå°½é‡å‡å°‘è¯­ä¹‰æˆªæ–­çš„é—®é¢˜ã€‚</p>
<p>å…·ä½“å¯ä»¥æ ¹æ®ä»¥ä¸‹è¦ç´ ï¼š</p>
<ul>
<li>æ–‡æ¡£ç±»å‹ï¼šä¸“ä¸šç±»æ–‡çŒ®å¯ä»¥å¢åŠ é•¿åº¦ä¿ç•™æ›´å¤šä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè€Œç¤¾äº¤ç±»å¸–å­ï¼Œç¼©çŸ­é•¿åº¦å¯ä»¥æ›´ç²¾ç¡®æ•æ‰è¯­ä¹‰</li>
<li>æç¤ºè¯å¤æ‚åº¦ï¼šå¦‚æœå¤æ‚ä¸”å…·ä½“ï¼Œå¯èƒ½éœ€è¦å¢åŠ åˆ‡ç‰‡é•¿åº¦ï¼Œå¦åˆ™ï¼Œè¾ƒçŸ­çš„é•¿åº¦æ›´åˆé€‚</li>
</ul>
<p>æœ€ä½³åˆ‡ç‰‡ç­–ç•¥ï¼šæ™ºèƒ½åˆ†å—ç®—æ³• ï¼ˆæ ¹æ®åˆ†å¥æ ‡è¯†ç¬¦åˆ’åˆ†æ®µè½â€“&gt;æ ¹æ®è¯­ä¹‰åŠ¨æ€é€‰æ‹©åˆ‡ç‰‡ç‚¹ï¼‰+ äººå·¥äºŒæ¬¡æ ¡éªŒ</p>
<p>å®ç°ï¼šé€šè¿‡SpringAIçš„<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html#_tokentextsplitter">ETL pipeline</a>çš„TokenTextSplitterï¼ˆ<code>documentTransformer</code>å®ç°ç±»ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyTokenTextSplitter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">splitDocuments</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="type">TokenTextSplitter</span> <span class="variable">splitter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TokenTextSplitter</span>();</span><br><span class="line">        <span class="keyword">return</span> splitter.apply(documents);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">splitCustomized</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="type">TokenTextSplitter</span> <span class="variable">splitter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TokenTextSplitter</span>(<span class="number">200</span>, <span class="number">100</span>, <span class="number">10</span>, <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> splitter.apply(documents);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åˆ‡ç‰‡å™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> MyTokenTextSplitter myTokenTextSplitter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">VectorStore <span class="title function_">loveAppVectorStore</span><span class="params">(EmbeddingModel dashscopeEmbeddingModel)</span> &#123;</span><br><span class="line">    <span class="type">SimpleVectorStore</span> <span class="variable">simpleVectorStore</span> <span class="operator">=</span> SimpleVectorStore.builder(dashscopeEmbeddingModel)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="comment">// åŠ è½½æ–‡æ¡£</span></span><br><span class="line">    List&lt;Document&gt; documents = loveAppDocumentLoader.loadMarkdowns();</span><br><span class="line">    <span class="comment">// è‡ªä¸»åˆ‡åˆ†</span></span><br><span class="line">    List&lt;Document&gt; splitDocuments = myTokenTextSplitter.splitCustomized(documents);</span><br><span class="line">    simpleVectorStore.add(splitDocuments);</span><br><span class="line">    <span class="keyword">return</span> simpleVectorStore;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é—®é¢˜ï¼šæ‰‹åŠ¨ä½¿ç”¨åˆ‡åˆ†å‚æ•°å¾ˆéš¾æŠŠæ¡åˆé€‚å€¼ï¼Œå®¹æ˜“ å‡ºç°è¯­ä¹‰æˆªæ–­çš„é—®é¢˜ã€‚</p>
<p>è§£å†³æ€è·¯ï¼šäº‘æœåŠ¡ï¼Œå¦‚é˜¿é‡Œäº‘ç™¾ç‚¼å®ç°å¥½çš„æ™ºèƒ½åˆ‡åˆ† + äººå·¥äºŒæ¬¡æ ¡éªŒ</p>
<h4 id="å…ƒæ•°æ®æ ‡æ³¨"><a href="#å…ƒæ•°æ®æ ‡æ³¨" class="headerlink" title="å…ƒæ•°æ®æ ‡æ³¨"></a>å…ƒæ•°æ®æ ‡æ³¨</h4><p>ä¸ºæ–‡æ¡£æ·»åŠ æ›´ä¸°å¯Œçš„å…ƒä¿¡æ¯ï¼Œå½¢æˆå¤šç»´ç´¢å¼•ï¼Œä¾¿äºå‘é‡åŒ–å¤„ç†å’Œç²¾ç¡®æ£€ç´¢</p>
<p>å®ç°æ–¹å¼ï¼š</p>
<ul>
<li>æ‰‹åŠ¨å¯¹å•ä¸ªæ–‡æ¡£æ·»åŠ ï¼Œé€šè¿‡Documentæ„é€ å‡½æ•°çš„Mapä¼ å…¥å³å¯</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">documents.add(<span class="keyword">new</span> <span class="title class_">Document</span>(</span><br><span class="line">    <span class="string">&quot;æ¡ˆä¾‹ç¼–å·ï¼šLR-2023-001\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;é¡¹ç›®æ¦‚è¿°ï¼š180å¹³ç±³å¤§å¹³å±‚ç°ä»£ç®€çº¦é£æ ¼å®¢å…æ”¹é€ \n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;è®¾è®¡è¦ç‚¹ï¼š\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;1. é‡‡ç”¨5.2ç±³æŒ‘é«˜çš„è½åœ°çª—ï¼Œæœ€å¤§åŒ–è‡ªç„¶é‡‡å…‰\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;2. ä¸»è‰²è°ƒï¼šäº‘é›¾ç™½(å“‘å…‰ï¼ŒNCS S0500-N)é…åˆè«å…°è¿ªç°\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;3. å®¶å…·é€‰æ‹©ï¼šæ„å¤§åˆ©B&amp;Bå“ç‰ŒçœŸçš®æ²™å‘ï¼ŒåŒ—æ¬§ç™½æ©¡æœ¨èŒ¶å‡ \n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;ç©ºé—´æ•ˆæœï¼šé€šé€å¤§æ°”ï¼Œé€‚åˆå•†åŠ¡æ¥å¾…å’Œå®¶åº­æ—¥å¸¸èµ·å±…&quot;</span>,</span><br><span class="line">    Map.of(</span><br><span class="line">        <span class="string">&quot;type&quot;</span>, <span class="string">&quot;interior&quot;</span>,    <span class="comment">// æ–‡æ¡£ç±»å‹</span></span><br><span class="line">        <span class="string">&quot;year&quot;</span>, <span class="string">&quot;2025&quot;</span>,        <span class="comment">// å¹´ä»½</span></span><br><span class="line">        <span class="string">&quot;month&quot;</span>, <span class="string">&quot;05&quot;</span>,         <span class="comment">// æœˆä»½</span></span><br><span class="line">        <span class="string">&quot;style&quot;</span>, <span class="string">&quot;modern&quot;</span>,      <span class="comment">// è£…ä¿®é£æ ¼</span></span><br><span class="line">    )));</span><br></pre></td></tr></table></figure>

<ul>
<li>æ‰¹é‡æ·»åŠ ï¼Œé€šè¿‡DocumentReaderï¼Œå¯ä»¥å¯¹æ¯ç¯‡æ–‡ç« æ·»åŠ ç‰¹å®šæ ‡ç­¾ï¼Œæ¯”å¦‚æ‹çˆ±çŠ¶æ€ç­‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æå–æ–‡æ¡£å€’æ•°ç¬¬ 3 å’Œç¬¬ 2 ä¸ªå­—ä½œä¸ºæ ‡ç­¾</span></span><br><span class="line"><span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> fileName.substring(fileName.length() - <span class="number">6</span>, fileName.length() - <span class="number">4</span>);</span><br><span class="line"><span class="type">MarkdownDocumentReaderConfig</span> <span class="variable">config</span> <span class="operator">=</span> MarkdownDocumentReaderConfig.builder()</span><br><span class="line">        .withHorizontalRuleCreateDocument(<span class="literal">true</span>)</span><br><span class="line">        .withIncludeCodeBlock(<span class="literal">false</span>)</span><br><span class="line">        .withIncludeBlockquote(<span class="literal">false</span>)</span><br><span class="line">        .withAdditionalMetadata(<span class="string">&quot;filename&quot;</span>, fileName)</span><br><span class="line">        .withAdditionalMetadata(<span class="string">&quot;status&quot;</span>, status)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<ul>
<li>è‡ªåŠ¨æ·»åŠ ï¼ŒSpringAIçš„transformerç»„ä»¶æä¾›AIè‡ªåŠ¨è§£æå…³é”®è¯å¹¶æ·»åŠ å…ƒä¿¡æ¯çš„åŠŸèƒ½<ul>
<li>é˜¿é‡Œäº‘ç™¾ç‚¼å¯ä»¥é€šè¿‡<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/model-studio/rag-knowledge-base#c0fa1080aerzp">æ‰‹åŠ¨è®¾ç½®æ ‡ç­¾æˆ–API</a>ä¹Ÿå¯ä»¥å®ç°å¿«é€Ÿè¿‡æ»¤</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyKeywordEnricher</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel dashscopeChatModel;</span><br><span class="line"></span><br><span class="line">    List&lt;Document&gt; <span class="title function_">enrichDocuments</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="type">KeywordMetadataEnricher</span> <span class="variable">enricher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KeywordMetadataEnricher</span>(<span class="built_in">this</span>.dashscopeChatModel, <span class="number">5</span>);</span><br><span class="line">        <span class="keyword">return</span> enricher.apply(documents);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">VectorStore <span class="title function_">loveAppVectorStore</span><span class="params">(EmbeddingModel dashscopeEmbeddingModel)</span> &#123;</span><br><span class="line">    <span class="type">SimpleVectorStore</span> <span class="variable">simpleVectorStore</span> <span class="operator">=</span> SimpleVectorStore.builder(dashscopeEmbeddingModel)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="comment">// åŠ è½½æ–‡æ¡£</span></span><br><span class="line">    List&lt;Document&gt; documents = loveAppDocumentLoader.loadMarkdowns();</span><br><span class="line">    <span class="comment">// è‡ªåŠ¨è¡¥å……å…³é”®è¯å…ƒä¿¡æ¯</span></span><br><span class="line">    List&lt;Document&gt; enrichedDocuments = myKeywordEnricher.enrichDocuments(documents);</span><br><span class="line">    simpleVectorStore.add(enrichedDocuments);</span><br><span class="line">    <span class="keyword">return</span> simpleVectorStore;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‘é‡è½¬æ¢ä¸å­˜å‚¨-1"><a href="#å‘é‡è½¬æ¢ä¸å­˜å‚¨-1" class="headerlink" title="å‘é‡è½¬æ¢ä¸å­˜å‚¨"></a>å‘é‡è½¬æ¢ä¸å­˜å‚¨</h3><p>è¿™æ˜¯å½±å“å‡†ç¡®æ€§å’Œæ•ˆç‡çš„æ ¸å¿ƒæ­¥éª¤</p>
<p>é¦–å…ˆä»æˆæœ¬ã€æ€§èƒ½ã€æ•°æ®è§„æ¨¡ç­‰è€ƒè™‘å­˜å‚¨æ–¹æ¡ˆï¼Œå†…å­˜&#x2F;MongoDB&#x2F;Redisç­‰ï¼Œå…·ä½“å®ç°é€šè¿‡builderå³å¯æŒ‡å®švectorStore</p>
<p>æ¥ä¸‹æ¥è€ƒè™‘åˆé€‚çš„åµŒå…¥æ¨¡å‹embeddingModelï¼Œå¥½çš„åµŒå…¥æ¨¡å‹ç›´æ¥å½±å“ç›¸ä¼¼åº¦è®¡ç®—å’Œæ£€ç´¢å‡†ç¡®æ€§</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">SimpleVectorStore</span> <span class="variable">vectorStore</span> <span class="operator">=</span> SimpleVectorStore.builder(embeddingModel)</span><br><span class="line">.build();</span><br></pre></td></tr></table></figure>

<h3 id="æ–‡æ¡£è¿‡æ»¤å’Œæ£€ç´¢"><a href="#æ–‡æ¡£è¿‡æ»¤å’Œæ£€ç´¢" class="headerlink" title="æ–‡æ¡£è¿‡æ»¤å’Œæ£€ç´¢"></a>æ–‡æ¡£è¿‡æ»¤å’Œæ£€ç´¢</h3><p>è¿™é‡Œå°±æœ‰å¾ˆå¤šä¼˜åŒ–çš„åœ°æ–¹</p>
<h4 id="å¤šæŸ¥è¯¢æ‰©å±•"><a href="#å¤šæŸ¥è¯¢æ‰©å±•" class="headerlink" title="å¤šæŸ¥è¯¢æ‰©å±•"></a>å¤šæŸ¥è¯¢æ‰©å±•</h4><p>æç¤ºè¯ä¸å®Œæ•´&#x2F;æ­§ä¹‰çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å¤šæŸ¥è¯¢æ‹“å±•å™¨å¯ä»¥æ‹“å±•æ£€ç´¢èŒƒå›´ï¼Œæé«˜æ–‡æ¡£çš„å¬å›ç‡</p>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>åˆé€‚çš„æŸ¥è¯¢æ•°é‡ï¼ˆ3-5ä¸ªï¼‰ï¼Œè¿‡å¤šæˆæœ¬ä¼šè¿‡é«˜</li>
<li>è¦ä¿ç•™åŸå§‹æŸ¥è¯¢çš„æ ¸å¿ƒè¯­ä¹‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">MultiQueryExpander</span> <span class="variable">queryExpander</span> <span class="operator">=</span> MultiQueryExpander.builder()</span><br><span class="line">    .chatClientBuilder(chatClientBuilder)</span><br><span class="line">    .numberOfQueries(<span class="number">3</span>)</span><br><span class="line">    .build();</span><br><span class="line">List&lt;Query&gt; queries = queryExpander.expand(<span class="keyword">new</span> <span class="title class_">Query</span>(<span class="string">&quot;è°æ˜¯ç™¾åº¦åˆ›å§‹äººå•Šï¼Ÿ&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>æ‰©å±•åï¼Œå³å¯ç›´æ¥ç”¨äºæ£€ç´¢æ–‡æ¡£ã€æˆ–è€…æå–æ–‡æœ¬æ”¹å†™æç¤ºè¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DocumentRetriever</span> <span class="variable">retriever</span> <span class="operator">=</span> VectorStoreDocumentRetriever.builder()</span><br><span class="line">    .vectorStore(vectorStore)</span><br><span class="line">    .similarityThreshold(<span class="number">0.73</span>)</span><br><span class="line">    .topK(<span class="number">5</span>)</span><br><span class="line">    .filterExpression(<span class="keyword">new</span> <span class="title class_">FilterExpressionBuilder</span>()</span><br><span class="line">        .eq(<span class="string">&quot;genre&quot;</span>, <span class="string">&quot;fairytale&quot;</span>)</span><br><span class="line">        .build())</span><br><span class="line">    .build();</span><br><span class="line"><span class="comment">// ç›´æ¥ç”¨æ‰©å±•åçš„æŸ¥è¯¢æ¥è·å–æ–‡æ¡£</span></span><br><span class="line">List&lt;Document&gt; retrievedDocuments = documentRetriever.retrieve(query);</span><br><span class="line"><span class="comment">// è¾“å‡ºæ‰©å±•åçš„æŸ¥è¯¢æ–‡æœ¬</span></span><br><span class="line">System.out.println(query.text());</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¤šæŸ¥è¯¢æ‰©å±•çš„å®Œæ•´ä½¿ç”¨æµç¨‹å¯ä»¥åŒ…æ‹¬ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><p>ä½¿ç”¨æ‰©å±•åçš„æŸ¥è¯¢å¬å›æ–‡æ¡£ï¼šéå†æ‰©å±•åçš„æŸ¥è¯¢åˆ—è¡¨ï¼Œå¯¹æ¯ä¸ªæŸ¥è¯¢ä½¿ç”¨ DocumentRetriever æ¥å¬å›ç›¸å…³æ–‡æ¡£ã€‚</p>
</li>
<li><p>æ•´åˆå¬å›çš„æ–‡æ¡£ï¼šå°†æ¯ä¸ªæŸ¥è¯¢å¬å›çš„æ–‡æ¡£è¿›è¡Œæ•´åˆï¼Œå½¢æˆä¸€ä¸ªåŒ…å«æ‰€æœ‰ç›¸å…³ä¿¡æ¯çš„æ–‡æ¡£é›†åˆã€‚(ä¹Ÿå¯ä»¥ä½¿ç”¨æ–‡æ¡£åˆå¹¶å™¨å»é‡)</p>
</li>
<li><p>ä½¿ç”¨å¬å›çš„æ–‡æ¡£æ”¹å†™ Promptï¼šå°†æ•´åˆåçš„æ–‡æ¡£å†…å®¹æ·»åŠ åˆ°åŸå§‹ Prompt ä¸­ï¼Œä¸ºå¤§è¯­è¨€æ¨¡å‹æä¾›æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p>
</li>
</ol>
<p>ğŸ’¡ éœ€è¦æ³¨æ„ï¼Œå¤šæŸ¥è¯¢æ‰©å±•ä¼šå¢åŠ æŸ¥è¯¢æ¬¡æ•°å’Œè®¡ç®—æˆæœ¬ï¼Œæ•ˆæœä¹Ÿä¸æ˜“é‡åŒ–è¯„ä¼°ï¼Œæ‰€ä»¥ä¸ªäººå»ºè®®æ…ç”¨è¿™ç§ä¼˜åŒ–æ–¹å¼ã€‚</p>
</blockquote>
<h4 id="æŸ¥è¯¢é‡å†™-ç¿»è¯‘"><a href="#æŸ¥è¯¢é‡å†™-ç¿»è¯‘" class="headerlink" title="æŸ¥è¯¢é‡å†™&#x2F;ç¿»è¯‘"></a>æŸ¥è¯¢é‡å†™&#x2F;ç¿»è¯‘</h4><p>å‚ç…§<a target="_blank" rel="noopener" href="https://java2ai.com/docs/1.0.0-M6.1/tutorials/rag/#32-query-rewrite-%E6%9F%A5%E8%AF%A2%E9%87%8D%E5%86%99">æ–‡æ¡£</a>å®ç°æŸ¥è¯¢é‡å†™</p>
<ul>
<li><code>RewriteQueryTransformer</code>  é‡å†™ä¼˜åŒ–æŸ¥è¯¢ç»“æ„</li>
<li><code>transformedQuery</code> å¤šè¯­è¨€æ”¯æŒ</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QueryRewriter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> QueryTransformer queryTransformer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">QueryRewriter</span><span class="params">(ChatModel dashscopeChatModel)</span> &#123;</span><br><span class="line">        ChatClient.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> ChatClient.builder(dashscopeChatModel);</span><br><span class="line">        <span class="comment">// åˆ›å»ºæŸ¥è¯¢é‡å†™è½¬æ¢å™¨</span></span><br><span class="line">        queryTransformer = RewriteQueryTransformer.builder()</span><br><span class="line">                .chatClientBuilder(builder)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doQueryRewrite</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Query</span>(prompt);</span><br><span class="line">        <span class="comment">// æ‰§è¡ŒæŸ¥è¯¢é‡å†™</span></span><br><span class="line">        <span class="type">Query</span> <span class="variable">transformedQuery</span> <span class="operator">=</span> queryTransformer.transform(query);</span><br><span class="line">        <span class="comment">// è¾“å‡ºé‡å†™åçš„æŸ¥è¯¢</span></span><br><span class="line">        <span class="keyword">return</span> transformedQuery.text();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åº”ç”¨ï¼Œé€šè¿‡ä¿®æ”¹ç”¨æˆ·æç¤ºè¯ä¸ºé‡å†™&#x2F;ç¿»è¯‘åçš„æç¤ºè¯å³å¯ï¼Œäº‘æœåŠ¡ä¸­ï¼Œå¯ä»¥é€šè¿‡<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/model-studio/rag-optimization#b7031e2ad6cji">å¤šè½®ä¼šè¯æ”¹å†™</a>è·å¾—æ›´ä¸“ä¸šçš„æç¤ºè¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"> <span class="keyword">private</span> QueryRewriter queryRewriter;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">doChatWithRag</span><span class="params">(String message, String chatId)</span> &#123;</span><br><span class="line">     <span class="comment">// æŸ¥è¯¢é‡å†™</span></span><br><span class="line">     <span class="type">String</span> <span class="variable">rewrittenMessage</span> <span class="operator">=</span> queryRewriter.doQueryRewrite(message);</span><br><span class="line">     <span class="type">ChatResponse</span> <span class="variable">chatResponse</span> <span class="operator">=</span> chatClient</span><br><span class="line">             .prompt()</span><br><span class="line">             .user(rewrittenMessage)</span><br><span class="line">             .call()</span><br><span class="line">             .chatResponse();</span><br><span class="line">     <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> chatResponse.getResult().getOutput().getText();</span><br><span class="line">     <span class="keyword">return</span> content;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ£€ç´¢å™¨é…ç½®"><a href="#æ£€ç´¢å™¨é…ç½®" class="headerlink" title="æ£€ç´¢å™¨é…ç½®"></a>æ£€ç´¢å™¨é…ç½®</h4><p>å…³é”®é…ç½®ï¼šç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆå™ªéŸ³å’Œä¿¡æ¯å®Œæ•´æ€§çš„æƒè¡¡ï¼‰ã€è¿”å›æ–‡æ¡£æ•°é‡ï¼ˆå™ªéŸ³å’Œä¿¡æ¯å®Œæ•´æ€§çš„æƒè¡¡ï¼‰ã€è¿‡æ»¤è§„åˆ™ï¼ˆ<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/retrieval-augmented-generation.html#_vectorstoredocumentretriever">FilterExpressionBuilder</a>ï¼‰</p>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody><tr>
<td>çŸ¥è¯†åº“ä¸­åŒ…å«å¤šä¸ªç±»åˆ«çš„æ–‡æ¡£ï¼Œå¸Œæœ›é™å®šæ£€ç´¢èŒƒå›´</td>
<td>å»ºè®®ä¸ºæ–‡æ¡£æ·»åŠ æ ‡ç­¾ï¼ŒçŸ¥è¯†åº“æ£€ç´¢æ—¶ä¼šå…ˆæ ¹æ®æ ‡ç­¾ç­›é€‰ç›¸å…³æ–‡æ¡£</td>
</tr>
<tr>
<td>çŸ¥è¯†åº“ä¸­æœ‰å¤šç¯‡ç»“æ„ç›¸ä¼¼çš„æ–‡æ¡£ï¼Œå¸Œæœ›ç²¾ç¡®å®šä½</td>
<td>é¦–å…ˆæå–å…ƒæ•°æ®ï¼ŒçŸ¥è¯†åº“å…ˆä½¿ç”¨å…ƒæ•°æ®è¿›è¡Œç»“æ„åŒ–æœç´¢ï¼Œå†è¿›è¡Œå‘é‡æ£€ç´¢</td>
</tr>
</tbody></table>
<p>æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªRagAdvisorå·¥å‚ç±»ï¼Œæ ¹æ®ç”¨æˆ·çš„æŸ¥è¯¢éœ€æ±‚åˆ¶é€ å¯¹åº”çš„Advisor</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoveAppRagCustomAdvisorFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Advisor <span class="title function_">createLoveAppRagCustomAdvisor</span><span class="params">(VectorStore vectorStore, String status)</span> &#123;</span><br><span class="line">        Filter.<span class="type">Expression</span> <span class="variable">expression</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterExpressionBuilder</span>()</span><br><span class="line">                .eq(<span class="string">&quot;status&quot;</span>, status)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">DocumentRetriever</span> <span class="variable">documentRetriever</span> <span class="operator">=</span> VectorStoreDocumentRetriever.builder()</span><br><span class="line">                .vectorStore(vectorStore)</span><br><span class="line">                .filterExpression(expression) <span class="comment">// è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line">                .similarityThreshold(<span class="number">0.5</span>) <span class="comment">// ç›¸ä¼¼åº¦é˜ˆå€¼</span></span><br><span class="line">                .topK(<span class="number">3</span>) <span class="comment">// è¿”å›æ–‡æ¡£æ•°é‡</span></span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> RetrievalAugmentationAdvisor.builder()</span><br><span class="line">                .documentRetriever(documentRetriever)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æ–¹å¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">chatClient.advisors(</span><br><span class="line">    LoveAppRagCustomAdvisorFactory.createLoveAppRagCustomAdvisor(</span><br><span class="line">        loveAppVectorStore, <span class="string">&quot;å·²å©š&quot;</span></span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>äº‘å¹³å°ä¸­ï¼Œå¯ä»¥é€šè¿‡tagsæŒ‡å®šæ ‡ç­¾æ¥å®ç°è¿‡æ»¤ï¼Œä»¥åŠæ”¯æŒ<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/model-studio/call-single-agent-application/#6bd8094de7e1e">å…ƒæ•°æ®è¿‡æ»¤</a>ï¼Œå¼€å¯åä¼šåœ¨æ£€ç´¢å‰åŠ ä¸Šç»“æ„åŒ–æœç´¢</p>
<blockquote>
<p>æ³¨ï¼šæ— è®ºä½¿ç”¨ä»€ä¹ˆæ–¹å¼ï¼Œéƒ½è¦è¿›è¡Œå¤šè½®å‘½ä¸­æµ‹è¯•ï¼ŒéªŒè¯æ£€ç´¢æ•ˆæœ</p>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130204841481.png" alt="image-20260130204841481" style="zoom:33%;" />	</blockquote>
<h3 id="æŸ¥è¯¢å¢å¼ºä¸å…³è”-1"><a href="#æŸ¥è¯¢å¢å¼ºä¸å…³è”-1" class="headerlink" title="æŸ¥è¯¢å¢å¼ºä¸å…³è”"></a>æŸ¥è¯¢å¢å¼ºä¸å…³è”</h3><p>æ­¤æ—¶è·å–åˆ°äº†ä¸ç”¨æˆ·ç›¸å…³çš„æ–‡æ¡£ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å°†ç”¨æˆ·æç¤ºè¯å’Œæ£€ç´¢å†…å®¹ç”Ÿæˆæœ€ç»ˆå›ç­”ã€‚</p>
<h4 id="é”™è¯¯å¤„ç†æœºåˆ¶"><a href="#é”™è¯¯å¤„ç†æœºåˆ¶" class="headerlink" title="é”™è¯¯å¤„ç†æœºåˆ¶"></a>é”™è¯¯å¤„ç†æœºåˆ¶</h4><p>å®é™…ä¼šå‡ºç°å¤šç§æƒ…å†µï¼Œå¦‚æ‰¾ä¸åˆ°æ–‡æ¡£ã€ç›¸ä¼¼åº¦ä½ã€æŸ¥è¯¢è¶…æ—¶ç­‰ï¼Œè‰¯å¥½çš„é”™è¯¯å¤„ç†å¯ä»¥æå‡ç”¨æˆ·ä½“éªŒï¼Œå…·ä½“æœ‰ï¼š</p>
<ul>
<li>ç©ºä¸Šä¸‹æ–‡å¤„ç†ï¼ˆè¾¹ç•Œæƒ…å†µï¼‰</li>
<li>å‹å¥½çš„é”™è¯¯æç¤º</li>
<li>å¼•å¯¼ç”¨æˆ·æä¾›å¿…è¦ä¿¡æ¯</li>
</ul>
<p>è¿™å°±å¯ä»¥é€šè¿‡ä¹‹å‰æåˆ°çš„<code>RetrievalAugmentationAdvisor</code>ä¸Šä¸‹æ–‡å¢å¼ºå™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RetrievalAugmentationAdvisor.builder()</span><br><span class="line">    .queryAugmenter(</span><br><span class="line">        ContextualQueryAugmenter.builder()</span><br><span class="line">            .allowEmptyContext(<span class="literal">false</span>)</span><br><span class="line">            .build()</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ²¡æœ‰é…ç½®ï¼Œåˆ™ä¼šé»˜è®¤æ”¹å†™useræç¤ºè¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">The user query is outside your knowledge base.</span><br><span class="line">Politely inform the user that you can&#x27;t answer it.</span><br></pre></td></tr></table></figure>

<p>å‹å¥½çš„é”™è¯¯æç¤º&amp;å¼•å¯¼æä¾›å¿…è¦ä¿¡æ¯ï¼šæˆ‘ä»¬è€ƒè™‘è¿›ä¸€æ­¥ä½¿ç”¨å·¥å‚æ¨¡å¼åˆ›å»ºè‡ªå®šä¹‰çš„<code>ContextualQueryAugmenter</code>ï¼Œå®šä¹‰è¿”å›çš„æ¨¡æ¿</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoveAppContextualQueryAugmenterFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ContextualQueryAugmenter <span class="title function_">createInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">PromptTemplate</span> <span class="variable">emptyContextPromptTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromptTemplate</span>(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                ä½ åº”è¯¥è¾“å‡ºä¸‹é¢çš„å†…å®¹ï¼š</span></span><br><span class="line"><span class="string">                æŠ±æ­‰ï¼Œæˆ‘åªèƒ½å›ç­”æ‹çˆ±ç›¸å…³çš„é—®é¢˜ï¼Œåˆ«çš„æ²¡åŠæ³•å¸®åˆ°æ‚¨å“¦ï¼Œ</span></span><br><span class="line"><span class="string">                æœ‰é—®é¢˜å¯ä»¥è”ç³»ç¼–ç¨‹å¯¼èˆªå®¢æœ https://codefather.cn</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ContextualQueryAugmenter.builder()</span><br><span class="line">                .allowEmptyContext(<span class="literal">false</span>)</span><br><span class="line">                .emptyContextPromptTemplate(emptyContextPromptTemplate)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ£€ç´¢ç”Ÿæˆå™¨ä¸­åº”ç”¨ä¸Šä¸‹æ–‡å¢å¼ºå™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RetrievalAugmentationAdvisor.builder()</span><br><span class="line">              .documentRetriever(documentRetriever)</span><br><span class="line">              .queryAugmenter(LoveAppContextualQueryAugmenterFactory.createInstance())</span><br><span class="line">              .build();</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–æœ€ä½³å®è·µ</p>
<table>
<thead>
<tr>
<th>é—®é¢˜ç±»å‹</th>
<th>æ”¹è¿›ç­–ç•¥</th>
</tr>
</thead>
<tbody><tr>
<td>å¤§æ¨¡å‹å¹¶æœªç†è§£çŸ¥è¯†å’Œç”¨æˆ·æç¤ºè¯ä¹‹é—´çš„å…³ç³»ï¼Œç­”æ¡ˆç”Ÿç¡¬æ‹¼å‡‘</td>
<td>å»ºè®®é€‰æ‹©åˆé€‚çš„å¤§æ¨¡å‹ï¼Œæå‡è¯­ä¹‰ç†è§£èƒ½åŠ›</td>
</tr>
<tr>
<td>è¿”å›çš„ç»“æœæ²¡æœ‰æŒ‰ç…§è¦æ±‚ï¼Œæˆ–è€…ä¸å¤Ÿå…¨é¢</td>
<td>å»ºè®®ä¼˜åŒ–æç¤ºè¯æ¨¡æ¿ï¼Œå¼•å¯¼æ¨¡å‹ç”Ÿæˆæ›´ç¬¦åˆè¦æ±‚çš„å›ç­”</td>
</tr>
<tr>
<td>è¿”å›ç»“æœä¸å¤Ÿå‡†ç¡®ï¼Œæ··å…¥äº†æ¨¡å‹è‡ªèº«çš„é€šç”¨çŸ¥è¯†</td>
<td>å»ºè®®å¼€å¯æ‹’è¯†åŠŸèƒ½ï¼Œé™åˆ¶æ¨¡å‹åªåŸºäºçŸ¥è¯†åº“å›ç­”</td>
</tr>
<tr>
<td>ç›¸ä¼¼æç¤ºè¯ï¼Œå¸Œæœ›æ§åˆ¶å›ç­”çš„ä¸€è‡´æ€§æˆ–å¤šæ ·æ€§</td>
<td>å»ºè®®è°ƒæ•´å¤§æ¨¡å‹å‚æ•°ï¼Œå¦‚æ¸©åº¦å€¼ç­‰</td>
</tr>
</tbody></table>
<p>å¦‚æœå¿…è¦çš„è¯ï¼Œè¿˜å¯ä»¥è€ƒè™‘æ›´é«˜çº§çš„ä¼˜åŒ–æ–¹å‘ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li>åˆ†ç¦»æ£€ç´¢é˜¶æ®µå’Œç”Ÿæˆé˜¶æ®µçš„çŸ¥è¯†å—</li>
<li>é’ˆå¯¹ä¸åŒé˜¶æ®µä½¿ç”¨ä¸åŒç²’åº¦çš„æ–‡æ¡£ï¼Œè¿›ä¸€æ­¥æå‡ç³»ç»Ÿæ€§èƒ½å’Œå›ç­”è´¨é‡</li>
<li>é’ˆå¯¹æŸ¥è¯¢é‡å†™ã€å…³é”®è¯å…ƒä¿¡æ¯å¢å¼ºç­‰ç”¨åˆ° AI å¤§æ¨¡å‹çš„åœºæ™¯ï¼Œå¯ä»¥é€‰æ‹©ç›¸å¯¹è½»é‡çš„å¤§æ¨¡å‹ï¼Œä¸ä¸€å®šæ•´ä¸ªé¡¹ç›®åªå¼•å…¥ä¸€ç§å¤§æ¨¡å‹</li>
</ol>
<h2 id="é«˜çº§çŸ¥è¯†è¡¥å……"><a href="#é«˜çº§çŸ¥è¯†è¡¥å……" class="headerlink" title="é«˜çº§çŸ¥è¯†è¡¥å……"></a>é«˜çº§çŸ¥è¯†è¡¥å……</h2><h3 id="æ··åˆæ£€ç´¢"><a href="#æ··åˆæ£€ç´¢" class="headerlink" title="æ··åˆæ£€ç´¢"></a>æ··åˆæ£€ç´¢</h3><p>RAG ç³»ç»Ÿçš„æ£€ç´¢è´¨é‡å¾ˆå¤§ç¨‹åº¦å†³å®šæœ€ç»ˆå›ç­”</p>
<p>ä½†ä¸åŒæ£€ç´¢æ–¹æ³•å„æœ‰ä¼˜ç¼ºç‚¹: å‘é‡æ£€ç´¢è™½ç„¶èƒ½ç†è§£è¯­ä¹‰, æ•æ‰æ–‡æœ¬é—´çš„æ¦‚å¿µå…³è”, ä½†å¯¹å…³é”®è¯æ•æ„Ÿåº¦ä¸å¤Ÿã€‚æ¯”å¦‚, å½“ä½ æœç´¢â€œ2025 å¹´æ€ä¹ˆå­¦ç¼–ç¨‹â€æ—¶, å‘é‡æ£€ç´¢å¯èƒ½ä¼šè¿”å›ä¸ç¼–ç¨‹ç›¸å…³çš„æœ¯è¯­è§£é‡Š, è€Œä¸æ˜¯å‡†ç¡®é”å®š 2025 å¹´ç¼–ç¨‹å­¦ä¹ è·¯çº¿ã€‚</p>
<p>ç›¸å, åŸºäºå€’æ’ç´¢å¼•çš„å…¨æ–‡æ£€ç´¢åœ¨ç²¾ç¡®åŒ¹é…å…³é”®è¯æ–¹é¢è¡¨ç°å‡ºè‰², ä½†å®ƒä¸ç†è§£è¯­ä¹‰, éš¾ä»¥å¤„ç†åŒä¹‰è¯æˆ–æ¦‚å¿µæ€§æŸ¥è¯¢ã€‚å°±åƒä½ é—®â€œç™¾åº¦çš„åˆ›å§‹äººæ˜¯è°â€, å…¨æ–‡æ£€ç´¢å¯èƒ½ä¸ä¼šè¿”å›åªæåˆ°â€œç™¾åº¦åˆ›å§‹äººåˆ›åŠäº†å¾ˆå¤šç½‘ç«™â€è€Œæ²¡æœ‰æ˜ç¡®æåˆ°â€œç™¾åº¦â€çš„æ–‡æ¡£ã€‚</p>
<p>ç»“æ„åŒ–æ£€ç´¢æ”¯æŒç²¾ç¡®è¿‡æ»¤å’Œå¤æ‚æ¡ä»¶ç»„åˆ, ä½†ä¾èµ–è‰¯å¥½çš„å…ƒæ•°æ®ã€‚è€ŒçŸ¥è¯†å›¾è°±æ£€ç´¢èƒ½å‘ç°å®ä½“é—´éšå«å…³ç³», é€‚åˆå›ç­”å¤æ‚é—®é¢˜, ä½†æ„å»ºæˆæœ¬é«˜ã€‚</p>
<p>ä¸»è¦æ£€ç´¢æ–¹æ³•æ¯”è¾ƒè¡¨:</p>
<table>
<thead>
<tr>
<th>æ£€ç´¢æ–¹æ³•</th>
<th>åŸç†</th>
<th>ä¼˜åŠ¿</th>
<th>åŠ£åŠ¿</th>
</tr>
</thead>
<tbody><tr>
<td>å‘é‡æ£€ç´¢</td>
<td>åŸºäºåµŒå…¥å‘é‡ç›¸ä¼¼åº¦æœç´¢</td>
<td>ç†è§£è¯­ä¹‰å…³è”, é€‚åˆæ¦‚å¿µæ€§æŸ¥è¯¢</td>
<td>å¯¹å…³é”®è¯ä¸æ•æ„Ÿ, å¬å›å¯èƒ½ä¸å‡†ç¡®</td>
</tr>
<tr>
<td>å…¨æ–‡æ£€ç´¢</td>
<td>åŸºäºå€’æ’ç´¢å¼•, åŒ¹é…å…³é”®è¯</td>
<td>ç²¾ç¡®åŒ¹é…å…³é”®è¯, é«˜å¬å›ç‡</td>
<td>ä¸ç†è§£è¯­ä¹‰, åŒä¹‰è¯éš¾ä»¥åŒ¹é…</td>
</tr>
<tr>
<td>ç»“æ„åŒ–æ£€ç´¢</td>
<td>åŸºäºå…ƒæ•°æ®æˆ–ç»“æ„åŒ–å­—æ®µæŸ¥è¯¢</td>
<td>ç²¾ç¡®è¿‡æ»¤, æ”¯æŒå¤æ‚æ¡ä»¶ç»„åˆ</td>
<td>ä¾èµ–è‰¯å¥½çš„å…ƒæ•°æ®, çµæ´»æ€§æœ‰é™</td>
</tr>
<tr>
<td>çŸ¥è¯†å›¾è°±æ£€ç´¢</td>
<td>åˆ©ç”¨å®ä½“é—´å…³ç³»è¿›è¡Œå›¾éå†</td>
<td>å‘ç°éšå«å…³ç³», å›ç­”å¤æ‚é—®é¢˜</td>
<td>æ„å»ºæˆæœ¬é«˜, éœ€è¦ä¸“ä¸šçŸ¥è¯†</td>
</tr>
</tbody></table>
<p>å…¶ä¸­, å…¨æ–‡æ£€ç´¢æ˜¯åç«¯å¼€å‘è¦æŒæ¡çš„æŠ€èƒ½, å¯¹åº”çš„ä¸»æµæŠ€æœ¯å®ç°æ˜¯ Elasticsearch,</p>
<p>ç­–ç•¥ï¼š</p>
<ul>
<li>å¹¶è¡Œæ£€ç´¢ï¼Œæ´¾å‡ºå¤šä¸ªä¸“å®¶ï¼Œæ•´åˆä»–ä»¬çš„ç»“æœ</li>
</ul>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130210812154.png" alt="image-20260130210812154" style="zoom:33%;" />	

<ul>
<li>çº§è”æ··åˆæ£€ç´¢ï¼šå…ˆå¹¿æ³›å¬å›ï¼Œå†ç²¾ç»†è¿‡æ»¤ï¼Œå¦‚å…ˆå‘é‡è·å–ç›¸ä¼¼æ–‡æ¡£ï¼Œå†å…³é”®è¯è¿‡æ»¤ï¼Œæœ€åå…ƒæ•°æ®è¿›ä¸€æ­¥ç­›é€‰ï¼Œæ¼æ–—å¼é€æ­¥è¿‡æ»¤</li>
</ul>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130210847610.png" alt="image-20260130210847610" style="zoom:33%;" />	

<ul>
<li>åŠ¨æ€æ··åˆæ£€ç´¢ï¼Œç†è§£ä¸ºcursorçš„autoæ¨¡å¼ï¼Œåˆ†ææŸ¥è¯¢çš„ç±»å‹åŠ¨æ€è·¯ç”±åˆ°å¯¹åº”çš„æ£€ç´¢æ–¹å¼ï¼Œå¦‚é—®æ€ä¹ˆå†™javaé¡¹ç›®ï¼Œå°±ä¼šåŒ¹é…åˆ°å‘é‡æ£€ç´¢é…åˆå…¨æ–‡æ£€ç´¢ï¼Œæœ€ç»ˆåˆå¹¶å¤šä¸ªæ¨¡å‹çš„ç»“æœ<ul>
<li>difyå°±æä¾›äº†åŸºäºå…¨æ–‡+åŸºäºå‘é‡çš„è¯­ä¹‰æ£€ç´¢çš„æ··åˆæ£€ç´¢ç­–ç•¥ï¼Œå¯ä»¥è®¾ç½®ä¸åŒæƒé‡</li>
</ul>
</li>
</ul>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130210938463.png" alt="image-20260130210938463" style="zoom:33%;" />	



<h3 id="å¤§æ¨¡å‹å¹»è§‰é—®é¢˜"><a href="#å¤§æ¨¡å‹å¹»è§‰é—®é¢˜" class="headerlink" title="å¤§æ¨¡å‹å¹»è§‰é—®é¢˜"></a>å¤§æ¨¡å‹å¹»è§‰é—®é¢˜</h3><p>å¤§å‹æ¨¡å‹å¹»è§‰æ˜¯æŒ‡æ¨¡å‹ç”Ÿæˆçœ‹ä¼¼åˆç†ä½†å®é™…ä¸Šä¸å‡†ç¡®æˆ–å®Œå…¨è™šæ„çš„å†…å®¹ã€‚å°±åƒä¸€ä¸ªä¿¡å¿ƒåè¶³çš„å­¦ç”Ÿå›ç­”äº†ä¸€ä¸ªè‡ªå·±å¹¶ä¸çœŸæ­£äº†è§£çš„é—®é¢˜ã€‚è¿™äº›å¹»è§‰ä¸»è¦æœ‰ä¸‰ç§è¡¨ç°å½¢å¼:</p>
<ol>
<li><p>äº‹å®æ€§å¹»è§‰:ç”Ÿæˆä¸äº‹å®ä¸ç¬¦çš„å†…å®¹(å¦‚é”™è¯¯çš„æ—¥æœŸã€äººç‰©å…³ç³»ç­‰)ã€‚æ¯”å¦‚â€œç™¾åº¦åˆ›å§‹äººå‘æ˜äº†è®¡ç®—å™¨â€</p>
</li>
<li><p>é€»è¾‘æ€§å¹»è§‰:æ¨ç†è¿‡ç¨‹å­˜åœ¨é€»è¾‘é”™è¯¯ï¼Œå¾—å‡ºä¸åˆç†çš„ç»“è®ºã€‚æ¯”å¦‚â€œ1+1&#x3D;3â€</p>
</li>
<li><p>è‡ªæ´½æ€§å¹»è§‰:ç”Ÿæˆå†…å®¹è‡ªèº«å­˜åœ¨çŸ›ç›¾ã€‚æ¯”å¦‚â€œæˆ‘å¾ˆå¹´è½»ï¼Œæ‰80å²â€</p>
</li>
</ol>
<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°å¹»è§‰å‘¢?åŸå› å…¶å®å¾ˆå¤æ‚ã€‚</p>
<ul>
<li>ä¸€æ–¹é¢ï¼Œæ¨¡å‹çš„è®­ç»ƒæ•°æ®ä¸­å¯èƒ½åŒ…å«<code>é”™è¯¯æˆ–è¿‡æ—¶çš„ä¿¡æ¯</code>;</li>
<li>å¦ä¸€æ–¹é¢ï¼Œå¤§è¯­è¨€æ¨¡å‹æœ¬è´¨ä¸Šæ˜¯<code>é¢„æµ‹ä¸‹ä¸€ä¸ªè¯çš„æ¦‚ç‡æ¨¡å‹</code>ï¼Œå®ƒä»¬å€¾å‘äºç”Ÿæˆæµç•…è€Œæœªå¿…å‡†ç¡®çš„å†…å®¹ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæ¨¡å‹å¹¶ä¸çœŸæ­£â€œçŸ¥é“â€ä»€ä¹ˆï¼Œå®ƒåªæ˜¯å­¦ä¼šäº†æ–‡æœ¬çš„ç»Ÿè®¡æ¨¡å¼ã€‚</li>
</ul>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œå½“ä½ é—®ä¸€ä¸ªä»æ¥æ²¡å»è¿‡æœˆçƒçš„äººå…³äºæœˆçƒè¡¨é¢çš„æƒ…å†µï¼Œä»–å¯èƒ½ä¼šåŸºäºçœ‹è¿‡çš„ç”µå½±æˆ–ä¹¦ç±ç»™å‡ºçœ‹ä¼¼åˆç†ä½†ä¸å‡†ç¡®çš„æè¿°ã€‚å¤§å‹æ¨¡å‹çš„å¹»è§‰æœ¬è´¨ä¸Šä¸æ­¤ç±»ä¼¼ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•å‡å°‘è¿™ç§å¹»è§‰å‘¢?</p>
<ul>
<li>é¦–å…ˆå°±æ˜¯æˆ‘ä»¬é‡ç‚¹å­¦ä¹ çš„RAG,é€šè¿‡å¼•å…¥å¤–éƒ¨çŸ¥è¯†æºï¼Œæˆ‘ä»¬å¯ä»¥è®©æ¨¡å‹ä¸å†å®Œå…¨ä¾èµ–å…¶å‚æ•°ä¸­å­˜å‚¨çš„ä¿¡æ¯ï¼Œè€Œæ˜¯åŸºäºæ£€ç´¢åˆ°çš„æœ€æ–°ã€å‡†ç¡®çš„ä¿¡æ¯æ¥å›ç­”é—®é¢˜ã€‚<ul>
<li>æœ‰æ•ˆçš„RAGå®ç°é€šå¸¸ä¼šå¼•å…¥â€œ<code>å¼•ç”¨æ ‡æ³¨</code>â€æœºåˆ¶ï¼Œè®©æ¨¡å‹æ˜ç¡®æŒ‡å‡ºä¿¡æ¯æ¥æºäºå“ªä¸ªæ–‡æ¡£çš„å“ªä¸ªéƒ¨åˆ†ã€‚å½“æ¨¡å‹ä¸ç¡®å®šæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥é¼“åŠ±å®ƒè¯šå®åœ°è¡¨è¾¾ä¸ç¡®å®šæ€§ï¼Œè€Œä¸æ˜¯çŒœæµ‹ç­”æ¡ˆã€‚è¿™å°±åƒä¸€ä¸ªå¥½çš„å­¦è€…ä¼šæ˜ç¡®å¼•ç”¨æ¥æºï¼Œå¹¶åœ¨ä¸ç¡®å®šæ—¶å¦è¯šæ‰¿è®¤çŸ¥è¯†çš„å±€é™æ€§ã€‚</li>
</ul>
</li>
<li>æ­¤å¤–ï¼Œè¿˜æœ‰å…¶ä»–å‡è½»å¹»è§‰çš„æ–¹æ³•ï¼Œæ¯”å¦‚æç¤ºå·¥ç¨‹ä¼˜åŒ–ï¼Œå¯ä»¥é‡‡ç”¨â€œ<code>æ€ç»´é“¾</code>â€æé«˜æ¨ç†é€æ˜åº¦ï¼Œé€šè¿‡å¼•å¯¼æ¨¡å‹ä¸€æ­¥æ­¥æ€è€ƒï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½åœ°è§‚å¯Ÿå…¶æ¨ç†è¿‡ç¨‹ï¼ŒåŠæ—¶å‘ç°å¯èƒ½çš„é”™è¯¯ã€‚å¾ˆå¤š Agent è¶…çº§æ™ºèƒ½ä½“éƒ½ä¼šé‡‡ç”¨è¿™ç§æ¨¡å¼ï¼ˆå¦‚cursorä¸­çš„æ¨ç†è¿‡ç¨‹ï¼‰</li>
</ul>
<h3 id="RAGåº”ç”¨è¯„ä¼°"><a href="#RAGåº”ç”¨è¯„ä¼°" class="headerlink" title="RAGåº”ç”¨è¯„ä¼°"></a>RAGåº”ç”¨è¯„ä¼°</h3><p>åœ¨å°åº”ç”¨äº§å“ä¸­ï¼Œå¯ä»¥ç›´æ¥ç”¨äº‘å¹³å°çš„å‘½ä¸­æµ‹è¯•èƒ½åŠ›è¯„ä¼°RAGæ•ˆæœã€‚ä½†æ˜¯å¤§å…¬å¸å°±ä¼šæœ‰ä¸€å¥—ä¸“é—¨çš„è¯„ä¼°ä½“ç³»ï¼š</p>
<blockquote>
<p> RAG åº”ç”¨è¯„ä¼°æœ¬è´¨ä¸Šå›ç­”äº† 3 ä¸ªå…³é”®é—®é¢˜ï¼š</p>
<ul>
<li>ç³»ç»Ÿæ£€ç´¢çš„ä¿¡æ¯æ˜¯å¦ç›¸å…³ï¼Ÿ</li>
<li>ç”Ÿæˆçš„å›ç­”æ˜¯å¦å‡†ç¡®ï¼Ÿ</li>
<li>æ•´ä½“ç”¨æˆ·ä½“éªŒå¦‚ä½•ï¼Ÿè¯„ä¼°çš„ç›®çš„æ˜¯ç¡®ä¿å›ç­”è´¨é‡ã€è¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼Œä»è€Œç»™å‡ºæŒç»­ä¼˜åŒ–çš„æ€è·¯ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ç®€å•äº†è§£ä¸‹ RAG åº”ç”¨çš„è¯„ä¼°æŒ‡æ ‡ï¼š</p>
<ol>
<li>æ£€ç´¢è´¨é‡è¯„ä¼°æŒ‡æ ‡</li>
</ol>
<ul>
<li>å¬å›ç‡ï¼šèƒ½å¦æ£€ç´¢åˆ°æ‰€æœ‰ç›¸å…³æ–‡æ¡£</li>
<li>ç²¾ç¡®ç‡ï¼šæ£€ç´¢ç»“æœä¸­ç›¸å…³æ–‡æ¡£çš„æ¯”ä¾‹</li>
<li>å¹³å‡ç²¾åº¦å‡å€¼ (MAP)ï¼šè€ƒè™‘æ’åºè´¨é‡çš„ç»¼åˆæŒ‡æ ‡</li>
<li>è§„èŒƒåŒ–æŠ˜æ‰£ç´¯ç§¯å¢ç›Š (NDCG)ï¼šè€ƒè™‘åˆ°æ–‡æ¡£çš„ç›¸å…³æ€§å’Œå®ƒä»¬åœ¨æ’åä¸­çš„ä½ç½®ï¼Œæ˜¯ä¸€ä¸ªè¡¡é‡æ’åè´¨é‡çš„æŒ‡æ ‡</li>
</ul>
<ol start="2">
<li>ç”Ÿæˆå›ç­”è´¨é‡è¯„ä¼°æŒ‡æ ‡</li>
</ol>
<ul>
<li>äº‹å®å‡†ç¡®æ€§ï¼šå›ç­”ä¸­äº‹å®æ€§é™ˆè¿°çš„å‡†ç¡®ç¨‹åº¦</li>
<li>ç­”æ¡ˆå®Œæ•´æ€§ï¼šå›ç­”æ˜¯å¦æ¶µç›–é—®é¢˜çš„æ‰€æœ‰æ–¹é¢</li>
<li>ä¸Šä¸‹æ–‡ç›¸å…³æ€§ï¼šå›ç­”ä¸é—®é¢˜çš„ç›¸å…³ç¨‹åº¦</li>
<li>å¼•ç”¨å‡†ç¡®æ€§ï¼šå¼•ç”¨å†…å®¹æ˜¯å¦ç¡®å®æ¥è‡ªæ£€ç´¢ä¸Šä¸‹æ–‡</li>
</ul>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯ï¼Œå®šåˆ¶ä¸“é—¨çš„è¯„ä¼°æ ‡å‡†ã€‚æ¯”å¦‚ç³»ç»Ÿæ€§èƒ½è¯„ä¼°ã€é¢†åŸŸé€‚åº”æ€§è¯„ä¼°ã€å¤šè¯­è¨€è¯„ä¼°ã€æ—¶æ•ˆæ€§è¯„ä¼°å’Œç”¨æˆ·æ»¡æ„åº¦è¯„ä¼°ã€‚å…¶ä¸­ï¼Œç”¨æˆ·æ»¡æ„åº¦è¯„ä¼°åœ¨æˆ‘ä»¬å¼€å‘ AI äº§å“æ—¶å°¤ä¸ºå¸¸è§ï¼Œç»å¸¸éœ€è¦å¼•å¯¼ç”¨æˆ·é’ˆå¯¹ AI å¤§å‹æ¨¡å‹çš„å›å¤è¿›è¡Œæ‰“åˆ†ã€‚</p>
<p><img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130211435466.png" alt="image-20260130211435466"></p>
</blockquote>
<p>RAG è¯„ä¼°æµç¨‹é€šå¸¸åŒ…æ‹¬ 4 ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><p>ç”Ÿæˆè¯„ä¼°æ•°æ®é›†ï¼šåˆ›å»ºè¦†ç›–ä¸åŒé—®é¢˜ç±»å‹çš„æµ‹è¯•é›†ï¼Œä¸ºæ¯ä¸ªé—®é¢˜å‡†å¤‡æ ‡å‡†ç­”æ¡ˆå’Œç›¸å…³æ–‡æ¡£ã€‚è¿™äº›æµ‹è¯•é—®é¢˜åº”åŒ…æ‹¬äº‹å®æ€§é—®é¢˜ã€è§‚ç‚¹æ€§é—®é¢˜ã€å¤šæ­¥éª¤æ¨ç†é—®é¢˜ç­‰å„ç§ç±»å‹ã€‚</p>
</li>
<li><p>è¿è¡Œè¯„ä¼°æ£€ç´¢è¿‡ç¨‹çš„ç¨‹åºï¼šå¯¹æ¯ä¸ªæµ‹è¯•é—®é¢˜æ‰§è¡Œæ£€ç´¢ï¼Œä¸äººå·¥æ ‡æ³¨çš„ç›¸å…³æ–‡æ¡£æ¯”è¾ƒï¼Œè®¡ç®—æ£€ç´¢æ€§èƒ½æŒ‡æ ‡ã€‚</p>
</li>
<li><p>è¯„ä¼°å›ç­”è´¨é‡ï¼šå®é™…æ“ä½œä¸­ï¼Œè¯„ä¼°é€šå¸¸åˆ†ä¸ºè‡ªåŠ¨è¯„ä¼°å’Œäººå·¥è¯„ä¼°ä¸¤ç§æ–¹å¼ã€‚è‡ªåŠ¨è¯„ä¼°ä½¿ç”¨åƒ ROUGE (å¬å›ç‡å–å‘æ‘˜è¦è¯„ä¼°) æˆ– BLEU (åŒè¯­è¯„ä¼°æ›¿è¡¥) è¿™æ ·çš„æŒ‡æ ‡æ¥è¡¡é‡ç”Ÿæˆå†…å®¹ä¸å‚è€ƒç­”æ¡ˆçš„ç›¸ä¼¼åº¦ï¼Œæˆ–è€…ä½¿ç”¨æ›´å¼ºå¤§çš„æ¨¡å‹æ¥åˆ¤æ–­å›ç­”è´¨é‡ã€‚ä½†è‡ªåŠ¨è¯„ä¼°æœ‰å…¶å±€é™æ€§ï¼ŒæŸäº›æ–¹é¢å¦‚åˆ›é€ æ€§ã€å®ç”¨æ€§ç­‰ä»ç„¶éœ€è¦äººå·¥è¯„ä¼°ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤š AI å…¬å¸ä¼šæ‹›äººæ¥äººå·¥æ ‡æ³¨ã€‚</p>
</li>
<li><p>ç»¼åˆåˆ†æä¸ä¼˜åŒ–ï¼šè¯†åˆ«å¤±è´¥æ¨¡å¼å’Œå¸¸è§é”™è¯¯ï¼Œæ¯”å¦‚åŒºåˆ†æ£€ç´¢å¤±è´¥å’Œç”Ÿæˆå¤±è´¥ï¼Œé’ˆå¯¹æ€§æ”¹è¿›ç³»ç»Ÿç»„ä»¶ã€‚</p>
</li>
</ol>
<blockquote>
<p>å¦‚æœé¢è¯•æ—¶ï¼Œé¢è¯•å®˜é—®åˆ°â€œä½ æ˜¯å¦‚ä½•è¯„ä¼°å’Œè°ƒä¼˜ RAG ç³»ç»Ÿçš„ï¼Ÿâ€ï¼Œå°±å¯ä»¥é‡‡ç”¨ä¸‹é¢è¿™æ ·çš„å›ç­”ï¼š</p>
<p>æˆ‘æ›¾å‚ä¸è¿‡ä¸€ä¸ªç¼–ç¨‹å’¨è¯¢ RAG ç³»ç»Ÿçš„è¯„ä¼°å’Œä¼˜åŒ–ã€‚ç³»ç»Ÿåœ¨å›ç­”å…·ä½“ç¼–ç¨‹æŠ€æœ¯é—®é¢˜æ—¶è¡¨ç°å‡ºè‰²ï¼Œä½†å¤„ç†â€œæ ¹æ®ä¸ªäººç¼–ç¨‹æƒ…å†µç»™å‡ºå­¦ä¹ å»ºè®®â€çš„å¤æ‚æ¡ˆä¾‹æ—¶è¡¨ç°ä¸å¥½ã€‚é€šè¿‡é”™è¯¯åˆ†æï¼Œæˆ‘ä»¬å‘ç°é—®é¢˜å‡ºåœ¨æ£€ç´¢é˜¶æ®µâ€”â€”ç³»ç»Ÿæ— æ³•åŒæ—¶æ£€ç´¢åˆ°ç›¸å…³æŠ€æœ¯çŸ¥è¯†å’Œç±»ä¼¼çš„å­¦ä¹ å»ºè®®ã€‚é’ˆå¯¹è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬è°ƒæ•´äº†æ£€ç´¢ç­–ç•¥ï¼Œä¸“é—¨ä¸ºå­¦ä¹ å»ºè®®ç±»é—®é¢˜è®¾è®¡äº†åŸºäºæ¡ˆä¾‹çš„æ£€ç´¢æ–¹æ³•ï¼Œä»è€Œæå‡äº†æ¨¡å‹å›å¤çš„å‡†ç¡®åº¦ã€‚</p>
</blockquote>
<p><img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130211458250.png" alt="image-20260130211458250"></p>
<h3 id="é«˜çº§RAGæ¶æ„"><a href="#é«˜çº§RAGæ¶æ„" class="headerlink" title="é«˜çº§RAGæ¶æ„"></a>é«˜çº§RAGæ¶æ„</h3><blockquote>
<p>æ³¨ï¼šå®é™…åº”ç”¨ä¼šç»“åˆä½¿ç”¨å¤šä¸ªï¼Œå¦‚å›ç­”å…¬å¸è´¢åŠ¡ä¿¡æ¯ä¼šç”¨C-RAGï¼Œå¤æ‚çš„æŠ•èµ„ç­–ç•¥åˆ†æä½¿ç”¨RAPTORå¤šç»´åº¦åˆ†æ</p>
<p>æœ€ç»ˆçš„æŒ‘æˆ˜ï¼šç²¾å‡†æ£€ç´¢çŸ¥è¯†ï¼Œæ— ç¼èå…¥ç”Ÿæˆè¿‡ç¨‹ï¼Œç»™ç”¨æˆ·ç”Ÿæˆå‡†ç¡®åˆè‡ªç„¶çš„ç»“æœ</p>
<p>æœªæ¥æ–¹å‘ï¼šå¤šæ¨¡æ€ã€é€‚åº”æ€§ï¼ˆæ ¹æ®ç”¨æˆ·åŠ¨æ€è°ƒæ•´ï¼‰ã€é«˜æ•ˆç‡</p>
</blockquote>
<h4 id="C-RAG-è‡ªçº é”™RAG"><a href="#C-RAG-è‡ªçº é”™RAG" class="headerlink" title="C-RAG è‡ªçº é”™RAG"></a>C-RAG è‡ªçº é”™RAG</h4><p>åœ¨å›ç­”è¿‡ç¨‹ä¸­ï¼Œé‡‡ç”¨â€œæ£€ç´¢-ç”Ÿæˆ-éªŒè¯-çº æ­£â€çš„é—­ç¯æµç¨‹ï¼Œå‘ç°é”™è¯¯å°±ç«‹å³é‡æ–°ç”Ÿæˆï¼Œä¿è¯å›ç­”çš„å‡†ç¡®æ€§ï¼Œé€‚åˆåŒ»ç–—ã€æ³•å¾‹ç­‰äº‹å®è¦æ±‚å‡†ç¡®æ€§é«˜åœºæ™¯ã€‚</p>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130211646484.png" alt="image-20260130211646484" style="zoom: 50%;" />	

<h4 id="self-RAG-è‡ªçœå¼RAG"><a href="#self-RAG-è‡ªçœå¼RAG" class="headerlink" title="self-RAG è‡ªçœå¼RAG"></a>self-RAG è‡ªçœå¼RAG</h4><p>è§£å†³çš„é—®é¢˜æ˜¯ï¼šå¹¶éæ‰€æœ‰é—®é¢˜éƒ½è¦æ£€ç´¢ï¼Œè®©å›ç­”æ›´è‡ªç„¶æé«˜æ£€ç´¢æ•ˆç‡ã€‚</p>
<p>å¦‚1+1ç­‰äºå‡ å¯ä»¥ç›´æ¥å›ç­”ï¼Œä¸éœ€è¦é¢å¤–æ£€ç´¢ï¼Œè®©ä»–ä¼šæ€è€ƒè¿™ä¸ªé—®é¢˜æ˜¯å¦éœ€è¦å¼•å…¥å¤–éƒ¨çŸ¥è¯†</p>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130211706839.png" alt="image-20260130211706839" style="zoom:50%;" />	

<h4 id="RAPTOR-æ£€ç´¢æ ‘RAG"><a href="#RAPTOR-æ£€ç´¢æ ‘RAG" class="headerlink" title="RAPTOR æ£€ç´¢æ ‘RAG"></a>RAPTOR æ£€ç´¢æ ‘RAG</h4><p>åœºæ™¯ï¼šå¯æ‹†åˆ†çš„å¤æ‚é—®é¢˜ï¼Œå¦‚æ•°å­¦é¢˜ï¼Œå¤§é—®é¢˜æ‹†åˆ†å¤šä¸ªå°é—®é¢˜</p>
<p>å¦‚ä»‹ç»å°çº¢ä¹¦çš„ç‚¹èµæ¨¡å—å’Œè¯„è®ºæ¨¡å—å¤šä¸ªé—®é¢˜ï¼ŒRAPTORä¼šåˆ†åˆ«æ£€ç´¢è¿™å‡ ä¸ªæ¨¡å—çš„ä¿¡æ¯ï¼Œç»¼åˆå¤šä¸ªä¿¡æ¯æ•´åˆç»™å‡ºæœ€ç»ˆç­”æ¡ˆï¼Œæé«˜é•¿ç¯‡å™è¿°çš„è¿è´¯æ€§å’Œå‡†ç¡®æ€§ï¼Œå¹¶å¯ä»¥å…‹æœå•æ¬¡æ£€ç´¢çš„ä¸Šä¸‹æ–‡é•¿åº¦çš„é™åˆ¶ã€‚</p>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130211714911.png" alt="image-20260130211714911" style="zoom:50%;" />	

<h4 id="å¤šæ™ºèƒ½ä½“RAGç³»ç»Ÿ"><a href="#å¤šæ™ºèƒ½ä½“RAGç³»ç»Ÿ" class="headerlink" title="å¤šæ™ºèƒ½ä½“RAGç³»ç»Ÿ"></a>å¤šæ™ºèƒ½ä½“RAGç³»ç»Ÿ</h4><p>å¤šä¸ªå¤§æ¨¡å‹å„è‡ªå¤„ç†è‡ªèº«æ“…é•¿çš„é¢†åŸŸï¼Œå„å¸å…¶èŒï¼Œå®ç°å¤æ‚ä»»åŠ¡ååŒå¤„ç†</p>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260130211724251.png" alt="image-20260130211724251" style="zoom:50%;" /></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://yuezi2048.github.io">yuezi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://yuezi2048.github.io/2026/01/30/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/4.RAG%E8%BF%9B%E9%98%B6/">https://yuezi2048.github.io/2026/01/30/2.AreasğŸŒ/ä¸´æ—¶è®°å½•/4.RAGè¿›é˜¶/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://yuezi2048.github.io" target="_blank">yuezi</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/">ä¸´æ—¶è®°å½•</a></div><div class="post-share"><div class="social-share" data-image="/img/touxiang.jpg" data-sites="qq,wechat"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/01/27/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/3.RAG/" title="3.RAG"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">3.RAG</div></div><div class="info-2"><div class="info-item-1">ä½¿ç”¨RAGï¼ˆRetrieval Augmentation Generation æ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰çš„éœ€æ±‚åˆ†æï¼š  çŸ¥è¯†æ‰©å±•ï¼Œç»™å‡ºæ›´ç²¾å‡†çš„å›ç­”  å‡å°å¹»è§‰  ä¸ªæ€§åŒ–è¾“å‡ºï¼šç‰¹è‰²æœåŠ¡å’Œå›ç­”é£æ ¼  æ¨é”€ï¼šæ¨é”€æˆ‘ä»¬çš„äº§å“å’ŒæœåŠ¡   å·¥ä½œæœºåˆ¶æ¦‚è§ˆ  æ–‡æ¡£æ”¶é›†å’Œåˆ‡å‰²  å‘é‡è½¬æ¢å’Œå­˜å‚¨  æ–‡æ¡£è¿‡æ»¤å’Œæ£€ç´¢  æŸ¥è¯¢å¢å¼ºå’Œå…³è”    æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰² æ”¶é›†çš„æ¥æºï¼šç½‘é¡µã€PDFã€æ•°æ®åº“ç­‰åŸå§‹æ–‡æ¡£ é¢„å¤„ç†ï¼šæ¸…æ´—ã€æ ‡å‡†åŒ–æ ¼å¼ åˆ‡å‰²ï¼šé•¿æ–‡æ¡£åˆ’åˆ†ä¸ºé€‚å½“çš„ç‰‡æ®µï¼ˆchunksï¼‰ åŸºäºå›ºå®šå¤§å°ï¼ˆå¦‚512tokenï¼‰ åŸºäºè¯­ä¹‰è¾¹ç•Œï¼ˆæ®µè½ ç« èŠ‚ï¼‰ åŸºäºé€’å½’åˆ†å‰²ç­–ç•¥ï¼ˆé€’å½’å­—ç¬¦ n-gramï¼‰    å‘é‡è½¬æ¢å’Œå­˜å‚¨å‘é‡è½¬æ¢ï¼šå°†æ–‡æœ¬é€šè¿‡Embeddingæ¨¡å‹è½¬åŒ–ä¸ºé«˜ç»´å‘é‡ï¼Œå¯æ•è·åˆ°è¯­ä¹‰ç‰¹å¾ å‘é‡å­˜å‚¨ï¼šå­˜å…¥å‘é‡æ•°æ®åº“ï¼Œæ”¯æŒç›¸ä¼¼åº¦æœç´¢   embedding ç»å…¸çš„æœ‰Word2Vecæ–‡æœ¬ã€ResNetå›¾åƒï¼Œä¸€èˆ¬çº¬åº¦è¶Šé«˜è¯­ä¹‰ä¿¡æ¯è¶Šä¸°å¯Œä½†å ç”¨ç©ºé—´è¶Šå¤š å‘é‡æ•°æ®åº“ï¼šå­˜å‚¨å‘é‡çš„æ•°æ®åº“ï¼Œæ”¯æŒç´¢å¼•ç®—æ³•å¿«é€Ÿç›¸ä¼¼åº¦æœç´¢ï¼Œæ”¯æŒkè¿‘é‚»æŸ¥è¯¢ï¼ˆæ³¨ï¼šä¼ ç»Ÿæ•°æ®åº“ä¹Ÿå¯ä»¥æ”¯æŒï¼Œå¦‚PGVectoræ’ä»¶ï¼ŒRedis...</div></div></div></a><a class="pagination-related" href="/2026/01/31/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/5.%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8/" title="5.å·¥å…·è°ƒç”¨"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">5.å·¥å…·è°ƒç”¨</div></div><div class="info-2"><div class="info-item-1">å…·ä½“å†…å®¹åŒ…æ‹¬: â€¢ å·¥å…·è°ƒç”¨ä»‹ç» â€¢ Spring AI å·¥å…·å¼€å‘ â€¢ ä¸»æµå·¥å…·å¼€å‘ â€¢ æ–‡ä»¶æ“ä½œ â€¢ è”ç½‘æœç´¢ â€¢ ç½‘é¡µæŠ“å– â€¢ ç»ˆç«¯æ“ä½œ â€¢ èµ„æºä¸‹è½½ â€¢ PDF ç”Ÿæˆ â€¢ å·¥å…·è¿›é˜¶çŸ¥è¯† (åŸç†å’Œé«˜çº§ç‰¹æ€§) éœ€æ±‚åˆ†æï¼šç°åœ¨é€šè¿‡RAGæŠ€æœ¯è®©AIå¯ä»¥æ ¹æ®å¤–éƒ¨çŸ¥è¯†åº“è·å–ä¿¡æ¯å›ç­”çš„èƒ½åŠ›ï¼Œä½†æ˜¯å¯èƒ½éœ€è¦ä¸€äº›å¤–éƒ¨å·¥å…·çš„åœºæ™¯ï¼š  è”ç½‘æœç´¢ï¼šå¦‚æ™ºèƒ½æ¨èçº¦ä¼šåœ°ç‚¹ï¼ˆå¦‚cursorçš„è”ç½‘æœç´¢ï¼Œé˜¿é‡Œäº‘ç™¾ç‚¼APIä¹Ÿæä¾›è¯¥é€‰é¡¹æ”¯æŒï¼‰ ç½‘é¡µæŠ“å–ï¼šå¦‚æŸ¥çœ‹ç™¾åº¦è´´å§å…¶ä»–å§å‹æ˜¯æ€ä¹ˆè§£å†³æƒ…æ„Ÿé—®é¢˜çš„ èµ„æºä¸‹è½½ï¼šä¸‹è½½çº¦ä¼šæ—¶çš„é’¢ç´æ›² ç»ˆç«¯æ“ä½œï¼šPythonç”Ÿæˆæ‹çˆ±åˆ†ææŠ¥å‘Š æ–‡ä»¶æ“ä½œï¼šä¿å­˜æ‹çˆ±æ¡£æ¡ˆ PDFç”Ÿæˆï¼šç”Ÿæˆä¸ƒå¤•çº¦ä¼šè®¡åˆ’PDFï¼Œé¤å…é¢„è®¢-æ´»åŠ¨æµç¨‹-ç¤¼ç‰©æ¸…å•   ä»¥ä¸Šå·¥å…·å¯è¿›è¡Œç»„åˆæ­é…ä½¿ç”¨ã€‚è®©aiä¸å†æ˜¯ç®€å•çš„é—®ç­”ç³»ç»Ÿï¼Œè€Œæ˜¯èƒ½å®Œæˆä»»åŠ¡çš„æ™ºèƒ½ä½“  å·¥å…·è°ƒç”¨ Tool Callingç›®çš„ï¼šè®©AIæ¥ä½¿ç”¨å¤–éƒ¨å·¥å…·å®Œæˆè‡ªå·±åšä¸åˆ°çš„äº‹æƒ…ï¼Œå¦‚æŸ¥è¯¢å¤©æ°”ï¼ŒAIæœ¬èº«æ²¡æœ‰è¿™äº›çŸ¥è¯†ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è”ç½‘æœç´¢æ¥å®Œæˆä»»åŠ¡ å®˜æ–¹æ–‡æ¡£ å·¥å…·è°ƒç”¨æ”¯æŒçš„æ¨¡å‹ å·¥å…·è°ƒç”¨çš„æµç¨‹ï¼š  å·¥å…·å®šä¹‰: ç¨‹åºå‘Šè¯‰ AI â€œä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·â€,...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2026/01/26/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/1.%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%8E%A5%E5%85%A5%E6%96%B9%E6%A1%88/" title="1.å¤§æ¨¡å‹æ¥å…¥æ–¹æ¡ˆ"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-26</div><div class="info-item-2">1.å¤§æ¨¡å‹æ¥å…¥æ–¹æ¡ˆ</div></div><div class="info-2"><div class="info-item-1">æ¥æºï¼šå¤§æ¨¡å‹æ¥å…¥ ç›¸å…³æ–‡æ¡£ aiçŸ¥è¯†åº“å­¦ä¹   ä¸»æµçš„AIåº“  lanchain4jæ–‡æ¡£ æ”¯æŒçš„æ¨¡å‹ æ•´åˆäº†å›½äº§æ¨¡å‹çš„ç¤¾åŒºç‰ˆæœ¬   springAIæ–‡æ¡£ æ”¯æŒçš„æ¨¡å‹   springAI Alibabaæ–‡æ¡£ ä½¿ç”¨Spring AI Alibabaé›†æˆé˜¿é‡Œäº‘ç™¾ç‚¼å¤§æ¨¡å‹åº”ç”¨    AIæ¥å…¥æœåŠ¡ï¼š  é˜¿é‡Œäº‘ç™¾ç‚¼ï¼šå¯è§†åŒ–å¹³å°ï¼ˆæ™ºèƒ½ä½“ã€å·¥ä½œæµã€æ™ºèƒ½ä½“ç¼–æ’ï¼‰ åº”ç”¨è°ƒç”¨æ–‡æ¡£ dashScope(çµç§¯)ï¼šAPIæ¥å£   ollamaæœ¬åœ°éƒ¨ç½²  AIå®¢æˆ·ç«¯ï¼š  cherry studio cursor  å¤§æ¨¡å‹å¼€å‘å·¥ä½œæµ	 ç¨‹åºå¦‚ä½•äº¤äº’å¤§æ¨¡å‹ç¨‹åºä¸å¤§æ¨¡å‹äº¤äº’çš„å®ç°æ€è·¯ï¼ˆdemo.invokeç›®å½•ï¼‰ï¼š  SDK ä¾èµ–DashScopeæ¥å…¥SDKâ€”â€”maven å¹³å°ç”³è¯·API key è®¿é—®APIï¼šé€šä¹‰åƒé—®APIå‚è€ƒ   HTTP æœ‰SDKä¼˜å…ˆSDK è®¾ç½®APIå¯†é’¥ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ å‘é€è¯·æ±‚ï¼Œå¤„ç†å“åº”   Spring AI  spring:  application:    name: spring-ai-alibaba-qwq-chat-client-example  ai:   ...</div></div></div></a><a class="pagination-related" href="/2026/01/26/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/2.%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/" title="2.å¤§æ¨¡å‹åº”ç”¨å¼€å‘"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-26</div><div class="info-item-2">2.å¤§æ¨¡å‹åº”ç”¨å¼€å‘</div></div><div class="info-2"><div class="info-item-1">â€¢ Prompt å·¥ç¨‹åŸºæœ¬æ¦‚å¿µ â€¢ Prompt ä¼˜åŒ–æŠ€å·§ â€¢ AI æ‹çˆ±å¤§å¸ˆåº”ç”¨éœ€æ±‚åˆ†æ â€¢ AI æ‹çˆ±å¤§å¸ˆåº”ç”¨æ–¹æ¡ˆè®¾è®¡ â€¢ Spring AI ChatClient &#x2F; Advisor &#x2F; ChatMemory ç‰¹æ€§ â€¢ å¤šè½®å¯¹è¯ AI åº”ç”¨å¼€å‘ â€¢ Spring AI è‡ªå®šä¹‰ Advisor â€¢ Spring AI ç»“æ„åŒ–è¾“å‡º - æ‹çˆ±æŠ¥å‘ŠåŠŸèƒ½ â€¢ Spring AI å¯¹è¯è®°å¿†æŒä¹…åŒ– â€¢ Spring AI Prompt æ¨¡æ¿ç‰¹æ€§ â€¢ å¤šæ¨¡æ€æ¦‚å¿µå’Œå¼€å‘ Promptå·¥ç¨‹Promptå·¥ç¨‹ï¼šé€šè¿‡ç²¾å¿ƒè®¾è®¡å’Œä¼˜åŒ–æç¤ºè¯ï¼Œå¼•å¯¼AIæ¨¡å‹çš„é«˜è´¨é‡è¾“å‡º Promptåˆ†ç±» åŸºäºè§’è‰²   User Promptï¼šå®é™…çš„æŒ‡ä»¤ System Promptï¼šæ¨¡å‹è¡Œä¸ºè§„åˆ™ï¼Œè§’è‰²å®šä½éšè—æŒ‡ä»¤ Assisant Promptï¼šå“åº”å†…å®¹ï¼ˆå¤šè½®å¯¹è¯ä¸­ä¹‹å‰å›å¤çš„å†…å®¹ï¼‰    åŸºäºåŠŸèƒ½   Instructional Promptsï¼šæŒ‡ä»¤å‹ Conversational Promptsï¼šå¯¹è¯å‹ Creative Promptsï¼šåˆ›æ„å‹ï¼Œæ•…äº‹è¯—æ­Œç­‰ Role-playing...</div></div></div></a><a class="pagination-related" href="/2026/01/27/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/3.RAG/" title="3.RAG"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-27</div><div class="info-item-2">3.RAG</div></div><div class="info-2"><div class="info-item-1">ä½¿ç”¨RAGï¼ˆRetrieval Augmentation Generation æ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰çš„éœ€æ±‚åˆ†æï¼š  çŸ¥è¯†æ‰©å±•ï¼Œç»™å‡ºæ›´ç²¾å‡†çš„å›ç­”  å‡å°å¹»è§‰  ä¸ªæ€§åŒ–è¾“å‡ºï¼šç‰¹è‰²æœåŠ¡å’Œå›ç­”é£æ ¼  æ¨é”€ï¼šæ¨é”€æˆ‘ä»¬çš„äº§å“å’ŒæœåŠ¡   å·¥ä½œæœºåˆ¶æ¦‚è§ˆ  æ–‡æ¡£æ”¶é›†å’Œåˆ‡å‰²  å‘é‡è½¬æ¢å’Œå­˜å‚¨  æ–‡æ¡£è¿‡æ»¤å’Œæ£€ç´¢  æŸ¥è¯¢å¢å¼ºå’Œå…³è”    æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰² æ”¶é›†çš„æ¥æºï¼šç½‘é¡µã€PDFã€æ•°æ®åº“ç­‰åŸå§‹æ–‡æ¡£ é¢„å¤„ç†ï¼šæ¸…æ´—ã€æ ‡å‡†åŒ–æ ¼å¼ åˆ‡å‰²ï¼šé•¿æ–‡æ¡£åˆ’åˆ†ä¸ºé€‚å½“çš„ç‰‡æ®µï¼ˆchunksï¼‰ åŸºäºå›ºå®šå¤§å°ï¼ˆå¦‚512tokenï¼‰ åŸºäºè¯­ä¹‰è¾¹ç•Œï¼ˆæ®µè½ ç« èŠ‚ï¼‰ åŸºäºé€’å½’åˆ†å‰²ç­–ç•¥ï¼ˆé€’å½’å­—ç¬¦ n-gramï¼‰    å‘é‡è½¬æ¢å’Œå­˜å‚¨å‘é‡è½¬æ¢ï¼šå°†æ–‡æœ¬é€šè¿‡Embeddingæ¨¡å‹è½¬åŒ–ä¸ºé«˜ç»´å‘é‡ï¼Œå¯æ•è·åˆ°è¯­ä¹‰ç‰¹å¾ å‘é‡å­˜å‚¨ï¼šå­˜å…¥å‘é‡æ•°æ®åº“ï¼Œæ”¯æŒç›¸ä¼¼åº¦æœç´¢   embedding ç»å…¸çš„æœ‰Word2Vecæ–‡æœ¬ã€ResNetå›¾åƒï¼Œä¸€èˆ¬çº¬åº¦è¶Šé«˜è¯­ä¹‰ä¿¡æ¯è¶Šä¸°å¯Œä½†å ç”¨ç©ºé—´è¶Šå¤š å‘é‡æ•°æ®åº“ï¼šå­˜å‚¨å‘é‡çš„æ•°æ®åº“ï¼Œæ”¯æŒç´¢å¼•ç®—æ³•å¿«é€Ÿç›¸ä¼¼åº¦æœç´¢ï¼Œæ”¯æŒkè¿‘é‚»æŸ¥è¯¢ï¼ˆæ³¨ï¼šä¼ ç»Ÿæ•°æ®åº“ä¹Ÿå¯ä»¥æ”¯æŒï¼Œå¦‚PGVectoræ’ä»¶ï¼ŒRedis...</div></div></div></a><a class="pagination-related" href="/2026/01/31/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/5.%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8/" title="5.å·¥å…·è°ƒç”¨"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-31</div><div class="info-item-2">5.å·¥å…·è°ƒç”¨</div></div><div class="info-2"><div class="info-item-1">å…·ä½“å†…å®¹åŒ…æ‹¬: â€¢ å·¥å…·è°ƒç”¨ä»‹ç» â€¢ Spring AI å·¥å…·å¼€å‘ â€¢ ä¸»æµå·¥å…·å¼€å‘ â€¢ æ–‡ä»¶æ“ä½œ â€¢ è”ç½‘æœç´¢ â€¢ ç½‘é¡µæŠ“å– â€¢ ç»ˆç«¯æ“ä½œ â€¢ èµ„æºä¸‹è½½ â€¢ PDF ç”Ÿæˆ â€¢ å·¥å…·è¿›é˜¶çŸ¥è¯† (åŸç†å’Œé«˜çº§ç‰¹æ€§) éœ€æ±‚åˆ†æï¼šç°åœ¨é€šè¿‡RAGæŠ€æœ¯è®©AIå¯ä»¥æ ¹æ®å¤–éƒ¨çŸ¥è¯†åº“è·å–ä¿¡æ¯å›ç­”çš„èƒ½åŠ›ï¼Œä½†æ˜¯å¯èƒ½éœ€è¦ä¸€äº›å¤–éƒ¨å·¥å…·çš„åœºæ™¯ï¼š  è”ç½‘æœç´¢ï¼šå¦‚æ™ºèƒ½æ¨èçº¦ä¼šåœ°ç‚¹ï¼ˆå¦‚cursorçš„è”ç½‘æœç´¢ï¼Œé˜¿é‡Œäº‘ç™¾ç‚¼APIä¹Ÿæä¾›è¯¥é€‰é¡¹æ”¯æŒï¼‰ ç½‘é¡µæŠ“å–ï¼šå¦‚æŸ¥çœ‹ç™¾åº¦è´´å§å…¶ä»–å§å‹æ˜¯æ€ä¹ˆè§£å†³æƒ…æ„Ÿé—®é¢˜çš„ èµ„æºä¸‹è½½ï¼šä¸‹è½½çº¦ä¼šæ—¶çš„é’¢ç´æ›² ç»ˆç«¯æ“ä½œï¼šPythonç”Ÿæˆæ‹çˆ±åˆ†ææŠ¥å‘Š æ–‡ä»¶æ“ä½œï¼šä¿å­˜æ‹çˆ±æ¡£æ¡ˆ PDFç”Ÿæˆï¼šç”Ÿæˆä¸ƒå¤•çº¦ä¼šè®¡åˆ’PDFï¼Œé¤å…é¢„è®¢-æ´»åŠ¨æµç¨‹-ç¤¼ç‰©æ¸…å•   ä»¥ä¸Šå·¥å…·å¯è¿›è¡Œç»„åˆæ­é…ä½¿ç”¨ã€‚è®©aiä¸å†æ˜¯ç®€å•çš„é—®ç­”ç³»ç»Ÿï¼Œè€Œæ˜¯èƒ½å®Œæˆä»»åŠ¡çš„æ™ºèƒ½ä½“  å·¥å…·è°ƒç”¨ Tool Callingç›®çš„ï¼šè®©AIæ¥ä½¿ç”¨å¤–éƒ¨å·¥å…·å®Œæˆè‡ªå·±åšä¸åˆ°çš„äº‹æƒ…ï¼Œå¦‚æŸ¥è¯¢å¤©æ°”ï¼ŒAIæœ¬èº«æ²¡æœ‰è¿™äº›çŸ¥è¯†ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è”ç½‘æœç´¢æ¥å®Œæˆä»»åŠ¡ å®˜æ–¹æ–‡æ¡£ å·¥å…·è°ƒç”¨æ”¯æŒçš„æ¨¡å‹ å·¥å…·è°ƒç”¨çš„æµç¨‹ï¼š  å·¥å…·å®šä¹‰: ç¨‹åºå‘Šè¯‰ AI â€œä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·â€,...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">yuezi</div><div class="author-info-description">ç§¯å¾®è€…é€Ÿæˆ</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">785</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">66</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">91</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yuezi2048"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://githubfast.com/yuezi2048" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://blog.csdn.net/qq_46345703" target="_blank" title="CSDN"><i class="fa fa-book-open"></i></a><a class="social-icon" href="https://qm.qq.com/cgi-bin/qm/qr?k=dD62GIPTf5-iS4UdSfJRy7NHwsrCh3-j" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="mailto:joyLing@stumail.nwu.edu.cn" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">ç§¯å¾®è€…é€Ÿæˆ</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#RAG%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0"><span class="toc-text">RAGè¿›é˜¶å­¦ä¹ </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E6%94%B6%E9%9B%86%E4%B8%8E%E5%88%87%E5%89%B2%EF%BC%88ETL%EF%BC%89"><span class="toc-text">æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²ï¼ˆETLï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ETL"><span class="toc-text">ETL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Extract-DocumentReader"><span class="toc-text">Extract_DocumentReader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Transform-DocumentTransformer"><span class="toc-text">Transform_DocumentTransformer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Load-DocmentWriter"><span class="toc-text">Load_DocmentWriter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E8%AF%B4%E6%98%8E"><span class="toc-text">æµç¨‹è¯´æ˜</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E8%BD%AC%E6%8D%A2%E4%B8%8E%E5%AD%98%E5%82%A8"><span class="toc-text">å‘é‡è½¬æ¢ä¸å­˜å‚¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VectorStore%E6%8E%A5%E5%8F%A3"><span class="toc-text">VectorStoreæ¥å£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E5%AD%98%E5%82%A8%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="toc-text">å‘é‡å­˜å‚¨å·¥ä½œæœºåˆ¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E6%88%98"><span class="toc-text">å‘é‡æ•°æ®åº“å­˜å‚¨æ•°æ®åº“å®æˆ˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%B9%E5%A4%84%E7%90%86%E4%BC%98%E5%8C%96"><span class="toc-text">æ‰¹å¤„ç†ä¼˜åŒ–</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E8%BF%87%E6%BB%A4%E4%B8%8E%E6%A3%80%E7%B4%A2"><span class="toc-text">æ–‡æ¡£è¿‡æ»¤ä¸æ£€ç´¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%84%E6%A3%80%E7%B4%A2%EF%BC%9A%E5%A2%9E%E5%BC%BA%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5"><span class="toc-text">é¢„æ£€ç´¢ï¼šå¢å¼ºç”¨æˆ·è¾“å…¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%EF%BC%9A%E6%8F%90%E9%AB%98%E6%9F%A5%E8%AF%A2%E7%9B%B8%E5%85%B3%E6%80%A7"><span class="toc-text">æ£€ç´¢ï¼šæé«˜æŸ¥è¯¢ç›¸å…³æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E5%90%8E%EF%BC%9A%E4%BC%98%E5%8C%96%E6%96%87%E6%A1%A3%E5%A4%84%E7%90%86"><span class="toc-text">æ£€ç´¢åï¼šä¼˜åŒ–æ–‡æ¡£å¤„ç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%A2%9E%E5%BC%BA%E4%B8%8E%E5%85%B3%E8%81%94"><span class="toc-text">æŸ¥è¯¢å¢å¼ºä¸å…³è”</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#QuestionAnswerAdvisor"><span class="toc-text">QuestionAnswerAdvisor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RetrievalAugmentationAdvisor"><span class="toc-text">RetrievalAugmentationAdvisor</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A9%BA%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-text">ç©ºä¸Šä¸‹æ–‡çš„å¤„ç†</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RAG%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98%E5%92%8C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">RAGè¿›é˜¶å®æˆ˜å’Œæœ€ä½³å®è·µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E6%94%B6%E9%9B%86%E4%B8%8E%E5%88%87%E5%89%B2-ETL"><span class="toc-text">æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²-ETL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E6%96%87%E6%A1%A3%E4%BC%98%E5%8C%96"><span class="toc-text">åŸå§‹æ–‡æ¡£ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E5%88%87%E7%89%87"><span class="toc-text">æ–‡æ¡£åˆ‡ç‰‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E6%A0%87%E6%B3%A8"><span class="toc-text">å…ƒæ•°æ®æ ‡æ³¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E8%BD%AC%E6%8D%A2%E4%B8%8E%E5%AD%98%E5%82%A8-1"><span class="toc-text">å‘é‡è½¬æ¢ä¸å­˜å‚¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E8%BF%87%E6%BB%A4%E5%92%8C%E6%A3%80%E7%B4%A2"><span class="toc-text">æ–‡æ¡£è¿‡æ»¤å’Œæ£€ç´¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%9F%A5%E8%AF%A2%E6%89%A9%E5%B1%95"><span class="toc-text">å¤šæŸ¥è¯¢æ‰©å±•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E9%87%8D%E5%86%99-%E7%BF%BB%E8%AF%91"><span class="toc-text">æŸ¥è¯¢é‡å†™&#x2F;ç¿»è¯‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">æ£€ç´¢å™¨é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%A2%9E%E5%BC%BA%E4%B8%8E%E5%85%B3%E8%81%94-1"><span class="toc-text">æŸ¥è¯¢å¢å¼ºä¸å…³è”</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6"><span class="toc-text">é”™è¯¯å¤„ç†æœºåˆ¶</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85"><span class="toc-text">é«˜çº§çŸ¥è¯†è¡¥å……</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E6%A3%80%E7%B4%A2"><span class="toc-text">æ··åˆæ£€ç´¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B9%BB%E8%A7%89%E9%97%AE%E9%A2%98"><span class="toc-text">å¤§æ¨¡å‹å¹»è§‰é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAG%E5%BA%94%E7%94%A8%E8%AF%84%E4%BC%B0"><span class="toc-text">RAGåº”ç”¨è¯„ä¼°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7RAG%E6%9E%B6%E6%9E%84"><span class="toc-text">é«˜çº§RAGæ¶æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#C-RAG-%E8%87%AA%E7%BA%A0%E9%94%99RAG"><span class="toc-text">C-RAG è‡ªçº é”™RAG</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#self-RAG-%E8%87%AA%E7%9C%81%E5%BC%8FRAG"><span class="toc-text">self-RAG è‡ªçœå¼RAG</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RAPTOR-%E6%A3%80%E7%B4%A2%E6%A0%91RAG"><span class="toc-text">RAPTOR æ£€ç´¢æ ‘RAG</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93RAG%E7%B3%BB%E7%BB%9F"><span class="toc-text">å¤šæ™ºèƒ½ä½“RAGç³»ç»Ÿ</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/22/Excalidraw/Drawing%202024-11-01%2015.37.37.excalidraw/" title="Drawing 2024-11-01 15.37.37.excalidraw">Drawing 2024-11-01 15.37.37.excalidraw</a><time datetime="2026-02-22T05:56:41.839Z" title="å‘è¡¨äº 2026-02-22 13:56:41">2026-02-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/22/2.Areas%F0%9F%8C%90/01.project/condefather/yupao/back-end/7.%E4%BC%98%E5%8C%96%E4%B8%BB%E9%A1%B5%E6%80%A7%E8%83%BD-%E4%BC%98%E5%8C%96%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE/" title="7.ä¼˜åŒ–ä¸»é¡µæ€§èƒ½-ä¼˜åŒ–æ‰¹é‡å¯¼å…¥æ•°æ®">7.ä¼˜åŒ–ä¸»é¡µæ€§èƒ½-ä¼˜åŒ–æ‰¹é‡å¯¼å…¥æ•°æ®</a><time datetime="2026-02-22T05:56:41.257Z" title="å‘è¡¨äº 2026-02-22 13:56:41">2026-02-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/31/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/5.%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8/" title="5.å·¥å…·è°ƒç”¨">5.å·¥å…·è°ƒç”¨</a><time datetime="2026-01-31T03:54:22.000Z" title="å‘è¡¨äº 2026-01-31 11:54:22">2026-01-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/30/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/4.RAG%E8%BF%9B%E9%98%B6/" title="4.RAGè¿›é˜¶">4.RAGè¿›é˜¶</a><time datetime="2026-01-30T13:23:42.000Z" title="å‘è¡¨äº 2026-01-30 21:23:42">2026-01-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/27/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/3.RAG/" title="3.RAG">3.RAG</a><time datetime="2026-01-27T09:06:56.000Z" title="å‘è¡¨äº 2026-01-27 17:06:56">2026-01-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/default.png);"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2026 By yuezi</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.0.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>