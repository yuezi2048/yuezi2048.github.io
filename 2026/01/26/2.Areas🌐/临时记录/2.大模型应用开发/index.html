<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>2.å¤§æ¨¡å‹åº”ç”¨å¼€å‘ | yuezi</title><meta name="author" content="yuezi"><meta name="copyright" content="yuezi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="â€¢ Prompt å·¥ç¨‹åŸºæœ¬æ¦‚å¿µ â€¢ Prompt ä¼˜åŒ–æŠ€å·§ â€¢ AI æ‹çˆ±å¤§å¸ˆåº”ç”¨éœ€æ±‚åˆ†æ â€¢ AI æ‹çˆ±å¤§å¸ˆåº”ç”¨æ–¹æ¡ˆè®¾è®¡ â€¢ Spring AI ChatClient &#x2F; Advisor &#x2F; ChatMemory ç‰¹æ€§ â€¢ å¤šè½®å¯¹è¯ AI åº”ç”¨å¼€å‘ â€¢ Spring AI è‡ªå®šä¹‰ Advisor â€¢ Spring AI ç»“æ„åŒ–è¾“å‡º - æ‹çˆ±æŠ¥å‘ŠåŠŸèƒ½ â€¢ Spring AI å¯¹">
<meta property="og:type" content="article">
<meta property="og:title" content="2.å¤§æ¨¡å‹åº”ç”¨å¼€å‘">
<meta property="og:url" content="https://yuezi2048.github.io/2026/01/26/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/2.%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/index.html">
<meta property="og:site_name" content="yuezi">
<meta property="og:description" content="â€¢ Prompt å·¥ç¨‹åŸºæœ¬æ¦‚å¿µ â€¢ Prompt ä¼˜åŒ–æŠ€å·§ â€¢ AI æ‹çˆ±å¤§å¸ˆåº”ç”¨éœ€æ±‚åˆ†æ â€¢ AI æ‹çˆ±å¤§å¸ˆåº”ç”¨æ–¹æ¡ˆè®¾è®¡ â€¢ Spring AI ChatClient &#x2F; Advisor &#x2F; ChatMemory ç‰¹æ€§ â€¢ å¤šè½®å¯¹è¯ AI åº”ç”¨å¼€å‘ â€¢ Spring AI è‡ªå®šä¹‰ Advisor â€¢ Spring AI ç»“æ„åŒ–è¾“å‡º - æ‹çˆ±æŠ¥å‘ŠåŠŸèƒ½ â€¢ Spring AI å¯¹">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yuezi2048.github.io/img/touxiang.jpg">
<meta property="article:published_time" content="2026-01-26T14:24:44.000Z">
<meta property="article:modified_time" content="2026-01-26T14:24:44.000Z">
<meta property="article:author" content="yuezi">
<meta property="article:tag" content="ä¸´æ—¶è®°å½•">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yuezi2048.github.io/img/touxiang.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "2.å¤§æ¨¡å‹åº”ç”¨å¼€å‘",
  "url": "https://yuezi2048.github.io/2026/01/26/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/2.%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/",
  "image": "https://yuezi2048.github.io/img/touxiang.jpg",
  "datePublished": "2026-01-26T14:24:44.000Z",
  "dateModified": "2026-01-26T14:24:44.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "yuezi",
      "url": "https://yuezi2048.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://yuezi2048.github.io/2026/01/26/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/2.%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?bfb48b678d82bea9f9cc9d59227767e4";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"FPH6F2TOJL","apiKey":"06d9ea26c803ba912b4d8e13404ed34d","indexName":"blog","hitsPerPage":6,"languages":{"input_placeholder":"æœç´¢","hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œè€—æ—¶ ${time} æ¯«ç§’"}},
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":350,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '2.å¤§æ¨¡å‹åº”ç”¨å¼€å‘',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/backgound.css"><meta name="generator" content="Hexo 8.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-original="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">785</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">66</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">91</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> åšæ–‡</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> å½’æ¡£</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äºç¬”è€…</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/default.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">yuezi</span></a><a class="nav-page-title" href="/"><span class="site-name">2.å¤§æ¨¡å‹åº”ç”¨å¼€å‘</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> åšæ–‡</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> å½’æ¡£</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äºç¬”è€…</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">2.å¤§æ¨¡å‹åº”ç”¨å¼€å‘</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2026-01-26T14:24:44.000Z" title="å‘è¡¨äº 2026-01-26 22:24:44">2026-01-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2026-01-26T14:24:44.000Z" title="æ›´æ–°äº 2026-01-26 22:24:44">2026-01-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/2-Areas%F0%9F%8C%90/">2.AreasğŸŒ</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/2-Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/">ä¸´æ—¶è®°å½•</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">5.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>21åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>â€¢ Prompt å·¥ç¨‹åŸºæœ¬æ¦‚å¿µ</p>
<p>â€¢ Prompt ä¼˜åŒ–æŠ€å·§</p>
<p>â€¢ AI æ‹çˆ±å¤§å¸ˆåº”ç”¨éœ€æ±‚åˆ†æ</p>
<p>â€¢ AI æ‹çˆ±å¤§å¸ˆåº”ç”¨æ–¹æ¡ˆè®¾è®¡</p>
<p>â€¢ Spring AI ChatClient &#x2F; Advisor &#x2F; ChatMemory ç‰¹æ€§</p>
<p>â€¢ å¤šè½®å¯¹è¯ AI åº”ç”¨å¼€å‘</p>
<p>â€¢ Spring AI è‡ªå®šä¹‰ Advisor</p>
<p>â€¢ Spring AI ç»“æ„åŒ–è¾“å‡º - æ‹çˆ±æŠ¥å‘ŠåŠŸèƒ½</p>
<p>â€¢ Spring AI å¯¹è¯è®°å¿†æŒä¹…åŒ–</p>
<p>â€¢ Spring AI Prompt æ¨¡æ¿ç‰¹æ€§</p>
<p>â€¢ å¤šæ¨¡æ€æ¦‚å¿µå’Œå¼€å‘</p>
<h2 id="Promptå·¥ç¨‹"><a href="#Promptå·¥ç¨‹" class="headerlink" title="Promptå·¥ç¨‹"></a>Promptå·¥ç¨‹</h2><p>Promptå·¥ç¨‹ï¼šé€šè¿‡ç²¾å¿ƒè®¾è®¡å’Œä¼˜åŒ–æç¤ºè¯ï¼Œå¼•å¯¼AIæ¨¡å‹çš„é«˜è´¨é‡è¾“å‡º</p>
<h3 id="Promptåˆ†ç±»"><a href="#Promptåˆ†ç±»" class="headerlink" title="Promptåˆ†ç±»"></a>Promptåˆ†ç±»</h3><blockquote>
<p>åŸºäºè§’è‰²</p>
</blockquote>
<ul>
<li>User Promptï¼šå®é™…çš„æŒ‡ä»¤</li>
<li>System Promptï¼šæ¨¡å‹è¡Œä¸ºè§„åˆ™ï¼Œè§’è‰²å®šä½éšè—æŒ‡ä»¤</li>
<li>Assisant Promptï¼šå“åº”å†…å®¹ï¼ˆå¤šè½®å¯¹è¯ä¸­ä¹‹å‰å›å¤çš„å†…å®¹ï¼‰</li>
</ul>
<p><img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260126162306389.png" alt="image-20260126162306389"></p>
<blockquote>
<p>åŸºäºåŠŸèƒ½</p>
</blockquote>
<ul>
<li>Instructional Promptsï¼šæŒ‡ä»¤å‹</li>
<li>Conversational Promptsï¼šå¯¹è¯å‹</li>
<li>Creative Promptsï¼šåˆ›æ„å‹ï¼Œæ•…äº‹è¯—æ­Œç­‰</li>
<li>Role-playing Promptsï¼šè§’è‰²æ‰®æ¼”</li>
<li>Few-Shot Promptsï¼šå°‘æ ·æœ¬å­¦ä¹ ï¼ˆæä¾›ä¸€äº›ç¤ºä¾‹ï¼‰</li>
</ul>
<blockquote>
<p>åŸºäºå¤æ‚åº¦</p>
</blockquote>
<ul>
<li>Simple Promptsï¼šç®€å•æç¤ºè¯</li>
<li>Compound Promptsï¼šå¤æ‚æç¤ºè¯ï¼ˆå¤šä¸ªæŒ‡ä»¤ï¼‰</li>
<li>Chain Promptsï¼šé“¾å¼æç¤ºè¯ï¼ˆç¬¬ä¸€æ­¥ï¼Œç¬¬äºŒæ­¥â€¦ï¼‰</li>
<li>Template Promptsï¼šæ¨¡æ¿æç¤ºè¯ï¼ˆå¯æ›¿æ¢å˜é‡ï¼‰</li>
</ul>
<h3 id="æç¤ºè¯ä¼˜åŒ–"><a href="#æç¤ºè¯ä¼˜åŒ–" class="headerlink" title="æç¤ºè¯ä¼˜åŒ–"></a>æç¤ºè¯ä¼˜åŒ–</h3><p>Tokenï¼š 100ä¸ªå•è¯å¤§æ¦‚75<del>150tokenï¼Œ100ä¸ªä¸­æ–‡å¤§æ¦‚100</del>200tokenï¼Œæˆæœ¬&#x3D;è¾“å…¥token * è¾“å…¥å•ä»· + è¾“å‡ºtoken * è¾“å‡ºå•ä»· ï¼Œå®é™…éœ€è¦å¯¹æ¯”å„å®¶çš„ä»·æ ¼</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://platform.openai.com/tokenizer">openAIå®˜æ–¹tokenè®¡ç®—</a></li>
<li><a target="_blank" rel="noopener" href="https://tiktoken.aigc2d.com/">éå®˜æ–¹tokenè®¡ç®—</a></li>
</ul>
<blockquote>
<p>ç³»ç»Ÿæç¤ºè¯ã€ç”¨æˆ·æç¤ºè¯ã€è¾“å‡ºå†…å®¹éƒ½ç®—åštokenï¼Œéœ€è¦ä»è¿™äº›è§’åº¦ä¼˜åŒ–token</p>
<ul>
<li>æç¤ºè¯ç²¾ç®€<ul>
<li>å‘é‡æ£€ç´¢ä»£æ›¿ç›´æ¥è¾“å…¥</li>
<li>ç»“æ„åŒ–ä»£æ›¿è‡ªç„¶è¯­è¨€ï¼ˆå¦‚è¡¨æ ¼ã€åˆ—è¡¨ç­‰ç»“æ„åŒ–ä»£æ›¿é•¿æ®µçš„æ–‡æœ¬æè¿°ï¼‰</li>
</ul>
</li>
<li>å®šæœŸæ¸…ç†ä¸Šä¸‹æ–‡</li>
</ul>
</blockquote>
<p>å„å®¶çš„æç¤ºè¯ä¼˜åŒ–æ–‡æ¡£ï¼ˆauthropicsæ³¨æ„åœ°åŒºé™åˆ¶ï¼‰ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.promptingguide.ai/zh">promptingguide</a></li>
<li><a target="_blank" rel="noopener" href="http://docs.spring.io/spring-ai/reference/api/prompt.html#_prompt_engineering">SpringAI</a></li>
<li><a target="_blank" rel="noopener" href="https://platform.openai.com/docs/guides/prompt-engineering">OpenAI</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/anthropics/prompt-eng-interactive-tutorial">anthropicsæç¤ºè¯å¼€æºä»“åº“</a></li>
<li><a target="_blank" rel="noopener" href="https://claude.com/app-unavailable-in-region">anthropicsæç¤ºè¯æŒ‡å—</a></li>
<li><a target="_blank" rel="noopener" href="https://open.bigmodel.cn/dev/guidelines/LanguageModels">æ™ºè°±AI</a></li>
</ul>
<p>æç¤ºè¯åº“</p>
<ul>
<li>æ–‡æœ¬ï¼š<a target="_blank" rel="noopener" href="https://claude.com/app-unavailable-in-region">Authropicæç¤ºè¯åº“</a></li>
<li>å›¾åƒï¼š<a target="_blank" rel="noopener" href="https://promptlibrary.org/">midjourneyæç¤ºè¯åº“</a></li>
</ul>
<p>æç¤ºè¯ä¼˜åŒ–æ€è·¯ï¼š</p>
<ul>
<li>è¿­ä»£å¼æç¤ºè¯ä¼˜åŒ–ï¼šå¤šè½®å¯¹è¯æ”¹è¿›</li>
<li>è¾¹ç•Œæµ‹è¯•ï¼šç»™å‡ºæé™çš„æƒ…å†µæ¥ä¼˜åŒ–</li>
<li>æç¤ºè¯æ¨¡æ¿åŒ–ï¼šç»Ÿä¸€è¾“å‡ºå½¢å¼ä¾¿äºè°ƒè¯•</li>
<li>é”™è¯¯åˆ†æä¸çº æ­£ï¼šç³»ç»Ÿåˆ†ææ¨¡å‹çš„é”™è¯¯ï¼Œé’ˆå¯¹æ€§ä¼˜åŒ–æç¤ºè¯ï¼ˆè¦è®©aiæ³¨æ„åˆ°è¿™äº›é—®é¢˜ç‚¹ï¼‰</li>
</ul>
<blockquote>
<p>æ€»ç»“ï¼šä»»åŠ¡è¶Šå¤æ‚ï¼Œ è¶Šè¦ç»™Prompt<a target="_blank" rel="noopener" href="https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md">è¡¥å……ç»†èŠ‚</a></p>
</blockquote>
<h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><p>éœ€æ±‚åˆ†æï¼šé’ˆå¯¹aiç»™å‡ºçš„éœ€æ±‚æ–‡æ¡£è¿›è¡Œè¯„å®¡å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æˆ‘è¦å¼€å‘ä¸€ä¸ªã€æ‹çˆ±å¤§å¸ˆã€‘AI åº”ç”¨ï¼Œç”¨æˆ·åœ¨æ‹çˆ±è¿‡ç¨‹ä¸­éš¾å…é‡åˆ°å„ç§éš¾é¢˜ï¼Œè®© AI ä¸ºç”¨æˆ·æä¾›è´´å¿ƒæƒ…æ„ŸæŒ‡å¯¼ã€‚</span><br><span class="line">è¯·ä½ å¸®æˆ‘è¿›è¡Œéœ€æ±‚åˆ†æï¼Œæ»¡è¶³æˆ‘çš„ç›®æ ‡ã€‚</span><br><span class="line"></span><br><span class="line">å…·ä½“éœ€è¦:</span><br><span class="line">1. åˆ†æç›®æ ‡ç”¨æˆ·ç¾¤ä½“åŠå…¶æ ¸å¿ƒéœ€æ±‚</span><br><span class="line">2. æå‡ºä¸»è¦åŠŸèƒ½æ¨¡å—å’ŒæœåŠ¡å†…å®¹</span><br><span class="line">3. è€ƒè™‘äº§å“çš„å·®å¼‚åŒ–ç«äº‰ç‚¹</span><br><span class="line">4. åˆ†æå¯èƒ½çš„æŠ€æœ¯æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆ</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>æœ€å°å¯è¡Œäº§å“ç­–ç•¥</code>ï¼ˆMVPï¼‰ï¼šä¼˜å…ˆå¼€å‘æ ¸å¿ƒå†…å®¹ï¼Œæ ¹æ®ç”¨æˆ·åé¦ˆå†³å®šä¸‹ä¸€æ­¥æ˜¯æ·±æŒ–å¯¹è¯åŠŸèƒ½è¿˜æ˜¯æ‰©å±•åŠŸèƒ½ç‚¹</p>
</blockquote>
<h2 id="ç³»ç»Ÿå®ç°æ–¹æ¡ˆ"><a href="#ç³»ç»Ÿå®ç°æ–¹æ¡ˆ" class="headerlink" title="ç³»ç»Ÿå®ç°æ–¹æ¡ˆ"></a>ç³»ç»Ÿå®ç°æ–¹æ¡ˆ</h2><p>AIå®ç°æ–¹æ¡ˆè®¾è®¡ï¼š</p>
<blockquote>
<ul>
<li>ç³»ç»Ÿæç¤ºè¯</li>
<li>å¤šè½®å¯¹è¯</li>
</ul>
</blockquote>
<h3 id="ç³»ç»Ÿæç¤ºè¯è®¾è®¡"><a href="#ç³»ç»Ÿæç¤ºè¯è®¾è®¡" class="headerlink" title="ç³»ç»Ÿæç¤ºè¯è®¾è®¡"></a>ç³»ç»Ÿæç¤ºè¯è®¾è®¡</h3><p>ç³»ç»Ÿæç¤ºè¯è®¾è®¡ï¼šå¯å€ŸåŠ©AIä¼˜åŒ–ï¼Œæ¯”å¦‚ä¸“å®¶éœ€è¦æä¾›ä¸€äº›å¼•å¯¼æ€§çš„é—®é¢˜æ¥æ·±å…¥äº†è§£ï¼ˆå¼€å‘å‰æœ€å¥½åœ¨å¤§æ¨¡å‹å¹³å°ä¸­è¿›è¡Œæµ‹è¯•å’Œè°ƒä¼˜ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ‰®æ¼”æ·±è€•æ‹çˆ±å¿ƒç†é¢†åŸŸçš„ä¸“å®¶ã€‚å¼€åœºå‘ç”¨æˆ·è¡¨æ˜èº«ä»½ï¼Œå‘ŠçŸ¥ç”¨æˆ·å¯å€¾è¯‰æ‹çˆ±éš¾é¢˜ã€‚å›´ç»•å•èº«ã€æ‹çˆ±ã€å·²å©šä¸‰ç§çŠ¶æ€æé—®ï¼šå•èº«çŠ¶æ€è¯¢é—®ç¤¾äº¤åœˆæ‹“å±•åŠè¿½æ±‚å¿ƒä»ªå¯¹è±¡çš„å›°æ‰°ï¼›æ‹çˆ±çŠ¶æ€è¯¢é—®æ²Ÿé€šã€ä¹ æƒ¯å·®å¼‚å¼•å‘çš„çŸ›ç›¾ï¼›å·²å©šçŠ¶æ€è¯¢é—®å®¶åº­è´£ä»»ä¸äº²å±å…³ç³»å¤„ç†çš„é—®é¢˜ã€‚å¼•å¯¼ç”¨æˆ·è¯¦è¿°äº‹æƒ…ç»è¿‡ã€å¯¹æ–¹ååº”åŠè‡ªèº«æƒ³æ³•ï¼Œä»¥ä¾¿ç»™å‡ºä¸“å±è§£å†³æ–¹æ¡ˆã€‚</span><br></pre></td></tr></table></figure>

<h3 id="å¤šè½®å¯¹è¯"><a href="#å¤šè½®å¯¹è¯" class="headerlink" title="å¤šè½®å¯¹è¯"></a>å¤šè½®å¯¹è¯</h3><h4 id="chatClientç‰¹æ€§"><a href="#chatClientç‰¹æ€§" class="headerlink" title="chatClientç‰¹æ€§"></a>chatClientç‰¹æ€§</h4><p>è¿™é‡Œé€šè¿‡SpringAI <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/chatclient.html">ChatClientçš„API</a>æ¥å®ç°æ›´å¤æ‚çš„é“¾å¼è°ƒç”¨ï¼ˆFluent APIï¼Œè¿™æ˜¯ChatClientå’ŒChatModalçš„åŒºåˆ«ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŸºç¡€ç”¨æ³•(ChatModel)</span></span><br><span class="line"><span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatModel.call(<span class="keyword">new</span> <span class="title class_">Prompt</span>(<span class="string">&quot;ä½ å¥½&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// é«˜çº§ç”¨æ³•(ChatClient)</span></span><br><span class="line"><span class="comment">// æ–¹å¼1ï¼šä½¿ç”¨æ„é€ å™¨æ³¨å…¥</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatService</span><span class="params">(ChatClient.Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = builder</span><br><span class="line">            .defaultSystem(<span class="string">&quot;ä½ æ˜¯æ‹çˆ±é¡¾é—®&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2ï¼šä½¿ç”¨å»ºé€ è€…æ¨¡å¼</span></span><br><span class="line"><span class="type">ChatClient</span> <span class="variable">chatClient</span> <span class="operator">=</span> ChatClient.builder(chatModel)</span><br><span class="line">    .defaultSystem(<span class="string">&quot;ä½ æ˜¯æ‹çˆ±é¡¾é—®&quot;</span>)</span><br><span class="line">    .build();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒChatClientå¯ä»¥è¿”å›å¤šç§å½¢å¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ChatClientæ”¯æŒå¤šç§å“åº”æ ¼å¼</span></span><br><span class="line"><span class="comment">// 1. è¿”å› ChatResponse å¯¹è±¡ï¼ˆåŒ…å«å…ƒæ•°æ®å¦‚ token ä½¿ç”¨é‡ï¼‰</span></span><br><span class="line"><span class="type">ChatResponse</span> <span class="variable">chatResponse</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">    .user(<span class="string">&quot;Tell me a joke&quot;</span>)</span><br><span class="line">    .call()</span><br><span class="line">    .chatResponse();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. è¿”å›å®ä½“å¯¹è±¡ï¼ˆè‡ªåŠ¨å°† AI è¾“å‡ºæ˜ å°„ä¸º Java å¯¹è±¡ï¼‰</span></span><br><span class="line"><span class="comment">// 2.1 è¿”å›å•ä¸ªå®ä½“</span></span><br><span class="line"><span class="keyword">record</span> <span class="title class_">ActorFilms</span><span class="params">(String actor, List&lt;String&gt; movies)</span> &#123;&#125;</span><br><span class="line"><span class="type">ActorFilms</span> <span class="variable">actorFilms</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">    .user(<span class="string">&quot;Generate the filmography for a random actor.&quot;</span>)</span><br><span class="line">    .call()</span><br><span class="line">    .entity(ActorFilms.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.2 è¿”å›æ³›å‹é›†åˆ</span></span><br><span class="line">List&lt;ActorFilms&gt; multipleActors = chatClient.prompt()</span><br><span class="line">    .user(<span class="string">&quot;Generate filmography for Tom Hanks and Bill Murray.&quot;</span>)</span><br><span class="line">    .call()</span><br><span class="line">    .entity(<span class="keyword">new</span> <span class="title class_">ParameterizedTypeReference</span>&lt;List&lt;ActorFilms&gt;&gt;() &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æµå¼è¿”å›ï¼ˆé€‚ç”¨äºæ‰“å­—æœºæ•ˆæœï¼‰</span></span><br><span class="line">Flux&lt;String&gt; streamResponse = chatClient.prompt()</span><br><span class="line">    .user(<span class="string">&quot;Tell me a story&quot;</span>)</span><br><span class="line">    .stream()</span><br><span class="line">    .content();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥æµå¼è¿”å›ChatResponse</span></span><br><span class="line">Flux&lt;ChatResponse&gt; streamWithMetadata = chatClient.prompt()</span><br><span class="line">    .user(<span class="string">&quot;Tell me a story&quot;</span>)</span><br><span class="line">    .stream()</span><br><span class="line">    .chatResponse();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é¢„è®¾ç³»ç»Ÿæç¤ºè¯ï¼ˆåç»­å¯ä»¥æ”¯æŒé»˜è®¤å¯¹è¯é€‰é¡¹ã€é»˜è®¤æ‹¦æˆªå™¨ã€é»˜è®¤å‡½æ•°è°ƒç”¨ç­‰ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰é»˜è®¤ç³»ç»Ÿæç¤ºè¯</span></span><br><span class="line"><span class="type">ChatClient</span> <span class="variable">chatClient</span> <span class="operator">=</span> ChatClient.builder(chatModel)</span><br><span class="line">        .defaultSystem(<span class="string">&quot;You are a friendly chat bot that answers question in the voice of a &#123;voice&#125;&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è¯æ—¶åŠ¨æ€æ›´æ”¹ç³»ç»Ÿæç¤ºè¯çš„å˜é‡</span></span><br><span class="line">chatClient.prompt()</span><br><span class="line">        .system(sp -&gt; sp.param(<span class="string">&quot;voice&quot;</span>, voice))</span><br><span class="line">        .user(message)</span><br><span class="line">        .call()</span><br><span class="line">        .content());</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="Advisors"><a href="#Advisors" class="headerlink" title="Advisors"></a>Advisors</h4><p><strong>Advisorsé¡¾é—®</strong>ï¼ˆå¯æ’æ‹”çš„æ‹¦æˆªå™¨ï¼Œè°ƒç”¨å‰åçš„é¢å¤–æ“ä½œï¼‰</p>
<ul>
<li>è°ƒç”¨å‰ï¼šæ£€æŸ¥æç¤ºè¯æ˜¯å¦å®‰å…¨</li>
<li>è°ƒç”¨åï¼šè®°å½•æ—¥å¿—ï¼Œå¤„ç†è¿”å›ç»“æœ</li>
</ul>
<blockquote>
<p>è¿™é‡Œç»™å‡ºå¯¹è¯è®°å¿†ã€RAGæ£€ç´¢å¢å¼ºçš„åŠŸèƒ½ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">chatClient</span> <span class="operator">=</span> ChatClient.builder(chatModel)</span><br><span class="line">    .defaultAdvisors(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MessageChatMemoryAdvisor</span>(chatMemory), <span class="comment">// å¯¹è¯è®°å¿† advisor</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">QuestionAnswerAdvisor</span>(vectorStore)    <span class="comment">// RAG æ£€ç´¢å¢å¼º advisor</span></span><br><span class="line">    )</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> <span class="built_in">this</span>.chatClient.prompt()</span><br><span class="line">    <span class="comment">// å¯¹è¯æ—¶åŠ¨æ€è®¾å®šæ‹¦æˆªå™¨å‚æ•°ï¼Œæ¯”å¦‚æŒ‡å®šå¯¹è¯è®°å¿†çš„ id å’Œé•¿åº¦</span></span><br><span class="line">    .advisors(advisor -&gt; advisor.param(<span class="string">&quot;chat_memory_conversation_id&quot;</span>, <span class="string">&quot;678&quot;</span>)</span><br><span class="line">            .param(<span class="string">&quot;chat_memory_response_size&quot;</span>, <span class="number">100</span>))</span><br><span class="line">    .user(userText)</span><br><span class="line">    .call()</span><br><span class="line">	.content();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="æ‰§è¡ŒåŸç†"><a href="#æ‰§è¡ŒåŸç†" class="headerlink" title="æ‰§è¡ŒåŸç†"></a>æ‰§è¡ŒåŸç†</h5><blockquote>
<p>Advisorsæ‰§è¡ŒåŸç†ï¼ˆPrompt-&gt;AdvisedRequest-&gt;ã€Prompt-&gt;ChatResponseã€‘-&gt;AdvisedResponse-&gt;ChatResponseï¼ŒAdvisorContextå¯ä¼ é€’ä¿¡æ¯ï¼‰ï¼š</p>
<ol>
<li>Spring AI æ¡†æ¶ä»ç”¨æˆ·çš„ Prompt åˆ›å»ºä¸€ä¸ª AdvisedRequestï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªç©ºçš„ AdvisorContext å¯¹è±¡ï¼Œç”¨äºä¼ é€’ä¿¡æ¯ã€‚</li>
<li>é“¾ä¸­çš„æ¯ä¸ª advisor å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œå¯èƒ½ä¼šå¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚æˆ–è€…ï¼Œå®ƒä¹Ÿå¯ä»¥é€‰æ‹©ä¸è°ƒç”¨ä¸‹ä¸€ä¸ªå®ä½“æ¥é˜»æ­¢è¯·æ±‚ç»§ç»­ä¼ é€’ï¼Œè¿™æ—¶è¯¥ advisor è´Ÿè´£å¡«å……å“åº”å†…å®¹ã€‚</li>
<li>ç”±æ¡†æ¶æä¾›çš„æœ€ç»ˆ advisor å°†è¯·æ±‚å‘é€ç»™èŠå¤©æ¨¡å‹ ChatModelã€‚</li>
<li>èŠå¤©æ¨¡å‹çš„å“åº”éšåé€šè¿‡ advisor é“¾ä¼ å›ï¼Œå¹¶è¢«è½¬æ¢ä¸º AdvisedResponseã€‚åè€…åŒ…å«äº†å…±äº«çš„ AdvisorContext å®ä¾‹ã€‚</li>
<li>æ¯ä¸ª advisor éƒ½å¯ä»¥å¤„ç†æˆ–ä¿®æ”¹è¿™ä¸ªå“åº”ã€‚</li>
<li>æœ€ç»ˆçš„ AdvisedResponse é€šè¿‡æå– ChatCompletion è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li>
</ol>
<p>æ‹¦æˆªå™¨é“¾æ˜¯æœ‰é¡ºåºçš„ï¼ˆè´£ä»»é“¾è®¾è®¡æ¨¡å¼ï¼‰ï¼Œé€šè¿‡getOrderå¯å¾—åˆ°é¡ºåºï¼Œå€¼è¶Šä½è¶Šä¼˜å…ˆ</p>
<ul>
<li>å¦‚ä¸Šè¿°æ¡ˆä¾‹å…ˆMessageMemoryæ·»åŠ å†å²è®°å½•åˆ°æç¤ºè¯ä¸­ï¼Œå†å°†æ‰€æœ‰çš„å†…å®¹è¿›è¡ŒçŸ¥è¯†åº“æ£€ç´¢ã€‚</li>
</ul>
<p>æ‹¦æˆªå™¨æ”¯æŒæµå¼å’Œéæµå¼è¿”å›å€¼ï¼Œå¦‚æœè¦è‡ªä¸»å®ç°æ‹¦æˆªé€»è¾‘ï¼Œé€»è¾‘ä¸€æ ·ä½†è¿”å›å€¼ä¸åŒï¼Œæœ€å¥½éƒ½å®ç°ä¸€ä¸‹</p>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260126173601329.png" alt="image-20260126173601329" style="zoom:50%;" />	</blockquote>
<h5 id="ChatMemoryAdvisor"><a href="#ChatMemoryAdvisor" class="headerlink" title="ChatMemoryAdvisor"></a>ChatMemoryAdvisor</h5><p>ChatMemoryAdvisorï¼ˆä¸‰ç§å­˜å‚¨æ–¹å¼ï¼Œæç¤ºè¯&#x2F;ç³»ç»Ÿæç¤ºè¯&#x2F;å‘é‡æ•°æ®åº“ï¼‰</p>
<ul>
<li>MessageChatMemoryAdvisor: ä»è®°å¿†ä¸­æ£€ç´¢å†å²å¯¹è¯, å¹¶å°†å…¶ä½œä¸ºæ¶ˆæ¯é›†åˆæ·»åŠ åˆ°æç¤ºè¯ä¸­ï¼ˆå»ºè®®ä½¿ç”¨ï¼Œä¿è¯ä¸Šä¸‹æ–‡è¿è´¯æ€§ï¼‰</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span><span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä½ å¥½&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span><span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assistant&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä½ å¥½ï¼æœ‰ä»€ä¹ˆæˆ‘èƒ½å¸®åŠ©ä½ çš„å—ï¼Ÿ&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span><span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è®²ä¸ªç¬‘è¯&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<ul>
<li>PromptChatMemoryAdvisor: ä»è®°å¿†ä¸­æ£€ç´¢å†å²å¯¹è¯, å¹¶å°†å…¶æ·»åŠ åˆ°æç¤ºè¯çš„ç³»ç»Ÿæ–‡æœ¬ä¸­ï¼ˆæ²¡æœ‰è¾¹ç•Œä¿¡æ¯ï¼‰</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ä»¥ä¸‹æ˜¯ä¹‹å‰çš„å¯¹è¯å†å²ï¼š</span><br><span class="line">ç”¨æˆ·<span class="punctuation">:</span> ä½ å¥½</span><br><span class="line">åŠ©æ‰‹<span class="punctuation">:</span> ä½ å¥½ï¼æœ‰ä»€ä¹ˆæˆ‘èƒ½å¸®åŠ©ä½ çš„å—ï¼Ÿ</span><br><span class="line">ç”¨æˆ·<span class="punctuation">:</span> è®²ä¸ªç¬‘è¯</span><br><span class="line"></span><br><span class="line">ç°åœ¨è¯·ç»§ç»­å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚</span><br></pre></td></tr></table></figure>

<ul>
<li>VectorStoreChatMemoryAdvisor: å¯ä»¥ç”¨å‘é‡æ•°æ®åº“æ¥å­˜å‚¨æ£€ç´¢å†å²å¯¹è¯</li>
</ul>
<p>ChatMemoryAdvisorä¾èµ–äº<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/chatclient.html#_chat_memory">ChatMemory</a>æ„å»ºå†å²å¯¹è¯ï¼Œæä¾›å¢åˆ æŸ¥çš„æ–¹å¼ï¼Œå†…ç½®å­˜å‚¨æ–¹å¼ï¼š</p>
<p>â€¢ InMemoryChatMemoryï¼šå†…å­˜å­˜å‚¨<br>â€¢ CassandraChatMemoryï¼šåœ¨ Cassandra ä¸­å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„æŒä¹…åŒ–å­˜å‚¨<br>â€¢ Neo4jChatMemoryï¼šåœ¨ Neo4j ä¸­æ²¡æœ‰è¿‡æœŸæ—¶é—´é™åˆ¶çš„æŒä¹…åŒ–å­˜å‚¨<br>â€¢ JdbcChatMemoryï¼šåœ¨ JDBC ä¸­æ²¡æœ‰è¿‡æœŸæ—¶é—´é™åˆ¶çš„æŒä¹…åŒ–å­˜å‚¨</p>
<h2 id="åº”ç”¨å®ç°åŠå•å…ƒæµ‹è¯•"><a href="#åº”ç”¨å®ç°åŠå•å…ƒæµ‹è¯•" class="headerlink" title="åº”ç”¨å®ç°åŠå•å…ƒæµ‹è¯•"></a>åº”ç”¨å®ç°åŠå•å…ƒæµ‹è¯•</h2><p>åœ¨app&#x2F;LovaAppä¸‹åˆ›å»ºæ‹çˆ±å¤§å¸ˆçš„åº”ç”¨ï¼š</p>
<ul>
<li>ç³»ç»Ÿæç¤ºè¯é¢„è®¾</li>
<li>åˆå§‹åŒ–<ul>
<li>åˆ›å»ºåŸºäºå†…å­˜çš„ChatMemory</li>
<li>é€šè¿‡æ„é€ å™¨æ–¹å¼æ„å»ºchatClientå¯¹è±¡ä¾¿äºå¤ç”¨</li>
</ul>
</li>
<li>å¯¹è¯<ul>
<li>è°ƒç”¨chatClientï¼Œä¼ å…¥ç”¨æˆ·Promptï¼Œè®¾ç½®advisoræŒ‡å®šå¯¹è¯idå’Œå¯¹è¯è®°å¿†å¤§å°</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Component</span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoveApp</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SYSTEM_PROMPT</span> <span class="operator">=</span> <span class="string">&quot;æ‰®æ¼”æ·±è€•æ‹çˆ±å¿ƒç†é¢†åŸŸçš„ä¸“å®¶ã€‚å¼€åœºå‘ç”¨æˆ·è¡¨æ˜èº«ä»½ï¼Œå‘ŠçŸ¥ç”¨æˆ·å¯å€¾è¯‰æ‹çˆ±éš¾é¢˜ã€‚&quot;</span> +</span><br><span class="line">            <span class="string">&quot;å›´ç»•å•èº«ã€æ‹çˆ±ã€å·²å©šä¸‰ç§çŠ¶æ€æé—®ï¼šå•èº«çŠ¶æ€è¯¢é—®ç¤¾äº¤åœˆæ‹“å±•åŠè¿½æ±‚å¿ƒä»ªå¯¹è±¡çš„å›°æ‰°ï¼›&quot;</span> +</span><br><span class="line">            <span class="string">&quot;æ‹çˆ±çŠ¶æ€è¯¢é—®æ²Ÿé€šã€ä¹ æƒ¯å·®å¼‚å¼•å‘çš„çŸ›ç›¾ï¼›å·²å©šçŠ¶æ€è¯¢é—®å®¶åº­è´£ä»»ä¸äº²å±å…³ç³»å¤„ç†çš„é—®é¢˜ã€‚&quot;</span> +</span><br><span class="line">            <span class="string">&quot;å¼•å¯¼ç”¨æˆ·è¯¦è¿°äº‹æƒ…ç»è¿‡ã€å¯¹æ–¹ååº”åŠè‡ªèº«æƒ³æ³•ï¼Œä»¥ä¾¿ç»™å‡ºä¸“å±è§£å†³æ–¹æ¡ˆã€‚&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoveApp</span><span class="params">(ChatModel dashscopeChatModel)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–åŸºäºå†…å­˜çš„å¯¹è¯è®°å¿†</span></span><br><span class="line">        <span class="type">ChatMemory</span> <span class="variable">chatMemory</span> <span class="operator">=</span> MessageWindowChatMemory.builder()</span><br><span class="line">                .maxMessages(<span class="number">10</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        chatClient = ChatClient.builder(dashscopeChatModel)</span><br><span class="line">                .defaultSystem(SYSTEM_PROMPT)</span><br><span class="line">                .defaultAdvisors(</span><br><span class="line">                        MessageChatMemoryAdvisor.builder(chatMemory).build(),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">LogAdvisor</span>()</span><br><span class="line">                        <span class="comment">// new ReReadingAdvisor()</span></span><br><span class="line">                )</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doChat</span><span class="params">(String message, String chatId)</span> &#123;</span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">chatResponse</span> <span class="operator">=</span> chatClient</span><br><span class="line">                .prompt()</span><br><span class="line">                .user(message)</span><br><span class="line">                .advisors(spec -&gt; spec.param(ChatMemory.CONVERSATION_ID, chatId))</span><br><span class="line">                .call()</span><br><span class="line">                .chatResponse();</span><br><span class="line">        <span class="comment">// log.info(&quot;content: &#123;&#125;&quot;, content);</span></span><br><span class="line">        <span class="keyword">return</span> chatResponse.getResult().getOutput().getText();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å•å…ƒæµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoveAppTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> LoveApp loveApp;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testChat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">chatId</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€è½®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;ä½ å¥½ï¼Œæˆ‘æ˜¯ç¨‹åºå‘˜é±¼çš®&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> loveApp.doChat(message, chatId);</span><br><span class="line">        Assertions.assertNotNull(answer);</span><br><span class="line">        <span class="comment">// // ç¬¬äºŒè½®</span></span><br><span class="line">        message = <span class="string">&quot;æˆ‘æƒ³è®©å¦ä¸€åŠï¼ˆç¼–ç¨‹å¯¼èˆªï¼‰æ›´çˆ±æˆ‘&quot;</span>;</span><br><span class="line">        answer = loveApp.doChat(message, chatId);</span><br><span class="line">        Assertions.assertNotNull(answer);</span><br><span class="line">        <span class="comment">// // ç¬¬ä¸‰è½®</span></span><br><span class="line">        message = <span class="string">&quot;æˆ‘çš„å¦ä¸€åŠå«ä»€ä¹ˆæ¥ç€ï¼Ÿåˆšè·Ÿä½ è¯´è¿‡ï¼Œå¸®æˆ‘å›å¿†ä¸€ä¸‹&quot;</span>;</span><br><span class="line">        answer = loveApp.doChat(message, chatId);</span><br><span class="line">        Assertions.assertNotNull(answer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ¥ä¸‹æ¥æ˜¯ä¸€äº›æ‹“å±•çš„AIåº”ç”¨ï¼š</p>
<h2 id="SpringAIæ‹“å±•"><a href="#SpringAIæ‹“å±•" class="headerlink" title="SpringAIæ‹“å±•"></a>SpringAIæ‹“å±•</h2><h3 id="è‡ªå®šä¹‰Advisor"><a href="#è‡ªå®šä¹‰Advisor" class="headerlink" title="è‡ªå®šä¹‰Advisor"></a>è‡ªå®šä¹‰Advisor</h3><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/advisors.html#_implementing_an_advisor">è‡ªå®šä¹‰Advisoræ‹¦æˆªå™¨</a>ï¼ˆå»ºè®®åŒæ—¶å®ç°æµå¼CallAdvisoræ¥å£çš„adviseCallã€éæµå¼,treamAdvisoræ¥å£çš„adviseStreamç¯ç»•æ–¹æ³•ï¼‰ï¼š</p>
<blockquote>
<p>è®¾è®¡åŸåˆ™ï¼š</p>
<p>1ï¼‰ä¿æŒå•ä¸€èŒè´£ï¼šæ¯ä¸ª Advisor åº”ä¸“æ³¨äºä¸€é¡¹ç‰¹å®šä»»åŠ¡</p>
<p>2ï¼‰æ³¨æ„æ‰§è¡Œé¡ºåºï¼šåˆç†è®¾ç½® getOrder() å€¼ç¡®ä¿ Advisor æŒ‰æ­£ç¡®é¡ºåºæ‰§è¡Œ</p>
<p>3ï¼‰åŒæ—¶æ”¯æŒæµå¼å’Œéæµå¼ï¼šå°½å¯èƒ½åŒæ—¶å®ç°ä¸¤ç§æ¥å£ä»¥æé«˜çµæ´»æ€§</p>
<p>4ï¼‰é«˜æ•ˆå¤„ç†è¯·æ±‚ï¼šé¿å…åœ¨ Advisor ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ</p>
<p>5ï¼‰æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼šç¡®ä¿ Advisor èƒ½å¤Ÿä¼˜é›…å¤„ç†å¼‚å¸¸å’Œè¾¹ç•Œæƒ…å†µ</p>
<p>6ï¼‰å¯¹äºéœ€è¦æ›´å¤æ‚å¤„ç†çš„æµå¼åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨ Reactor çš„æ“ä½œç¬¦ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;AdvisedResponse&gt; <span class="title function_">aroundStream</span><span class="params">(AdvisedRequest advisedRequest, StreamAroundAdvisorChain chain)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Mono.just(advisedRequest)</span><br><span class="line">           .publishOn(Schedulers.boundedElastic())</span><br><span class="line">           .map(request -&gt; &#123;</span><br><span class="line">               <span class="comment">// è¯·æ±‚å‰å¤„ç†é€»è¾‘</span></span><br><span class="line">               <span class="keyword">return</span> modifyRequest(request);</span><br><span class="line">           &#125;)</span><br><span class="line">           .flatMapMany(request -&gt; chain.nextAroundStream(request))</span><br><span class="line">           .map(response -&gt; &#123;</span><br><span class="line">               <span class="comment">// å“åº”å¤„ç†é€»è¾‘</span></span><br><span class="line">               <span class="keyword">return</span> modifyResponse(response);</span><br><span class="line">           &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>7ï¼‰å¯é€šè¿‡adviceContextåœ¨Advisorä¸­å…±äº«çŠ¶æ€</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ›´æ–°ä¸Šä¸‹æ–‡</span></span><br><span class="line">advisedRequest = advisedRequest.updateContext(context -&gt; &#123;</span><br><span class="line">    context.put(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> context;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> advisedResponse.adviseContext().get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote>
<p>è‡ªå®šä¹‰æ—¥å¿—æ‹¦æˆªå™¨</p>
<blockquote>
<p>æ³¨ï¼šSpringAIé»˜è®¤æ˜¯Debugçº§åˆ«ï¼Œè¦çœ‹åˆ°æ—¥å¿—ä¿¡æ¯çš„è¯ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šæ—¥å¿—è¾“å‡ºçº§åˆ«å³å¯ï¼Œä½†å¦‚æœéœ€è¦æ›´çµæ´»çš„æ§åˆ¶ï¼Œå¯ä»¥é€šè¿‡æ‹¦æˆªå™¨æ¥å®Œæˆ</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure></blockquote>
<ul>
<li>æµå¼å¤„ç†é€šè¿‡ChatClientMessageAggregatorå·¥å…·ç±»å°†Fluxå“åº”èšåˆä¸ºå•ä¸ªAdviseResponseï¼Œè¿™æ ·å¯ä»¥è§‚å¯Ÿåˆ°æ•´ä¸ªæµè€Œä¸æ˜¯æ¯ä¸ªç‹¬ç«‹é¡¹ï¼ˆæ³¨ï¼šè¯¥æ“ä½œæ˜¯åªè¯»æ“ä½œï¼‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰æ—¥å¿— Advisor</span></span><br><span class="line"><span class="comment"> * æ‰“å° info çº§åˆ«æ—¥å¿—ã€åªè¾“å‡ºå•æ¬¡ç”¨æˆ·æç¤ºè¯å’Œ AI å›å¤çš„æ–‡æœ¬</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAdvisor</span> <span class="keyword">implements</span> <span class="title class_">CallAdvisor</span>, StreamAdvisor &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ChatClientResponse <span class="title function_">adviseCall</span><span class="params">(ChatClientRequest chatClientRequest, CallAdvisorChain callAdvisorChain)</span> &#123;</span><br><span class="line">        logRequest(chatClientRequest);</span><br><span class="line"></span><br><span class="line">        <span class="type">ChatClientResponse</span> <span class="variable">chatClientResponse</span> <span class="operator">=</span> callAdvisorChain.nextCall(chatClientRequest);</span><br><span class="line"></span><br><span class="line">        logResponse(chatClientResponse);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> chatClientResponse;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;ChatClientResponse&gt; <span class="title function_">adviseStream</span><span class="params">(ChatClientRequest chatClientRequest,</span></span><br><span class="line"><span class="params">                                                 StreamAdvisorChain streamAdvisorChain)</span> &#123;</span><br><span class="line">        logRequest(chatClientRequest);</span><br><span class="line"></span><br><span class="line">        Flux&lt;ChatClientResponse&gt; chatClientResponses = streamAdvisorChain.nextStream(chatClientRequest);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ChatClientMessageAggregator</span>().aggregateChatClientResponse(chatClientResponses, <span class="built_in">this</span>::logResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">logRequest</span><span class="params">(ChatClientRequest request)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;request: &#123;&#125;&quot;</span>, request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">logResponse</span><span class="params">(ChatClientResponse chatClientResponse)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;response: &#123;&#125;&quot;</span>, chatClientResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Re2æ‹¦æˆªå™¨å¢å¼ºæç¤ºè¯ï¼Œä½†æ˜¯æœ‰é¢å¤–tokenæˆæœ¬ï¼Œé¢å‘Cç«¯éœ€è¦è°¨æ…ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReReadingAdvisor</span> <span class="keyword">implements</span> <span class="title class_">BaseAdvisor</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_RE2_ADVISE_TEMPLATE</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">			&#123;re2_input_query&#125;</span></span><br><span class="line"><span class="string">			Read the question again: &#123;re2_input_query&#125;</span></span><br><span class="line"><span class="string">			&quot;&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String re2AdviseTemplate;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> <span class="variable">order</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">ReReadingAdvisor</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>(DEFAULT_RE2_ADVISE_TEMPLATE);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">ReReadingAdvisor</span><span class="params">(String re2AdviseTemplate)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.re2AdviseTemplate = re2AdviseTemplate;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> ChatClientRequest <span class="title function_">before</span><span class="params">(ChatClientRequest chatClientRequest, AdvisorChain advisorChain)</span> &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">augmentedUserText</span> <span class="operator">=</span> PromptTemplate.builder()</span><br><span class="line">			.template(<span class="built_in">this</span>.re2AdviseTemplate)</span><br><span class="line">			.variables(Map.of(<span class="string">&quot;re2_input_query&quot;</span>, chatClientRequest.prompt().getUserMessage().getText()))</span><br><span class="line">			.build()</span><br><span class="line">			.render();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> chatClientRequest.mutate()</span><br><span class="line">			.prompt(chatClientRequest.prompt().augmentUserMessage(augmentedUserText))</span><br><span class="line">			.build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> ChatClientResponse <span class="title function_">after</span><span class="params">(ChatClientResponse chatClientResponse, AdvisorChain advisorChain)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> chatClientResponse;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.order;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> ReReadingAdvisor <span class="title function_">withOrder</span><span class="params">(<span class="type">int</span> order)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.order = order;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç»“æ„åŒ–è¾“å‡º"><a href="#ç»“æ„åŒ–è¾“å‡º" class="headerlink" title="ç»“æ„åŒ–è¾“å‡º"></a>ç»“æ„åŒ–è¾“å‡º</h3><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/structured-output-converter.html">Structured Output Converter</a>å¯ä»¥å°†å¤§æ¨¡å‹è¾“å‡ºå†…å®¹è½¬æ¢æˆJSONç­‰ç»“æ„åŒ–æ ¼å¼</p>
<ul>
<li>è°ƒç”¨å‰ï¼šè½¬æ¢å™¨åœ¨æç¤ºè¯åé¢æ·»åŠ æ ¼å¼æŒ‡ä»¤ï¼Œå¼•å¯¼æ¨¡å‹ç”Ÿæˆç‰¹å®šæ ¼å¼å“åº”</li>
<li>è°ƒç”¨åï¼šè½¬æ¢å™¨å°†æ¨¡å‹è¾“å‡ºè½¬æ¢æˆç»“æ„åŒ–ç±»å‹å®ä¾‹ï¼ˆJSON XMLç­‰æ•°æ®ç»“æ„ï¼‰</li>
</ul>
<blockquote>
<p>æ³¨ï¼šç»“æ„åŒ–è¾“å‡ºè½¬æ¢å™¨ä»…èƒ½å°½æœ€å¤§åŠªåŠ›è¾“å‡ºï¼ŒAIä¸ä¸€å®šä¿è¯å¯ä»¥æŒ‰è¦æ±‚è¾“å‡ºï¼Œå»ºè®®éœ€è¦æœ‰éªŒè¯æœºåˆ¶æˆ–å¼‚å¸¸å¤„ç†ä¿è¯æ¨¡å‹è¾“å‡ºç¬¦åˆé¢„æœŸ</p>
</blockquote>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/structured-output-architecture.jpg" alt="Structured Output Converter Architecture" style="zoom: 33%;" />	

<blockquote>
<p>æœ€ä½³å®è·µ</p>
<ol>
<li><p>å°½é‡ä¸ºæ¨¡å‹æä¾›æ¸…æ™°çš„æ ¼å¼æŒ‡å¯¼</p>
</li>
<li><p>å®ç°è¾“å‡ºéªŒè¯æœºåˆ¶å’Œå¼‚å¸¸å¤„ç†é€»è¾‘ï¼Œç¡®ä¿ç»“æ„åŒ–æ•°æ®ç¬¦åˆé¢„æœŸ</p>
</li>
<li><p>é€‰æ‹©æ”¯æŒç»“æ„åŒ–è¾“å‡ºçš„åˆé€‚æ¨¡å‹</p>
</li>
<li><p>å¯¹äºå¤æ‚æ•°æ®ç»“æ„ï¼Œè€ƒè™‘ä½¿ç”¨ ParameterizedTypeReference</p>
</li>
</ol>
</blockquote>
<p>ç›¸å…³API</p>
<p>ç»“æ„åŒ–è¾“å‡ºæ¥å£<code>StructuredOutputConverter</code>å®ç°ç»“æ„åŒ–è¾“å‡ºï¼Œç»§æ‰¿äº†ä¸¤ä¸ªæ¥å£</p>
<ul>
<li>Converteræ¥å£ï¼ˆSpringè‡ªå¸¦ï¼‰ï¼šå°†æ¨¡å‹æ–‡æœ¬è½¬æ¢æˆæŒ‡å®šç›®æ ‡ç±»å‹T</li>
<li>FormatProvideræ¥å£ï¼šç‰¹å®šçš„æŒ‡ä»¤æ ¼å¼</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StructuredOutputConverter</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Converter</span>&lt;String, T&gt;, FormatProvider &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…·ä½“å†…ç½®å®ç°ï¼š</p>
<ul>
<li>AbstractConversionServiceOutputConverter: æä¾›é¢„é…ç½®çš„ GenericConversionService, ç”¨äºå°† LLM è¾“å‡ºè½¬æ¢ä¸ºæ‰€éœ€æ ¼å¼<ul>
<li>ListOutputConverter: ç”¨äºå°†è¾“å‡ºè½¬æ¢ä¸º List ç»“æ„</li>
</ul>
</li>
<li>AbstractMessageOutputConverter: æ”¯æŒ Spring AI Message çš„è½¬æ¢<ul>
<li>MapOutputConverter: ç”¨äºå°†è¾“å‡ºè½¬æ¢ä¸º Map ç»“æ„</li>
</ul>
</li>
<li>BeanOutputConverter: ç”¨äºå°†è¾“å‡ºè½¬æ¢ä¸º Java Bean å¯¹è±¡ (åŸºäº ObjectMapper å®ç°)</li>
</ul>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/structured-output-hierarchy4.jpg" alt="Structured Output Class Hierarchy" style="zoom: 33%;" />	



<p>å…·ä½“å·¥ä½œæµç¨‹ï¼š</p>
<p>ï¼ˆ1ï¼‰FormatProviderç»™AIæä¾›ç±»å‹æŒ‡ä»¤</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Your response should be in JSON format.</span><br><span class="line">The data structure <span class="keyword">for</span> the JSON should match <span class="built_in">this</span> Java class: java.util.HashMap</span><br><span class="line">Do not include any explanations, only provide a RFC8259 compliant JSON response following <span class="built_in">this</span> format without deviation.</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬é€šè¿‡PromptTemplateå°†æ ¼å¼æ”¾åˆ°ç”¨æˆ·è¾“å…¥æç¤ºè¯æœ«å°¾ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">StructuredOutputConverter</span> <span class="variable">outputConverter</span> <span class="operator">=</span> ...</span><br><span class="line"><span class="type">String</span> <span class="variable">userInputTemplate</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ... ç”¨æˆ·æ–‡æœ¬è¾“å…¥ ....</span></span><br><span class="line"><span class="string">        &#123;format&#125;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>; <span class="comment">// ç”¨æˆ·è¾“å…¥ï¼ŒåŒ…å«ä¸€ä¸ªâ€œformatâ€å ä½ç¬¦ã€‚</span></span><br><span class="line"><span class="type">Prompt</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Prompt</span>(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">PromptTemplate</span>(</span><br><span class="line">                <span class="built_in">this</span>.userInputTemplate,</span><br><span class="line">                Map.of(..., <span class="string">&quot;format&quot;</span>, outputConverter.getFormat()) <span class="comment">// ç”¨è½¬æ¢å™¨çš„æ ¼å¼æ›¿æ¢â€œformatâ€å ä½ç¬¦</span></span><br><span class="line">        ).createMessage());</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰ç”Ÿæˆçš„æ–‡æœ¬å­—ç¬¦è¢«Converterè½¬æ¢æˆæŒ‡å®šçš„æ ¼å¼è¾“å‡º</p>
<p><img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/structured-output-api.jpg" alt="Structured Output API"></p>
<blockquote>
<p>å®˜æ–¹æä¾›çš„ç¤ºä¾‹</p>
<p>BeanOutputConverterè¾“å‡ºæŒ‡å®šJavaç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªè®°å½•ç±»</span></span><br><span class="line"><span class="keyword">record</span> <span class="title class_">ActorsFilms</span><span class="params">(String actor, List&lt;String&gt; movies)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨é«˜çº§ ChatClient API</span></span><br><span class="line"><span class="type">ActorsFilms</span> <span class="variable">actorsFilms</span> <span class="operator">=</span> ChatClient.create(chatModel).prompt()</span><br><span class="line">        .user(<span class="string">&quot;Generate 5 movies for Tom Hanks.&quot;</span>)</span><br><span class="line">        .call()</span><br><span class="line">        .entity(ActorsFilms.class);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ”¯æŒParameterizedTypeReferenceçš„æ„é€ å‡½æ•°æŒ‡å®šæ›´å¤æ‚çš„ç±»ç»“æ„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯ä»¥è½¬æ¢ä¸ºå¯¹è±¡åˆ—è¡¨</span></span><br><span class="line">List&lt;ActorsFilms&gt; actorsFilms = ChatClient.create(chatModel).prompt()</span><br><span class="line">        .user(<span class="string">&quot;Generate the filmography of 5 movies for Tom Hanks and Bill Murray.&quot;</span>)</span><br><span class="line">        .call()</span><br><span class="line">        .entity(<span class="keyword">new</span> <span class="title class_">ParameterizedTypeReference</span>&lt;List&lt;ActorsFilms&gt;&gt;() &#123;&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>MapOutputConverterè¾“å‡ºæ•°å­—åˆ—è¡¨çš„Map</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, Object&gt; result = ChatClient.create(chatModel).prompt()</span><br><span class="line">        .user(u -&gt; u.text(<span class="string">&quot;Provide me a List of &#123;subject&#125;&quot;</span>)</span><br><span class="line">                    .param(<span class="string">&quot;subject&quot;</span>, <span class="string">&quot;an array of numbers from 1 to 9 under they key name &#x27;numbers&#x27;&quot;</span>))</span><br><span class="line">        .call()</span><br><span class="line">        .entity(<span class="keyword">new</span> <span class="title class_">ParameterizedTypeReference</span>&lt;Map&lt;String, Object&gt;&gt;() &#123;&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>ListOutputConverterè¾“å‡ºå­—ç¬¦ä¸² List</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; flavors = ChatClient.create(chatModel).prompt()</span><br><span class="line">                .user(u -&gt; u.text(<span class="string">&quot;List five &#123;subject&#125;&quot;</span>)</span><br><span class="line">                            .param(<span class="string">&quot;subject&quot;</span>, <span class="string">&quot;ice cream flavors&quot;</span>))</span><br><span class="line">                .call()</span><br><span class="line">                .entity(<span class="keyword">new</span> <span class="title class_">ListOutputConverter</span>(<span class="keyword">new</span> <span class="title class_">DefaultConversionService</span>()));</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>æ³¨ï¼šä¸€äº›AIæ¨¡å‹å…·å¤‡åŸç”Ÿå†…ç½®JSONï¼Œæé«˜è¾“å‡ºå¯é æ€§ï¼ˆè§å®˜æ–¹æ–‡æ¡£<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/structured-output-converter.html#_supported_ai_models">Supported Models for Native Structured Output</a>ï¼‰</p>
</blockquote>
<p>é¡¹ç›®ä¸­ä½¿ç”¨</p>
<p>å¼•å…¥JSON Schemaç”Ÿæˆä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.victools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsonschema-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.38.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨appä¸­é€šè¿‡JDK14å¿«é€Ÿå®šä¹‰ç±»å‹ï¼Œé€šè¿‡chatClientè¡¥å……æç¤ºè¯ï¼Œå¹¶æ·»åŠ ç»“æ„åŒ–è¾“å‡ºçš„ç»“æ„ï¼ˆBeanOutputConverterï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">record</span> <span class="title class_">LoveReport</span><span class="params">(String title, List&lt;String&gt; suggestions)</span> &#123;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> LoveReport <span class="title function_">doChatWithReport</span><span class="params">(String message, String chatId)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> chatClient</span><br><span class="line">               .prompt()</span><br><span class="line">               .system(SYSTEM_PROMPT + <span class="string">&quot;æ¯æ¬¡å¯¹è¯åéƒ½è¦ç”Ÿæˆæ‹çˆ±ç»“æœï¼Œæ ‡é¢˜ä¸º&#123;ç”¨æˆ·å&#125;çš„æ‹çˆ±æŠ¥å‘Šï¼Œå†…å®¹ä¸ºå»ºè®®åˆ—è¡¨&quot;</span>)</span><br><span class="line">               .user(message)</span><br><span class="line">               .advisors(spec -&gt; spec.param(ChatMemory.CONVERSATION_ID, chatId))</span><br><span class="line">               .call()</span><br><span class="line">               .entity(LoveReport.class);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">doChatWithReport</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">chatId</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€è½®</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;ä½ å¥½ï¼Œæˆ‘æ˜¯ç¨‹åºå‘˜é±¼çš®ï¼Œæˆ‘æƒ³è®©å¦ä¸€åŠï¼ˆç¼–ç¨‹å¯¼èˆªï¼‰æ›´çˆ±æˆ‘ï¼Œä½†æˆ‘ä¸çŸ¥é“è¯¥æ€ä¹ˆåš&quot;</span>;</span><br><span class="line">    LoveApp.<span class="type">LoveReport</span> <span class="variable">loveReport</span> <span class="operator">=</span> loveApp.doChatWithReport(message, chatId);</span><br><span class="line">    Assertions.assertNotNull(loveReport);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘ä»¬ä¹‹å‰å†™çš„logæ–­ç‚¹è°ƒè¯•ï¼Œç¡®å®çœ‹åˆ°äº†æœ‰æ ¼å¼è½¬æ¢çš„ä¸Šä¸‹æ–‡</p>
<p><img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260126213937975.png" alt="image-20260126213937975"></p>
<p>ç»“æœè°ƒè¯•</p>
<p><img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260126214142963.png" alt="image-20260126214142963"></p>
<p><img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260126214243342.png" alt="image-20260126214243342"></p>
<h3 id="å¯¹è¯è®°å¿†æŒä¹…åŒ–"><a href="#å¯¹è¯è®°å¿†æŒä¹…åŒ–" class="headerlink" title="å¯¹è¯è®°å¿†æŒä¹…åŒ–"></a>å¯¹è¯è®°å¿†æŒä¹…åŒ–</h3><p>æˆ‘ä»¬æœ‰æ—¶éœ€è¦å°†å¯¹è¯ä¿å­˜åˆ°æ–‡ä»¶ã€æ•°æ®åº“ã€redisä¸­</p>
<p>åœ¨<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/chatclient.html#_chat_memory">å¯¹è¯è®°å¿†çš„å®˜æ–¹æ–‡æ¡£</a>ä¸­ï¼Œå¯ä»¥å‘ç°æœ‰JdbcChatMemoryRepositoryå¯ä»¥æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼Œä½†<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/chat-memory.html#_jdbcchatmemoryrepository">å®˜æ–¹</a>å¯¹è¿™ä¸ªä»‹ç»æ¯”è¾ƒå°‘</p>
<p>æˆ‘ä»¬è¿˜æ˜¯å»ºè®®é€šè¿‡è‡ªå®šä¹‰ChatMemoryå®ç°ï¼ˆå‚è€ƒå·²å®ç°çš„InMemoryChatMemoryè®¾è®¡ï¼‰ï¼Œä¹Ÿå¯ä»¥æ›´çµæ´»åœ°è®¾è®¡</p>
<p>ChatMemoryä¸­åªæœ‰å¢åˆ æŸ¥çš„æ–¹æ³•ï¼Œè€Œåœ¨InMemoryChatMemoryä¸­ï¼Œé€šè¿‡ConcurrentHashMapï¼ˆkeyæ˜¯ä¼šè¯idï¼Œvalueæ˜¯idçš„æ¶ˆæ¯åˆ—è¡¨ï¼‰ç»´æŠ¤å¯¹è¯ä¿¡æ¯ï¼Œæˆ‘ä»¬å‚è€ƒè¯¥æ€è·¯å®ç°ã€‚</p>
<p>éš¾ç‚¹ï¼šæ¶ˆæ¯å’Œæ–‡æœ¬ä¹‹é—´å¦‚ä½•è½¬æ¢ã€‚æ¶ˆæ¯æŒä¹…åŒ–æ—¶ï¼Œè¦å°†æ¶ˆæ¯ä»Messageå¯¹è±¡è½¬æ¢æˆæ–‡æœ¬ï¼Œè€Œä»æŒä¹…åŒ–å±‚è¯»å–æ¶ˆæ¯æ—¶ï¼Œéœ€è¦å°†æ–‡æœ¬è½¬æ¢æˆMessageå¯¹è±¡ã€‚</p>
<p>æ€è·¯æ˜¯é€šè¿‡JSONååºåˆ—åŒ–ï¼Œä½†é—®é¢˜æ˜¯ï¼š</p>
<ul>
<li>æŒä¹…åŒ–çš„Messageæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¯¹åº”å¤šä¸ªä¸åŒçš„å­ç±»å®ç°ï¼ˆUserMessage SystemMessageç­‰ï¼‰<ul>
<li>è€Œæ¯ä¸ªå­ç±»çš„ç»“æ„ä¸ç»Ÿä¸€ï¼Œå¹¶ä¸”å­ç±»æ— æ³•ä¿è¯åºåˆ—åŒ–ï¼Œæ— å‚æ„é€ å‡½æ•°ç­‰</li>
</ul>
</li>
</ul>
<p>Messageç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260126220406676.png" alt="image-20260126220406676" style="zoom: 50%;" />	

<p>ä¸€ç§è§£å†³æ€è·¯æ˜¯é€šè¿‡<a target="_blank" rel="noopener" href="https://github.com/EsotericSoftware/kryo">Kyroåºåˆ—åŒ–åº“</a>æ¥å®ç°è½¬æ¢ï¼Œé€šè¿‡æˆ‘ä»¬å†™å¥½çš„è½¬æ¢åçš„FileBasedChatMemoryå¯¹å¢åˆ ç›¸åº”çš„æ–¹æ³•å¢å¼ºåå°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">LoveApp</span><span class="params">(ChatModel dashscopeChatModel)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–åŸºäºæ–‡ä»¶çš„å¯¹è¯è®°å¿†</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileDir</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>) + <span class="string">&quot;/chat-memory&quot;</span>;</span><br><span class="line">    <span class="type">ChatMemory</span> <span class="variable">chatMemory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileBasedChatMemory</span>(fileDir);</span><br><span class="line">    chatClient = ChatClient.builder(dashscopeChatModel)</span><br><span class="line">            .defaultSystem(SYSTEM_PROMPT)</span><br><span class="line">            .defaultAdvisors(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">MessageChatMemoryAdvisor</span>(chatMemory)</span><br><span class="line">            )</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="PromptTemplateæ¨¡æ¿"><a href="#PromptTemplateæ¨¡æ¿" class="headerlink" title="PromptTemplateæ¨¡æ¿"></a>PromptTemplateæ¨¡æ¿</h3><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/prompt.html#_prompttemplate">å®˜æ–¹æ–‡æ¡£</a></p>
<p>è¿™æ˜¯æ„å»ºæç¤ºè¯çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œé€šè¿‡åŠ¨æ€æ›¿æ¢å ä½ç¬¦æ¥ç”Ÿæˆä¸€äº›å›ºå®šä½†å±€éƒ¨æœ‰å˜åŠ¨çš„æç¤ºè¯ï¼ˆæ•°æ®åº“é¢„ç¼–è¯‘ã€è®°å½•æ—¥å¿—çš„å˜é‡å ä½ç¬¦ã€æ¨¡æ¿å¼•æ“ç­‰åœºæ™¯ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å¸¦æœ‰å˜é‡çš„æ¨¡æ¿</span></span><br><span class="line"><span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> <span class="string">&quot;ä½ å¥½ï¼Œ&#123;name&#125;ã€‚ä»Šå¤©æ˜¯&#123;day&#125;ï¼Œå¤©æ°”&#123;weather&#125;ã€‚&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºæ¨¡æ¿å¯¹è±¡</span></span><br><span class="line"><span class="type">PromptTemplate</span> <span class="variable">promptTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromptTemplate</span>(template);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡†å¤‡å˜é‡æ˜ å°„</span></span><br><span class="line">Map&lt;String, Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">variables.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;é±¼çš®&quot;</span>);</span><br><span class="line">variables.put(<span class="string">&quot;day&quot;</span>, <span class="string">&quot;æ˜ŸæœŸä¸€&quot;</span>);</span><br><span class="line">variables.put(<span class="string">&quot;weather&quot;</span>, <span class="string">&quot;æ™´æœ—&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆæœ€ç»ˆæç¤ºæ–‡æœ¬</span></span><br><span class="line"><span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> promptTemplate.render(variables);</span><br><span class="line"><span class="comment">// ç»“æœ: &quot;ä½ å¥½ï¼Œé±¼çš®ã€‚ä»Šå¤©æ˜¯æ˜ŸæœŸä¸€ï¼Œå¤©æ°”æ™´æœ—ã€‚&quot;</span></span><br></pre></td></tr></table></figure>

<p>PromptTemplate åœ¨ä»¥ä¸‹åœºæ™¯ç‰¹åˆ«æœ‰ç”¨:</p>
<ol>
<li>åŠ¨æ€ä¸ªæ€§åŒ–äº¤äº’: æ ¹æ®ç”¨æˆ·ä¿¡æ¯ã€ä¸Šä¸‹æ–‡æˆ–ä¸šåŠ¡è§„åˆ™å®šåˆ¶æç¤ºè¯</li>
<li>å¤šè¯­è¨€æ”¯æŒ: ä½¿ç”¨ç›¸åŒçš„å˜é‡ä½†ä¸åŒçš„æ¨¡æ¿æ–‡ä»¶æ”¯æŒå¤šç§è¯­è¨€</li>
<li>A&#x2F;Bæµ‹è¯•: è½»æ¾åˆ‡æ¢ä¸åŒç‰ˆæœ¬çš„æç¤ºè¯è¿›è¡Œæ•ˆæœå¯¹æ¯”</li>
<li>æç¤ºè¯ç‰ˆæœ¬ç®¡ç†: å°†æç¤ºè¯å¤–éƒ¨åŒ–, ä¾¿äºç‰ˆæœ¬æ§åˆ¶å’Œè¿­ä»£ä¼˜åŒ–</li>
</ol>
<p>å†…éƒ¨åŸç†è¯´æ˜ï¼š</p>
<p>SpringAIä¸­ï¼Œå®ç°äº†PromptTemplateActionsã€PromptTemplateMessageActionsæ¥å£ï¼Œè¿™äº›æ¥å£æä¾›äº†ä¸€äº›æ–‡æœ¬ç”Ÿæˆçš„æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromptTemplate</span> <span class="keyword">implements</span> <span class="title class_">PromptTemplateActions</span>, PromptTemplateMessageActions &#123;</span><br><span class="line">    <span class="comment">// å®ç°ç»†èŠ‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" data-original="https://yuezi-1308313119.cos.ap-guangzhou.myqcloud.com/typora-user-images-ubuntu/image-20260126221344483.png" alt="image-20260126221344483" style="zoom:50%;" />	

<p>SpringAIæä¾›äº†å‡ ç§ä¸“ç”¨çš„æ¨¡æ¿ç±»ï¼Œå¯¹åº”ä¸åŒè§’è‰²çš„æ¶ˆæ¯:</p>
<ol>
<li>SystemPromptTemplate: ç”¨äºç³»ç»Ÿæ¶ˆæ¯, è®¾ç½® AI çš„è¡Œä¸ºå’ŒèƒŒæ™¯</li>
<li>AssistantPromptTemplate: ç”¨äºåŠ©æ‰‹æ¶ˆæ¯, ç”¨äºè®¾ç½® AI å›å¤çš„ç»“æ„</li>
<li>FunctionPromptTemplate: ç›®å‰æ²¡ç”¨</li>
</ol>
<p>æ¯”å¦‚ç³»ç»Ÿæ¶ˆæ¯æ¨¡æ¿å¯ä»¥å¿«é€Ÿæ„é€ ä¸€ä¸ªPromptï¼Œæˆ–è€…è®¾ç½®å›å¤ç»“æ„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String userTextØœ = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Tell me about threeï»¿ famous pirates from the GoldeØœn Age of Piracy and why they dâ€id.</span></span><br><span class="line"><span class="string">    Write at least a senteâ¡nce for each pirate.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">Message</span> <span class="variable">userMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMessage</span>(userText);</span><br><span class="line"></span><br><span class="line">String syØœstemText = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  ï»¿You are a helpfulØœ AI assistant thaâ€t helps people fiâ¡nd information.</span></span><br><span class="line"><span class="string">  Your name is &#123;name&#125;</span></span><br><span class="line"><span class="string">  You should reply to the user&#x27;s request with your name and also in the style of a &#123;voice&#125;.</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">SystemPromptTemplate</span> <span class="variable">systemPromptTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SystemPromptTemplate</span>(systemText);</span><br><span class="line"><span class="type">Message</span> <span class="variable">systemMessage</span> <span class="operator">=</span> systemPromptTemplate.createMessage(Map.of(<span class="string">&quot;name&quot;</span>, name, <span class="string">&quot;voice&quot;</span>, voice));</span><br><span class="line"></span><br><span class="line"><span class="type">Prompt</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Prompt</span>(List.of(userMessage, systemMessage));</span><br><span class="line"></span><br><span class="line">List&lt;Generation&gt; response = chatModel.call(prompt).getResults();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼Œå¯ä»¥ä»æ–‡ä»¶ä¸­åŠ è½½æ¨¡æ¿ä¾¿äºç®¡ç†ï¼ˆå¤šåœºæ™¯æ”¯æŒï¼Œåœ¨ä¿®æ”¹æç¤ºè¯æ¨¡æ¿æ—¶å¯ä»¥ä¸ä¿®æ”¹ä»£ç ï¼Œå¼€é—­åŸåˆ™ï¼Œæ¨èï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»ç±»è·¯å¾„èµ„æºåŠ è½½ç³»ç»Ÿæç¤ºæ¨¡æ¿</span></span><br><span class="line"><span class="meta">@Value(&quot;classpath:/prompts/system-message.st&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Resource systemResource;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥ä½¿ç”¨èµ„æºåˆ›å»ºæ¨¡æ¿</span></span><br><span class="line"><span class="type">SystemPromptTemplate</span> <span class="variable">systemPromptTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SystemPromptTemplate</span>(systemResource);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="å¤šæ¨¡æ€"><a href="#å¤šæ¨¡æ€" class="headerlink" title="å¤šæ¨¡æ€"></a>å¤šæ¨¡æ€</h3><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/multimodality.html">SpringAIå®˜æ–¹æ–‡æ¡£</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/chat/comparison.html">å¤šæ¨¡æ€(Multimodality)æ”¯æŒçš„æ¨¡å‹</a>ï¼šä¸»æµçš„Google VertexAI Geminiã€ OpenAIéƒ½æ”¯æŒçš„</p>
<p>é€‰æ‹©å¥½æ¨¡å‹åï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”æ¨¡å‹çš„APIè¿›è¡Œä½¿ç”¨ï¼šå¦‚<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/chat/vertexai-gemini-chat.html">VertexAI Gemini Chat</a></p>
<p>å…è®¸å‘é€å›¾ç‰‡ç­‰èµ„æºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;/vertex-test.png&quot;</span>).getContentAsByteArray();</span><br><span class="line"></span><br><span class="line"><span class="type">var</span> <span class="variable">userMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMessage</span>(<span class="string">&quot;Explain what do you see on this picture?&quot;</span>,</span><br><span class="line">        List.of(<span class="keyword">new</span> <span class="title class_">Media</span>(MimeTypeUtils.IMAGE_PNG, <span class="built_in">this</span>.data)));</span><br><span class="line"></span><br><span class="line"><span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatModel.call(<span class="keyword">new</span> <span class="title class_">Prompt</span>(List.of(<span class="built_in">this</span>.userMessage)));</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥é€šè¿‡ChatClient</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> ChatClient.create(chatModel).prompt()</span><br><span class="line">		.user(u -&gt; u.text(<span class="string">&quot;Explain what do you see on this picture?&quot;</span>)</span><br><span class="line">				    .media(MimeTypeUtils.IMAGE_PNG, <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;/multimodal.test.png&quot;</span>)))</span><br><span class="line">		.call()</span><br><span class="line">		.content();</span><br></pre></td></tr></table></figure>



<p>æ–¹å¼2ï¼Œå¯ä»¥è°ƒç”¨å›½äº§å¤§æ¨¡å‹çš„SDKï¼Œå¦‚<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/model-studio/qwen-api-reference/#d0e30636ad3s3">é€šä¹‰åƒé—®API</a>æ¥å…¥å¤šæ¨¡æ€</p>
<p>åç»­å·¥ä½œï¼š</p>
<ol>
<li>è‡ªå®šä¹‰ Advisor, æ¯”å¦‚æƒé™æ ¡éªŒã€è¿ç¦è¯æ ¡éªŒ Advisor</li>
<li>è‡ªå®šä¹‰å¯¹è¯è®°å¿†, æ¯”å¦‚æŒä¹…åŒ–å¯¹è¯åˆ° MySQL æˆ– Redis å­˜å‚¨ä¸­</li>
<li>ç¼–å†™ä¸€å¥—åŒ…å«å˜é‡çš„ Prompt æ¨¡æ¿, å¹¶ä¿å­˜ä¸ºèµ„æºæ–‡ä»¶, ä»æ–‡ä»¶åŠ è½½æ¨¡æ¿</li>
<li>å¼€å‘ä¸€ä¸ªå¤šæ¨¡æ€å¯¹è¯åŠ©æ‰‹, èƒ½å¤Ÿè®© AI è§£é‡Šå›¾ç‰‡ (å»ºè®®ä½¿ç”¨å›½å†…çš„ AI å¤§æ¨¡å‹)</li>
<li>é˜…è¯» Spring AI å®˜æ–¹çš„ ChatMemory æ–‡æ¡£, äº†è§£å¦‚ä½•è‡ªä¸»æ„å»º ChatMemory</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://yuezi2048.github.io">yuezi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://yuezi2048.github.io/2026/01/26/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/2.%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">https://yuezi2048.github.io/2026/01/26/2.AreasğŸŒ/ä¸´æ—¶è®°å½•/2.å¤§æ¨¡å‹åº”ç”¨å¼€å‘/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://yuezi2048.github.io" target="_blank">yuezi</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/">ä¸´æ—¶è®°å½•</a></div><div class="post-share"><div class="social-share" data-image="/img/touxiang.jpg" data-sites="qq,wechat"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/11/27/2.Areas%F0%9F%8C%90/02.%E9%9D%A2%E7%BB%8F%E8%AE%B0%E5%BD%95/mybatis/17.Mybatis%E7%BC%BA%E7%82%B9/" title="17.Mybatisç¼ºç‚¹"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">17.Mybatisç¼ºç‚¹</div></div><div class="info-2"><div class="info-item-1">Mybtis çš„ç¼ºç‚¹æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š 1ï¼‰åŠORMï¼šMyBatis ä¸ä¼šåƒå…¨è‡ªåŠ¨ ORM æ¡†æ¶ï¼ˆå¦‚ Hibernateï¼‰é‚£æ ·è‡ªåŠ¨ç”Ÿæˆ SQL è¯­å¥ï¼Œ å¯¹äºä¸€äº›ç®€å•çš„æŸ¥è¯¢ä¿®æ”¹æ“ä½œï¼Œä¹Ÿéœ€è¦è‡ªå·±å†™ SQLï¼Œå¢åŠ äº†å·¥ä½œé‡ã€‚ 2ï¼‰å¤§é‡XMLç»´æŠ¤ï¼šå¯¹å¤§å‹é¡¹ç›®æ¥è¯´ï¼Œå¯èƒ½éœ€è¦å¤§é‡çš„ xml æ–‡ä»¶ï¼Œä¼šå¯¼è‡´é…ç½®çš„å¤æ‚æ€§å’Œç»´æŠ¤çš„å›°éš¾ã€‚ 3ï¼‰SQLæ— æ³•è‡ªåŠ¨ç”Ÿæˆï¼šå› ä¸º MyBatis ç¼ºä¹ SQL è‡ªåŠ¨èƒ½åŠ›ï¼Œå› æ­¤ç»´æŠ¤æˆæœ¬ä¼šé«˜ä¸€äº›ï¼Œä¾‹å¦‚ä¿®æ”¹äº†è¡¨ç»“æ„æˆ–å­—æ®µåæˆ–è¿ç§»äº†æ•°æ®åº“ï¼Œéƒ½éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ç›¸åº”çš„ SQLï¼Œè¿˜å®¹æ˜“æ¼æ”¹ã€‚ </div></div></div></a><a class="pagination-related" href="/2026/01/26/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/1.%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%8E%A5%E5%85%A5%E6%96%B9%E6%A1%88/" title="1.å¤§æ¨¡å‹æ¥å…¥æ–¹æ¡ˆ"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">1.å¤§æ¨¡å‹æ¥å…¥æ–¹æ¡ˆ</div></div><div class="info-2"><div class="info-item-1">æ¥æºï¼šå¤§æ¨¡å‹æ¥å…¥ ç›¸å…³æ–‡æ¡£ aiçŸ¥è¯†åº“å­¦ä¹   ä¸»æµçš„AIåº“  lanchain4jæ–‡æ¡£ æ”¯æŒçš„æ¨¡å‹ æ•´åˆäº†å›½äº§æ¨¡å‹çš„ç¤¾åŒºç‰ˆæœ¬   springAIæ–‡æ¡£ æ”¯æŒçš„æ¨¡å‹   springAI Alibabaæ–‡æ¡£ ä½¿ç”¨Spring AI Alibabaé›†æˆé˜¿é‡Œäº‘ç™¾ç‚¼å¤§æ¨¡å‹åº”ç”¨    AIæ¥å…¥æœåŠ¡ï¼š  é˜¿é‡Œäº‘ç™¾ç‚¼ï¼šå¯è§†åŒ–å¹³å°ï¼ˆæ™ºèƒ½ä½“ã€å·¥ä½œæµã€æ™ºèƒ½ä½“ç¼–æ’ï¼‰ åº”ç”¨è°ƒç”¨æ–‡æ¡£ dashScope(çµç§¯)ï¼šAPIæ¥å£   ollamaæœ¬åœ°éƒ¨ç½²  AIå®¢æˆ·ç«¯ï¼š  cherry studio cursor  å¤§æ¨¡å‹å¼€å‘å·¥ä½œæµ	 ç¨‹åºå¦‚ä½•äº¤äº’å¤§æ¨¡å‹ç¨‹åºä¸å¤§æ¨¡å‹äº¤äº’çš„å®ç°æ€è·¯ï¼ˆdemo.invokeç›®å½•ï¼‰ï¼š  SDK ä¾èµ–DashScopeæ¥å…¥SDKâ€”â€”maven å¹³å°ç”³è¯·API key è®¿é—®APIï¼šé€šä¹‰åƒé—®APIå‚è€ƒ   HTTP æœ‰SDKä¼˜å…ˆSDK è®¾ç½®APIå¯†é’¥ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ å‘é€è¯·æ±‚ï¼Œå¤„ç†å“åº”   Spring AI  spring:  application:    name: spring-ai-alibaba-qwq-chat-client-example  ai:   ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2026/01/26/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/1.%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%8E%A5%E5%85%A5%E6%96%B9%E6%A1%88/" title="1.å¤§æ¨¡å‹æ¥å…¥æ–¹æ¡ˆ"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-26</div><div class="info-item-2">1.å¤§æ¨¡å‹æ¥å…¥æ–¹æ¡ˆ</div></div><div class="info-2"><div class="info-item-1">æ¥æºï¼šå¤§æ¨¡å‹æ¥å…¥ ç›¸å…³æ–‡æ¡£ aiçŸ¥è¯†åº“å­¦ä¹   ä¸»æµçš„AIåº“  lanchain4jæ–‡æ¡£ æ”¯æŒçš„æ¨¡å‹ æ•´åˆäº†å›½äº§æ¨¡å‹çš„ç¤¾åŒºç‰ˆæœ¬   springAIæ–‡æ¡£ æ”¯æŒçš„æ¨¡å‹   springAI Alibabaæ–‡æ¡£ ä½¿ç”¨Spring AI Alibabaé›†æˆé˜¿é‡Œäº‘ç™¾ç‚¼å¤§æ¨¡å‹åº”ç”¨    AIæ¥å…¥æœåŠ¡ï¼š  é˜¿é‡Œäº‘ç™¾ç‚¼ï¼šå¯è§†åŒ–å¹³å°ï¼ˆæ™ºèƒ½ä½“ã€å·¥ä½œæµã€æ™ºèƒ½ä½“ç¼–æ’ï¼‰ åº”ç”¨è°ƒç”¨æ–‡æ¡£ dashScope(çµç§¯)ï¼šAPIæ¥å£   ollamaæœ¬åœ°éƒ¨ç½²  AIå®¢æˆ·ç«¯ï¼š  cherry studio cursor  å¤§æ¨¡å‹å¼€å‘å·¥ä½œæµ	 ç¨‹åºå¦‚ä½•äº¤äº’å¤§æ¨¡å‹ç¨‹åºä¸å¤§æ¨¡å‹äº¤äº’çš„å®ç°æ€è·¯ï¼ˆdemo.invokeç›®å½•ï¼‰ï¼š  SDK ä¾èµ–DashScopeæ¥å…¥SDKâ€”â€”maven å¹³å°ç”³è¯·API key è®¿é—®APIï¼šé€šä¹‰åƒé—®APIå‚è€ƒ   HTTP æœ‰SDKä¼˜å…ˆSDK è®¾ç½®APIå¯†é’¥ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ å‘é€è¯·æ±‚ï¼Œå¤„ç†å“åº”   Spring AI  spring:  application:    name: spring-ai-alibaba-qwq-chat-client-example  ai:   ...</div></div></div></a><a class="pagination-related" href="/2026/01/27/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/3.RAG/" title="3.RAG"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-27</div><div class="info-item-2">3.RAG</div></div><div class="info-2"><div class="info-item-1">ä½¿ç”¨RAGï¼ˆRetrieval Augmentation Generation æ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰çš„éœ€æ±‚åˆ†æï¼š  çŸ¥è¯†æ‰©å±•ï¼Œç»™å‡ºæ›´ç²¾å‡†çš„å›ç­”  å‡å°å¹»è§‰  ä¸ªæ€§åŒ–è¾“å‡ºï¼šç‰¹è‰²æœåŠ¡å’Œå›ç­”é£æ ¼  æ¨é”€ï¼šæ¨é”€æˆ‘ä»¬çš„äº§å“å’ŒæœåŠ¡   å·¥ä½œæœºåˆ¶æ¦‚è§ˆ  æ–‡æ¡£æ”¶é›†å’Œåˆ‡å‰²  å‘é‡è½¬æ¢å’Œå­˜å‚¨  æ–‡æ¡£è¿‡æ»¤å’Œæ£€ç´¢  æŸ¥è¯¢å¢å¼ºå’Œå…³è”    æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰² æ”¶é›†çš„æ¥æºï¼šç½‘é¡µã€PDFã€æ•°æ®åº“ç­‰åŸå§‹æ–‡æ¡£ é¢„å¤„ç†ï¼šæ¸…æ´—ã€æ ‡å‡†åŒ–æ ¼å¼ åˆ‡å‰²ï¼šé•¿æ–‡æ¡£åˆ’åˆ†ä¸ºé€‚å½“çš„ç‰‡æ®µï¼ˆchunksï¼‰ åŸºäºå›ºå®šå¤§å°ï¼ˆå¦‚512tokenï¼‰ åŸºäºè¯­ä¹‰è¾¹ç•Œï¼ˆæ®µè½ ç« èŠ‚ï¼‰ åŸºäºé€’å½’åˆ†å‰²ç­–ç•¥ï¼ˆé€’å½’å­—ç¬¦ n-gramï¼‰    å‘é‡è½¬æ¢å’Œå­˜å‚¨å‘é‡è½¬æ¢ï¼šå°†æ–‡æœ¬é€šè¿‡Embeddingæ¨¡å‹è½¬åŒ–ä¸ºé«˜ç»´å‘é‡ï¼Œå¯æ•è·åˆ°è¯­ä¹‰ç‰¹å¾ å‘é‡å­˜å‚¨ï¼šå­˜å…¥å‘é‡æ•°æ®åº“ï¼Œæ”¯æŒç›¸ä¼¼åº¦æœç´¢   embedding ç»å…¸çš„æœ‰Word2Vecæ–‡æœ¬ã€ResNetå›¾åƒï¼Œä¸€èˆ¬çº¬åº¦è¶Šé«˜è¯­ä¹‰ä¿¡æ¯è¶Šä¸°å¯Œä½†å ç”¨ç©ºé—´è¶Šå¤š å‘é‡æ•°æ®åº“ï¼šå­˜å‚¨å‘é‡çš„æ•°æ®åº“ï¼Œæ”¯æŒç´¢å¼•ç®—æ³•å¿«é€Ÿç›¸ä¼¼åº¦æœç´¢ï¼Œæ”¯æŒkè¿‘é‚»æŸ¥è¯¢ï¼ˆæ³¨ï¼šä¼ ç»Ÿæ•°æ®åº“ä¹Ÿå¯ä»¥æ”¯æŒï¼Œå¦‚PGVectoræ’ä»¶ï¼ŒRedis...</div></div></div></a><a class="pagination-related" href="/2026/01/30/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/4.RAG%E8%BF%9B%E9%98%B6/" title="4.RAGè¿›é˜¶"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-30</div><div class="info-item-2">4.RAGè¿›é˜¶</div></div><div class="info-2"><div class="info-item-1">æˆ‘ä»¬å…ˆå‰å·²ç»äº†è§£RAGçš„æ•´ä½“å·¥ä½œæµç¨‹ï¼Œä¸ºäº†ç”Ÿæˆæ›´åŠ å®šåˆ¶åŒ–çš„å†…å®¹ï¼Œç°åœ¨è¦è¿›è¡Œä¸€äº›ç»†èŠ‚çš„RAGå­¦ä¹  	  RAGè¿›é˜¶å­¦ä¹ æ–‡æ¡£æ”¶é›†ä¸åˆ‡å‰²ï¼ˆETLï¼‰ETLSpringAI-ETL ETLä¸­çš„æ–‡æ¡£å®é™…ä¸Šä¸å±€é™äºæ–‡æœ¬ï¼Œè¿˜æœ‰ä¸€ç³»åˆ—çš„å…ƒä¿¡æ¯MetaDataã€å¤šåª’ä½“é™„ä»¶MediaContent 		  è€Œé’ˆå¯¹äºETLï¼Œéµå¾ªä¸€å®šçš„æµç¨‹ï¼Œå¯¹åº”ç€ä¸‰å¤§ç»„ä»¶ï¼š  è¯»å–æ–‡æ¡£ï¼šDocumentReaderè´Ÿè´£ä»æ•°æ®æºåŠ è½½æ–‡æ¡£ è½¬æ¢æ–‡æ¡£ï¼šæ ¹æ®éœ€æ±‚å°†æ–‡æ¡£å¤„ç†ä¸ºæŒ‡å®šçš„æ ¼å¼ï¼ˆå¦‚å»é™¤å†—ä½™ä¿¡æ¯ã€åˆ†è¯ã€è¯æ€§æ ‡æ³¨ç­‰ï¼‰ï¼Œå¯é€šè¿‡DocumentTransformerå®ç° å†™å…¥æ–‡æ¡£ï¼šDocumentWriterå°†æ–‡æ¡£ä»¥ç‰¹å®šæ ¼å¼ä¿å­˜åˆ°å­˜å‚¨ä¸­ï¼Œå¦‚ä»¥åµŒå…¥å‘é‡çš„å½¢å¼å†™å…¥å‘é‡æ•°æ®åº“ï¼Œæˆ–è€…é€šè¿‡k-vé”®å€¼å¯¹ä¿å­˜åˆ°Redisç­‰æ•°æ®åº“ä¸­      Extract_DocumentReaderå®ç°äº†Supplierå‡½æ•°å¼æ¥å£ï¼Œä»æ•°æ®æºä¸­å¾—åˆ°Documenté›†åˆ public interface DocumentReader extends Supplier&lt;List&lt;Document&gt;&gt; &#123;    default...</div></div></div></a><a class="pagination-related" href="/2026/01/31/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/5.%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8/" title="5.å·¥å…·è°ƒç”¨"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-31</div><div class="info-item-2">5.å·¥å…·è°ƒç”¨</div></div><div class="info-2"><div class="info-item-1">å…·ä½“å†…å®¹åŒ…æ‹¬: â€¢ å·¥å…·è°ƒç”¨ä»‹ç» â€¢ Spring AI å·¥å…·å¼€å‘ â€¢ ä¸»æµå·¥å…·å¼€å‘ â€¢ æ–‡ä»¶æ“ä½œ â€¢ è”ç½‘æœç´¢ â€¢ ç½‘é¡µæŠ“å– â€¢ ç»ˆç«¯æ“ä½œ â€¢ èµ„æºä¸‹è½½ â€¢ PDF ç”Ÿæˆ â€¢ å·¥å…·è¿›é˜¶çŸ¥è¯† (åŸç†å’Œé«˜çº§ç‰¹æ€§) éœ€æ±‚åˆ†æï¼šç°åœ¨é€šè¿‡RAGæŠ€æœ¯è®©AIå¯ä»¥æ ¹æ®å¤–éƒ¨çŸ¥è¯†åº“è·å–ä¿¡æ¯å›ç­”çš„èƒ½åŠ›ï¼Œä½†æ˜¯å¯èƒ½éœ€è¦ä¸€äº›å¤–éƒ¨å·¥å…·çš„åœºæ™¯ï¼š  è”ç½‘æœç´¢ï¼šå¦‚æ™ºèƒ½æ¨èçº¦ä¼šåœ°ç‚¹ï¼ˆå¦‚cursorçš„è”ç½‘æœç´¢ï¼Œé˜¿é‡Œäº‘ç™¾ç‚¼APIä¹Ÿæä¾›è¯¥é€‰é¡¹æ”¯æŒï¼‰ ç½‘é¡µæŠ“å–ï¼šå¦‚æŸ¥çœ‹ç™¾åº¦è´´å§å…¶ä»–å§å‹æ˜¯æ€ä¹ˆè§£å†³æƒ…æ„Ÿé—®é¢˜çš„ èµ„æºä¸‹è½½ï¼šä¸‹è½½çº¦ä¼šæ—¶çš„é’¢ç´æ›² ç»ˆç«¯æ“ä½œï¼šPythonç”Ÿæˆæ‹çˆ±åˆ†ææŠ¥å‘Š æ–‡ä»¶æ“ä½œï¼šä¿å­˜æ‹çˆ±æ¡£æ¡ˆ PDFç”Ÿæˆï¼šç”Ÿæˆä¸ƒå¤•çº¦ä¼šè®¡åˆ’PDFï¼Œé¤å…é¢„è®¢-æ´»åŠ¨æµç¨‹-ç¤¼ç‰©æ¸…å•   ä»¥ä¸Šå·¥å…·å¯è¿›è¡Œç»„åˆæ­é…ä½¿ç”¨ã€‚è®©aiä¸å†æ˜¯ç®€å•çš„é—®ç­”ç³»ç»Ÿï¼Œè€Œæ˜¯èƒ½å®Œæˆä»»åŠ¡çš„æ™ºèƒ½ä½“  å·¥å…·è°ƒç”¨ Tool Callingç›®çš„ï¼šè®©AIæ¥ä½¿ç”¨å¤–éƒ¨å·¥å…·å®Œæˆè‡ªå·±åšä¸åˆ°çš„äº‹æƒ…ï¼Œå¦‚æŸ¥è¯¢å¤©æ°”ï¼ŒAIæœ¬èº«æ²¡æœ‰è¿™äº›çŸ¥è¯†ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è”ç½‘æœç´¢æ¥å®Œæˆä»»åŠ¡ å®˜æ–¹æ–‡æ¡£ å·¥å…·è°ƒç”¨æ”¯æŒçš„æ¨¡å‹ å·¥å…·è°ƒç”¨çš„æµç¨‹ï¼š  å·¥å…·å®šä¹‰: ç¨‹åºå‘Šè¯‰ AI â€œä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·â€,...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">yuezi</div><div class="author-info-description">ç§¯å¾®è€…é€Ÿæˆ</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">785</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">66</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">91</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yuezi2048"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://githubfast.com/yuezi2048" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://blog.csdn.net/qq_46345703" target="_blank" title="CSDN"><i class="fa fa-book-open"></i></a><a class="social-icon" href="https://qm.qq.com/cgi-bin/qm/qr?k=dD62GIPTf5-iS4UdSfJRy7NHwsrCh3-j" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="mailto:joyLing@stumail.nwu.edu.cn" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">ç§¯å¾®è€…é€Ÿæˆ</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Prompt%E5%B7%A5%E7%A8%8B"><span class="toc-text">Promptå·¥ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Prompt%E5%88%86%E7%B1%BB"><span class="toc-text">Promptåˆ†ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E7%A4%BA%E8%AF%8D%E4%BC%98%E5%8C%96"><span class="toc-text">æç¤ºè¯ä¼˜åŒ–</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-text">éœ€æ±‚åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-text">ç³»ç»Ÿå®ç°æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%8F%90%E7%A4%BA%E8%AF%8D%E8%AE%BE%E8%AE%A1"><span class="toc-text">ç³»ç»Ÿæç¤ºè¯è®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%BD%AE%E5%AF%B9%E8%AF%9D"><span class="toc-text">å¤šè½®å¯¹è¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#chatClient%E7%89%B9%E6%80%A7"><span class="toc-text">chatClientç‰¹æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Advisors"><span class="toc-text">Advisors</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-text">æ‰§è¡ŒåŸç†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ChatMemoryAdvisor"><span class="toc-text">ChatMemoryAdvisor</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%AE%9E%E7%8E%B0%E5%8F%8A%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-text">åº”ç”¨å®ç°åŠå•å…ƒæµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringAI%E6%8B%93%E5%B1%95"><span class="toc-text">SpringAIæ‹“å±•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Advisor"><span class="toc-text">è‡ªå®šä¹‰Advisor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA"><span class="toc-text">ç»“æ„åŒ–è¾“å‡º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BF%86%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">å¯¹è¯è®°å¿†æŒä¹…åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PromptTemplate%E6%A8%A1%E6%9D%BF"><span class="toc-text">PromptTemplateæ¨¡æ¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%A8%A1%E6%80%81"><span class="toc-text">å¤šæ¨¡æ€</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/22/Excalidraw/Drawing%202024-11-01%2015.37.37.excalidraw/" title="Drawing 2024-11-01 15.37.37.excalidraw">Drawing 2024-11-01 15.37.37.excalidraw</a><time datetime="2026-02-22T05:56:41.839Z" title="å‘è¡¨äº 2026-02-22 13:56:41">2026-02-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/22/2.Areas%F0%9F%8C%90/01.project/condefather/yupao/back-end/7.%E4%BC%98%E5%8C%96%E4%B8%BB%E9%A1%B5%E6%80%A7%E8%83%BD-%E4%BC%98%E5%8C%96%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE/" title="7.ä¼˜åŒ–ä¸»é¡µæ€§èƒ½-ä¼˜åŒ–æ‰¹é‡å¯¼å…¥æ•°æ®">7.ä¼˜åŒ–ä¸»é¡µæ€§èƒ½-ä¼˜åŒ–æ‰¹é‡å¯¼å…¥æ•°æ®</a><time datetime="2026-02-22T05:56:41.257Z" title="å‘è¡¨äº 2026-02-22 13:56:41">2026-02-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/31/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/5.%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8/" title="5.å·¥å…·è°ƒç”¨">5.å·¥å…·è°ƒç”¨</a><time datetime="2026-01-31T03:54:22.000Z" title="å‘è¡¨äº 2026-01-31 11:54:22">2026-01-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/30/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/4.RAG%E8%BF%9B%E9%98%B6/" title="4.RAGè¿›é˜¶">4.RAGè¿›é˜¶</a><time datetime="2026-01-30T13:23:42.000Z" title="å‘è¡¨äº 2026-01-30 21:23:42">2026-01-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/27/2.Areas%F0%9F%8C%90/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/3.RAG/" title="3.RAG">3.RAG</a><time datetime="2026-01-27T09:06:56.000Z" title="å‘è¡¨äº 2026-01-27 17:06:56">2026-01-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/default.png);"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2026 By yuezi</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.0.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>